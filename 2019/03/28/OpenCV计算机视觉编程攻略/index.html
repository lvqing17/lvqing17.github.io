<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="OpenCV,OpenCV计算机视觉编程攻略,">








  <link rel="shortcut icon" type="image/x-icon" href="https://blog-1253453438.cos.ap-beijing.myqcloud.com/hexo_icon/L_0(%E5%B7%B2%E5%8E%BB%E5%BA%95).png?v=5.1.0">






<meta name="description" content="Chapter_01 : 基础知识 1.图像的水平变换(flip),添加文字（putText）,鼠标的触发事件2.感兴趣区域  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727">
<meta name="keywords" content="OpenCV,OpenCV计算机视觉编程攻略">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCV计算机视觉编程攻略">
<meta property="og:url" content="http://yoursite.com/2019/03/28/OpenCV计算机视觉编程攻略/index.html">
<meta property="og:site_name" content="晴宝">
<meta property="og:description" content="Chapter_01 : 基础知识 1.图像的水平变换(flip),添加文字（putText）,鼠标的触发事件2.感兴趣区域  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-03-28T02:56:11.473Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenCV计算机视觉编程攻略">
<meta name="twitter:description" content="Chapter_01 : 基础知识 1.图像的水平变换(flip),添加文字（putText）,鼠标的触发事件2.感兴趣区域  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/03/28/OpenCV计算机视觉编程攻略/">





  <title> OpenCV计算机视觉编程攻略 | 晴宝 </title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">
 

  














  
  
    
  
  
  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>
	<a target="_blank" href="https://github.com/lvqing17"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_gray_6d6d6d.png" alt="Fork me on GitHub"></a>


    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">晴宝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">吃饱好减肥</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/28/OpenCV计算机视觉编程攻略/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="晴宝宝">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://blog-1253453438.cos.ap-beijing.myqcloud.com/hexo_icon/lq.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="晴宝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OpenCV计算机视觉编程攻略
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-28T10:20:53+08:00">
                2019-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenCV/" itemprop="url" rel="index">
                    <span itemprop="name">OpenCV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  33.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长" }}"="">
                  185 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Chapter-01-基础知识"><a href="#Chapter-01-基础知识" class="headerlink" title="Chapter_01 : 基础知识"></a>Chapter_01 : 基础知识</h3><blockquote>
<p>1.图像的水平变换(flip),添加文字（putText）,鼠标的触发事件<br>2.感兴趣区域</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onMouse</span><span class="params">(<span class="keyword">int</span> event, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> flags, <span class="keyword">void</span> *param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//reinterpret_cast允许将任何指针转为任何其他指针类型，</span></span><br><span class="line">	<span class="comment">//也允许将任何整数类型转化为任何指针类型以及反向转换。</span></span><br><span class="line">	Mat *im = <span class="keyword">reinterpret_cast</span>&lt;Mat *&gt;(param);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (event)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> EVENT_LBUTTONDOWN:</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"at("</span> &lt;&lt; x &lt;&lt; <span class="string">","</span> &lt;&lt; y &lt;&lt; <span class="string">") value is: "</span> &lt;&lt; <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(im-&gt;at&lt;uchar&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//1.图像的水平变换(flip), 添加文字（putText）, 鼠标的触发事件</span></span><br><span class="line">	<span class="comment">/*Mat image;</span></span><br><span class="line"><span class="comment">	cout &lt;&lt; "This image is " &lt;&lt; image.rows &lt;&lt; "x" &lt;&lt; image.cols &lt;&lt; "y" &lt;&lt; endl;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	image = imread("./images/puppy.bmp", IMREAD_GRAYSCALE);</span></span><br><span class="line"><span class="comment">	if (image.empty())</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		cout &lt;&lt; "Error reading image..." &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">		return 0;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	imshow("image", image);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	cout &lt;&lt; "This image is " &lt;&lt; image.rows &lt;&lt; "x" &lt;&lt; image.cols &lt;&lt; "y" &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">	cout &lt;&lt; "This image has" &lt;&lt; image.channels() &lt;&lt; "channel(s)" &lt;&lt; endl;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	setMouseCallback("image", onMouse, reinterpret_cast&lt;void*&gt;(&amp;image));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	Mat result;</span></span><br><span class="line"><span class="comment">	flip(image, result, 1);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	imshow("flip", result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	circle(image, Point(155, 100), 65, 0, 3);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	putText(image, "SHA_CUN", Point(40, 200), FONT_HERSHEY_PLAIN, 2.0, 255, 2);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	imshow("sha_cun",image);*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2.感兴趣区域</span></span><br><span class="line">	Mat image = imread(<span class="string">"./images/puppy.bmp"</span>);</span><br><span class="line">	Mat logo = imread(<span class="string">"./images/smalllogo.png"</span>);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"image"</span>, image);</span><br><span class="line">	imshow(<span class="string">"logo"</span>, logo);</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"logo : "</span> &lt;&lt; logo.channels() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Mat <span class="title">imageROI</span><span class="params">(image, Rect(image.cols - logo.cols, image.rows - logo.rows, logo.cols, logo.rows))</span></span>;</span><br><span class="line">	logo.copyTo(imageROI);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"Image_logo"</span>, image);</span><br><span class="line"></span><br><span class="line">	image = imread(<span class="string">"./images/puppy.bmp"</span>);</span><br><span class="line">	imageROI = image(Rect(image.cols - logo.cols, image.rows - logo.rows, logo.cols, logo.rows));</span><br><span class="line">	</span><br><span class="line">	<span class="function">Mat <span class="title">mask</span><span class="params">(logo)</span></span>; <span class="comment">//必须是灰度图，只复制值不为0的部分（0为黑色， 255为白色）</span></span><br><span class="line">	logo.copyTo(imageROI, mask);</span><br><span class="line">	imshow(<span class="string">"image_mask"</span>, image);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>图像像素的遍历:.at()、迭代器、指针</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.at()方法实现图像像素的遍历</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">Mat <span class="title">grayim</span><span class="params">(<span class="number">600</span>, <span class="number">800</span>, CV_8UC1)</span></span>;</span><br><span class="line">  <span class="function">Mat <span class="title">colorim</span><span class="params">(<span class="number">600</span>, <span class="number">800</span>, CV_8UC3)</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; grayim.rows; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; grayim.cols; j++)</span><br><span class="line">	&#123;</span><br><span class="line">	  grayim.at&lt;uchar&gt;(i,j) = (i + j) % <span class="number">255</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colorim.rows; i++)</span><br><span class="line">  &#123;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; colorim.cols; j++)</span><br><span class="line">	 &#123;</span><br><span class="line">	   Vec3b pixel;</span><br><span class="line">	   pixel[<span class="number">0</span>] = i % <span class="number">255</span>; <span class="comment">//Blue</span></span><br><span class="line">	   pixel[<span class="number">1</span>] = i % <span class="number">255</span>; <span class="comment">//Green</span></span><br><span class="line">	   pixel[<span class="number">2</span>] = <span class="number">0</span>;       <span class="comment">//Red</span></span><br><span class="line">	   </span><br><span class="line">	   colorim.at&lt;Vec3b&gt;(i, j) = pixel;</span><br><span class="line">	 &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">   imshow(<span class="string">"grayim"</span>, grayim);</span><br><span class="line">   imshow(<span class="string">"colorim"</span>, colorim);</span><br><span class="line"></span><br><span class="line">   waitKey(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.简单的二值化处理代码</span></span><br><span class="line"><span class="comment">//如果，我们只需要图像的轮廓或者边缘的时候，那么其他像素是不是就可以认为噪声，</span></span><br><span class="line"><span class="comment">//为了减少数据量和方便计算，此时，我们就可以进行二值化</span></span><br><span class="line"><span class="comment">//而且二值化，还能去用来进行图像分割，前景后景分割</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Mat srcImage;</span><br><span class="line">  srcImage = imread(<span class="string">"4.jpg"</span>);</span><br><span class="line">  imshow(<span class="string">"srcImage1"</span>,srcImage);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; srcImage.rows; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; srcImage.cols; j++)</span><br><span class="line">	&#123;</span><br><span class="line">	   Vec3b value = srcImage.at&lt;Vec3b&gt;(i,j);</span><br><span class="line">	   </span><br><span class="line">	   <span class="keyword">for</span>(<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; <span class="number">3</span>; h++)</span><br><span class="line">	   &#123;</span><br><span class="line">	    <span class="keyword">if</span>(value[h] &gt; <span class="number">128</span>)</span><br><span class="line">		   value[h] = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		   value[h] = <span class="number">0</span>;</span><br><span class="line">	   &#125;</span><br><span class="line">	   </span><br><span class="line">	   </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	srcImage.at&lt;Vec3b&gt;(i, j) = value;</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  imshow(<span class="string">"srcImage2"</span>, srcImage);</span><br><span class="line"></span><br><span class="line">  waitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.使用迭代器遍历矩阵</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">Mat <span class="title">grayim</span><span class="params">(<span class="number">800</span>, <span class="number">600</span>, CV_8UC1)</span></span>;</span><br><span class="line">	<span class="function">Mat <span class="title">colorim</span><span class="params">(<span class="number">800</span>, <span class="number">600</span>, CV_8UC3)</span></span>;</span><br><span class="line"></span><br><span class="line">	MatIterator_&lt;uchar&gt; grayit, grayend;</span><br><span class="line">	<span class="keyword">for</span> (grayit = grayim.begin&lt;uchar&gt;(), grayend = grayim.end&lt;uchar&gt;(); </span><br><span class="line">		grayit != grayend; grayit++)</span><br><span class="line">		*grayit = rand() % <span class="number">255</span>;</span><br><span class="line"></span><br><span class="line">	MatIterator_&lt;Vec3b&gt; colorit, colorend;</span><br><span class="line">	<span class="keyword">for</span> (colorit = colorim.begin&lt;Vec3b&gt;(), colorend = colorim.end&lt;Vec3b&gt;();</span><br><span class="line">		colorit != colorend; colorit++)</span><br><span class="line">		(*colorit)[<span class="number">0</span>] = rand() % <span class="number">255</span>; <span class="comment">//Blue</span></span><br><span class="line">	(*colorit)[<span class="number">1</span>] = rand() % <span class="number">255</span>; <span class="comment">//Green</span></span><br><span class="line">	(*colorit)[<span class="number">2</span>] = rand() % <span class="number">255</span>; <span class="comment">//Red</span></span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"grayim"</span>, grayim);</span><br><span class="line">	imshow(<span class="string">"colorim"</span>, colorim);</span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//4.使用指针来遍历</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">Mat <span class="title">grayim</span><span class="params">(<span class="number">800</span>, <span class="number">600</span>, CV_8UC1)</span></span>;</span><br><span class="line">	<span class="function">Mat <span class="title">colorim</span><span class="params">(<span class="number">800</span>, <span class="number">600</span>, CV_8UC3)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; grayim.rows; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		uchar *p = grayim.ptr&lt;uchar&gt;(i);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; grayim.cols; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			p[j] = (i + j) % <span class="number">255</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colorim.rows; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		Vec3b *p = colorim.ptr&lt;Vec3b&gt;(i);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; colorim.cols; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			p[j][<span class="number">0</span>] = i % <span class="number">255</span>;</span><br><span class="line">			p[j][<span class="number">1</span>] = j % <span class="number">255</span>;</span><br><span class="line">			p[j][<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"grayim"</span>, grayim);</span><br><span class="line">	imshow(<span class="string">"colorim"</span>, colorim);</span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-02-操作像素"><a href="#Chapter-02-操作像素" class="headerlink" title="Chapter_02 : 操作像素"></a>Chapter_02 : 操作像素</h3><blockquote>
<p>1.创建椒盐噪声<br>2.创建波浪影响remap()  —- 重映射<br>3.扫描图像并访问相邻像素（1、代码的运行时间 2、锐化）<br>4.增加图片<br>5.减少图片中颜色的数量(没敲，太麻烦)</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="comment">//5.减少图片中颜色的数量</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NTESTS 15</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NITERATIONS 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.创建波浪影响remap()</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wave</span><span class="params">( <span class="keyword">const</span> Mat &amp;image, Mat &amp;result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//the map functiuons</span></span><br><span class="line">	<span class="function">Mat <span class="title">srcX</span><span class="params">(image.rows, image.cols, CV_32F)</span></span>;</span><br><span class="line">	<span class="function">Mat <span class="title">srcY</span><span class="params">(image.rows, image.cols, CV_32F)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//creating the mapping</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; image.rows; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; image.cols; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			srcX.at&lt;<span class="keyword">float</span>&gt;(i, j) = j;</span><br><span class="line">			srcY.at&lt;<span class="keyword">float</span>&gt;(i, j) = i + <span class="number">3</span> * <span class="built_in">sin</span>(j / <span class="number">6.0</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// horizontal flipping</span></span><br><span class="line">			<span class="comment">// srcX.at&lt;float&gt;(i,j)= image.cols-j-1;</span></span><br><span class="line">			<span class="comment">// srcY.at&lt;float&gt;(i,j)= i;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//applying the mapping</span></span><br><span class="line">	remap(image, result, srcX, srcY, INTER_LINEAR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.扫描图像并访问相邻像素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sharpen</span><span class="params">(<span class="keyword">const</span> Mat &amp;image, Mat &amp;result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	result.create(image.size(), image.type());</span><br><span class="line">	<span class="keyword">int</span> nchannels = image.channels();</span><br><span class="line">	<span class="comment">//处理所有的行，（除了第一行和最后一行）</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; image.rows - <span class="number">1</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">const</span> uchar *previous = image.ptr&lt;<span class="keyword">const</span> uchar&gt;(j - <span class="number">1</span>);  <span class="comment">//previous row</span></span><br><span class="line">		<span class="keyword">const</span> uchar *current = image.ptr&lt;<span class="keyword">const</span> uchar&gt;(j);       <span class="comment">//current row</span></span><br><span class="line">		<span class="keyword">const</span> uchar *next = image.ptr&lt;<span class="keyword">const</span> uchar&gt;(j + <span class="number">1</span>);      <span class="comment">//next row</span></span><br><span class="line"></span><br><span class="line">		uchar *output = result.ptr&lt;uchar&gt;(j);                   <span class="comment">//output row</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = nchannels; i &lt; (image.cols - <span class="number">1</span>) * nchannels; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//应用锐化算子</span></span><br><span class="line">			*output++ = saturate_cast&lt;uchar&gt;(<span class="number">5</span> * current[i]   -   current[i-nchannels]</span><br><span class="line">				                             - current[i+nchannels] - previous[i] - next[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//把未处理的像素设置为0</span></span><br><span class="line">	result.row(<span class="number">0</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">	result.row(result.rows - <span class="number">1</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">	result.col(<span class="number">0</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">	result.col(result.cols - <span class="number">1</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//和sharpen一样的功能，只不过用了迭代</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sharpenIterator</span><span class="params">(<span class="keyword">const</span> Mat &amp;image, Mat &amp;result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//must be a gray-level image</span></span><br><span class="line">	CV_Assert(image.type() == CV_8UC1);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//initialize iterator at row 1</span></span><br><span class="line">	Mat_&lt;uchar&gt; :: const_iterator it = image.begin&lt;uchar&gt;() + image.cols;</span><br><span class="line">	Mat_&lt;uchar&gt; :: const_iterator itend = image.end&lt;uchar&gt;() - image.cols;</span><br><span class="line">	Mat_&lt;uchar&gt; :: const_iterator itup = image.begin&lt;uchar&gt;();</span><br><span class="line">	Mat_&lt;uchar&gt; ::const_iterator itdown = image.begin&lt;uchar&gt;() + <span class="number">2</span> * image.cols;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//setup output image and iterator</span></span><br><span class="line">	result.create(image.size(), image.type());   <span class="comment">//allocate if necessary</span></span><br><span class="line">	Mat_&lt;uchar&gt; ::iterator itout = result.begin&lt;uchar&gt;() + result.cols;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (; it != itend; ++it, ++itout, ++itup, ++itdown)</span><br><span class="line">	&#123;</span><br><span class="line">		*itout = cv::saturate_cast&lt;uchar&gt;(*it * <span class="number">5</span> - *(it - <span class="number">1</span>) - *(it + <span class="number">1</span>) - *itup - *itdown);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the unprocessed pixels to 0</span></span><br><span class="line">	result.row(<span class="number">0</span>).setTo(cv::Scalar(<span class="number">0</span>));</span><br><span class="line">	result.row(result.rows - <span class="number">1</span>).setTo(cv::Scalar(<span class="number">0</span>));</span><br><span class="line">	result.col(<span class="number">0</span>).setTo(cv::Scalar(<span class="number">0</span>));</span><br><span class="line">	result.col(result.cols - <span class="number">1</span>).setTo(cv::Scalar(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sharpen2D</span><span class="params">(<span class="keyword">const</span> Mat &amp;image, Mat &amp;result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//构造内核（所有入口都初始化为0）</span></span><br><span class="line">	<span class="function">Mat <span class="title">kernel</span><span class="params">(<span class="number">3</span>, <span class="number">3</span>, CV_32F, Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">	<span class="comment">//对内核赋值</span></span><br><span class="line">	kernel.at&lt;<span class="keyword">float</span>&gt;(<span class="number">1</span>, <span class="number">1</span>) = <span class="number">5.0</span>;</span><br><span class="line">	kernel.at&lt;<span class="keyword">float</span>&gt;(<span class="number">0</span>, <span class="number">1</span>) = <span class="number">-1.0</span>;</span><br><span class="line">	kernel.at&lt;<span class="keyword">float</span>&gt;(<span class="number">2</span>, <span class="number">1</span>) = <span class="number">-1.0</span>;</span><br><span class="line">	kernel.at&lt;<span class="keyword">float</span>&gt;(<span class="number">1</span>, <span class="number">0</span>) = <span class="number">-1.0</span>;</span><br><span class="line">	kernel.at&lt;<span class="keyword">float</span>&gt;(<span class="number">1</span>, <span class="number">2</span>) = <span class="number">-1.0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//对图像滤波</span></span><br><span class="line">	filter2D(image, result, image.depth(), kernel);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.减少图片中颜色的数量</span></span><br><span class="line"><span class="comment">// 1st version</span></span><br><span class="line"><span class="comment">// see recipe Scanning an image with pointers</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce</span><span class="params">(Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels(); <span class="comment">// total number of elements per line</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// get the address of row j</span></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			data[i] = data[i] / div*div + div / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// version with input/ouput images</span></span><br><span class="line"><span class="comment">// see recipe Scanning an image with pointers</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduceIO</span><span class="params">(<span class="keyword">const</span> cv::Mat &amp;image, <span class="comment">// input image</span></span></span></span><br><span class="line"><span class="function"><span class="params">	cv::Mat &amp;result,      <span class="comment">// output image</span></span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols; <span class="comment">// number of columns</span></span><br><span class="line">	<span class="keyword">int</span> nchannels = image.channels(); <span class="comment">// number of channels</span></span><br><span class="line"></span><br><span class="line">									  <span class="comment">// allocate output image if necessary</span></span><br><span class="line">	result.create(image.rows, image.cols, image.type());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// get the addresses of input and output row j</span></span><br><span class="line">		<span class="keyword">const</span> uchar* data_in = image.ptr&lt;uchar&gt;(j);</span><br><span class="line">		uchar* data_out = result.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc*nchannels; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			data_out[i] = data_in[i] / div*div + div / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 1</span></span><br><span class="line"><span class="comment">// this version uses the dereference operator *</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce1</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels(); <span class="comment">// total number of elements per line</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			*data++ = *data / div*div + div2;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 2</span></span><br><span class="line"><span class="comment">// this version uses the modulo operator</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce2</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels(); <span class="comment">// total number of elements per line</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">int</span> v = *data;</span><br><span class="line">			*data++ = v - v%div + div2;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 3</span></span><br><span class="line"><span class="comment">// this version uses a binary mask</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce3</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels(); <span class="comment">// total number of elements per line</span></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line">	uchar div2 = <span class="number">1</span> &lt;&lt; (n - <span class="number">1</span>); <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			*data &amp;= mask;     <span class="comment">// masking</span></span><br><span class="line">			*data++ |= div2;   <span class="comment">// add div/2</span></span><br><span class="line"></span><br><span class="line">							   <span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 4</span></span><br><span class="line"><span class="comment">// this version uses direct pointer arithmetic with a binary mask</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce4</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels(); <span class="comment">// total number of elements per line</span></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="keyword">int</span> step = image.step; <span class="comment">// effective width</span></span><br><span class="line">						   <span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">						   <span class="comment">// get the pointer to the image buffer</span></span><br><span class="line">	uchar *data = image.data;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			*(data + i) &amp;= mask;</span><br><span class="line">			*(data + i) += div2;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line"></span><br><span class="line">		data += step;  <span class="comment">// next line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 5</span></span><br><span class="line"><span class="comment">// this version recomputes row size each time</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce5</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;image.cols * image.channels(); i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			*data &amp;= mask;</span><br><span class="line">			*data++ += div / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 6</span></span><br><span class="line"><span class="comment">// this version optimizes the case of continuous image</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce6</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels(); <span class="comment">// total number of elements per line</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (image.isContinuous()) &#123;</span><br><span class="line">		<span class="comment">// then no padded pixels</span></span><br><span class="line">		nc = nc*nl;</span><br><span class="line">		nl = <span class="number">1</span>;  <span class="comment">// it is now a 1D array</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">						   <span class="comment">// this loop is executed only once</span></span><br><span class="line">						   <span class="comment">// in case of continuous images</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			*data &amp;= mask;</span><br><span class="line">			*data++ += div2;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 7</span></span><br><span class="line"><span class="comment">// this versions applies reshape on continuous image</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce7</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (image.isContinuous()) &#123;</span><br><span class="line">		<span class="comment">// no padded pixels</span></span><br><span class="line">		image.reshape(<span class="number">1</span>,   <span class="comment">// new number of channels</span></span><br><span class="line">			<span class="number">1</span>); <span class="comment">// new number of rows</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// number of columns set accordingly</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols*image.channels(); <span class="comment">// number of columns</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line"></span><br><span class="line">		uchar* data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			*data &amp;= mask;</span><br><span class="line">			*data++ += div2;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 8</span></span><br><span class="line"><span class="comment">// this version processes the 3 channels inside the loop with Mat_ iterators</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce8</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// get iterators</span></span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt;::iterator it = image.begin&lt;cv::Vec3b&gt;();</span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt;::iterator itend = image.end&lt;cv::Vec3b&gt;();</span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (; it != itend; ++it) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">		(*it)[<span class="number">0</span>] = (*it)[<span class="number">0</span>] / div*div + div2;</span><br><span class="line">		(*it)[<span class="number">1</span>] = (*it)[<span class="number">1</span>] / div*div + div2;</span><br><span class="line">		(*it)[<span class="number">2</span>] = (*it)[<span class="number">2</span>] / div*div + div2;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 9</span></span><br><span class="line"><span class="comment">// this version uses iterators on Vec3b</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce9</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// get iterators</span></span><br><span class="line">	cv::MatIterator_&lt;cv::Vec3b&gt; it = image.begin&lt;cv::Vec3b&gt;();</span><br><span class="line">	cv::MatIterator_&lt;cv::Vec3b&gt; itend = image.end&lt;cv::Vec3b&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> cv::<span class="function">Vec3b <span class="title">offset</span><span class="params">(div / <span class="number">2</span>, div / <span class="number">2</span>, div / <span class="number">2</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (; it != itend; ++it) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">		*it = *it / div*div + offset;</span><br><span class="line">		<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 10</span></span><br><span class="line"><span class="comment">// this version uses iterators with a binary mask</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce10</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// div must be a power of 2</span></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">						   <span class="comment">// get iterators</span></span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt;::iterator it = image.begin&lt;cv::Vec3b&gt;();</span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt;::iterator itend = image.end&lt;cv::Vec3b&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// scan all pixels</span></span><br><span class="line">	<span class="keyword">for</span> (; it != itend; ++it) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">		(*it)[<span class="number">0</span>] &amp;= mask;</span><br><span class="line">		(*it)[<span class="number">0</span>] += div2;</span><br><span class="line">		(*it)[<span class="number">1</span>] &amp;= mask;</span><br><span class="line">		(*it)[<span class="number">1</span>] += div2;</span><br><span class="line">		(*it)[<span class="number">2</span>] &amp;= mask;</span><br><span class="line">		(*it)[<span class="number">2</span>] += div2;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 11</span></span><br><span class="line"><span class="comment">// this versions uses ierators from Mat_ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce11</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// get iterators</span></span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt; cimage = image;</span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt;::iterator it = cimage.begin();</span><br><span class="line">	cv::Mat_&lt;cv::Vec3b&gt;::iterator itend = cimage.end();</span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (; it != itend; it++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">		(*it)[<span class="number">0</span>] = (*it)[<span class="number">0</span>] / div*div + div2;</span><br><span class="line">		(*it)[<span class="number">1</span>] = (*it)[<span class="number">1</span>] / div*div + div2;</span><br><span class="line">		(*it)[<span class="number">2</span>] = (*it)[<span class="number">2</span>] / div*div + div2;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 12</span></span><br><span class="line"><span class="comment">// this version uses the at method</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce12</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> nl = image.rows; <span class="comment">// number of lines</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols; <span class="comment">// number of columns</span></span><br><span class="line">	uchar div2 = div &gt;&gt; <span class="number">1</span>; <span class="comment">// div2 = div/2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;nl; j++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;nc; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// process each pixel ---------------------</span></span><br><span class="line"></span><br><span class="line">			image.at&lt;cv::Vec3b&gt;(j, i)[<span class="number">0</span>] = image.at&lt;cv::Vec3b&gt;(j, i)[<span class="number">0</span>] / div*div + div2;</span><br><span class="line">			image.at&lt;cv::Vec3b&gt;(j, i)[<span class="number">1</span>] = image.at&lt;cv::Vec3b&gt;(j, i)[<span class="number">1</span>] / div*div + div2;</span><br><span class="line">			image.at&lt;cv::Vec3b&gt;(j, i)[<span class="number">2</span>] = image.at&lt;cv::Vec3b&gt;(j, i)[<span class="number">2</span>] / div*div + div2;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line"></span><br><span class="line">		&#125; <span class="comment">// end of line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 13</span></span><br><span class="line"><span class="comment">// this version uses Mat overloaded operators</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce13</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> n = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="built_in">log</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(div)) / <span class="built_in">log</span>(<span class="number">2.0</span>) + <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// mask used to round the pixel value</span></span><br><span class="line">	uchar mask = <span class="number">0xFF</span> &lt;&lt; n; <span class="comment">// e.g. for div=16, mask= 0xF0</span></span><br><span class="line"></span><br><span class="line">							<span class="comment">// perform color reduction</span></span><br><span class="line">	image = (image&amp;cv::Scalar(mask, mask, mask)) + cv::Scalar(div / <span class="number">2</span>, div / <span class="number">2</span>, div / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 14</span></span><br><span class="line"><span class="comment">// this version uses a look up table</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce14</span><span class="params">(cv::Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	cv::<span class="function">Mat <span class="title">lookup</span><span class="params">(<span class="number">1</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">		lookup.at&lt;uchar&gt;(i) = i / div*div + div / <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cv::LUT(image, lookup, image);</span><br><span class="line">&#125;</span><br><span class="line">       </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//2.创建波浪影响remap()  ---- 重映射</span></span><br><span class="line">	<span class="comment">/*Mat image = imread("./images/boldt.jpg", 0);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	imshow("image", image);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	Mat result;</span></span><br><span class="line"><span class="comment">	wave(image, result);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	imshow("result", result);*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////3.扫描图像并访问相邻像素</span></span><br><span class="line">	<span class="comment">//Mat image = imread("./images/boldt.jpg");</span></span><br><span class="line">	<span class="comment">//if (!image.data)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("image", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////调用sharpen()</span></span><br><span class="line">	<span class="comment">//Mat result_sharpen;</span></span><br><span class="line">	<span class="comment">////用来测试函数或者代码段的运行时间</span></span><br><span class="line">	<span class="comment">////getTickCount()返回从最近一次计算机开机到当前的时钟周期数</span></span><br><span class="line">	<span class="comment">//double time = static_cast&lt;double&gt;(getTickCount());</span></span><br><span class="line">	<span class="comment">//sharpen(image, result_sharpen);</span></span><br><span class="line">	<span class="comment">////getTickFrequency()返回每秒的时钟数</span></span><br><span class="line">	<span class="comment">//time = (static_cast&lt;double&gt;(getTickCount()) - time) / getTickFrequency();</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "time_sharpen = " &lt;&lt; time &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("sharpen_Image", result_sharpen);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////调用sharpenIterator(要使用灰度图)</span></span><br><span class="line">	<span class="comment">//Mat image3 = imread("./images/boldt.jpg", 0);</span></span><br><span class="line">	<span class="comment">//if (!image3.data)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("image3", image3);</span></span><br><span class="line">	<span class="comment">//Mat result_Iterator;</span></span><br><span class="line">	<span class="comment">//double time3 = static_cast&lt;double&gt;(getTickCount());</span></span><br><span class="line">	<span class="comment">//sharpenIterator(image3, result_Iterator);</span></span><br><span class="line">	<span class="comment">//time3 = (static_cast&lt;double&gt;(getTickCount()) - time3) / getTickFrequency();</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "time_Iterator = " &lt;&lt; time3 &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Iterator_Image", result_Iterator);</span></span><br><span class="line">	<span class="comment">////调用sharpen2D()</span></span><br><span class="line">	<span class="comment">//Mat result_sharpen2D;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//double time2 = static_cast&lt;double&gt;(getTickCount());</span></span><br><span class="line">	<span class="comment">//sharpen2D(image, result_sharpen2D);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//time2 = (static_cast&lt;double&gt;(getTickCount()) - time2) / getTickFrequency();</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "time_sharpen2D = " &lt;&lt; time2 &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("sharpen2D_Image", result_sharpen2D);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//4.增加图片</span></span><br><span class="line">	<span class="comment">//Mat image1;</span></span><br><span class="line">	<span class="comment">//Mat image2;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//image1 = imread("./images/boldt.jpg");</span></span><br><span class="line">	<span class="comment">//image2 = imread("./images/rain.jpg");</span></span><br><span class="line">	<span class="comment">//if (!image1.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//if (!image2.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Image1", image1);</span></span><br><span class="line">	<span class="comment">//imshow("Image2", image2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat result;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//addWeighted(image1, 0.7, image2, 0.9, 0, result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("result", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////using over loaded operator</span></span><br><span class="line">	<span class="comment">////result = 0.7 * image1 + 0.9 * image2;</span></span><br><span class="line">	<span class="comment">////imshow("result with operators", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//image2 = imread("./images/rain.jpg", 0);</span></span><br><span class="line">	<span class="comment">////imshow("image2_rain", image2);</span></span><br><span class="line">	<span class="comment">//vector&lt;Mat&gt; planes;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//split(image1, planes);</span></span><br><span class="line">	<span class="comment">////aadd to blue channel</span></span><br><span class="line">	<span class="comment">//planes[0] += image2;</span></span><br><span class="line">	<span class="comment">////merge the 3 1-channel images into 1 3-channel image</span></span><br><span class="line">	<span class="comment">//merge(planes, result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Blue channel", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//5.减少图片中颜色的数量</span></span><br><span class="line"></span><br><span class="line">	Mat image = imread(<span class="string">"./images/boldt.jpg"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// time and process the image</span></span><br><span class="line">	<span class="keyword">const</span> int64 start = getTickCount();</span><br><span class="line">	colorReduce(image, <span class="number">64</span>);</span><br><span class="line">	<span class="comment">//Elapsed time in seconds</span></span><br><span class="line">	<span class="keyword">double</span> duration = (getTickCount() - start) / getTickFrequency();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// display the image</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"Duration= "</span> &lt;&lt; duration &lt;&lt; <span class="string">"secs"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	namedWindow(<span class="string">"Image"</span>);</span><br><span class="line">	imshow(<span class="string">"Image"</span>, image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// test different versions of the function</span></span><br><span class="line"></span><br><span class="line">	int64 t[NTESTS], tinit;</span><br><span class="line">	<span class="comment">// timer values set to 0</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;NTESTS; i++)</span><br><span class="line">		t[i] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	Mat images[NTESTS];</span><br><span class="line">	Mat result;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// the versions to be tested</span></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(*FunctionPointer)</span><span class="params">(Mat, <span class="keyword">int</span>)</span></span>;</span><br><span class="line">	FunctionPointer functions[NTESTS] = &#123; colorReduce, colorReduce1, colorReduce2, colorReduce3, colorReduce4,</span><br><span class="line">		colorReduce5, colorReduce6, colorReduce7, colorReduce8, colorReduce9,</span><br><span class="line">		colorReduce10, colorReduce11, colorReduce12, colorReduce13, colorReduce14 &#125;;</span><br><span class="line">	<span class="comment">// repeat the tests several times</span></span><br><span class="line">	<span class="keyword">int</span> n = NITERATIONS;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k&lt;n; k++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; k &lt;&lt; <span class="string">" of "</span> &lt;&lt; n &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// test each version</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; NTESTS; c++) &#123;</span><br><span class="line"></span><br><span class="line">			images[c] = imread(<span class="string">"./images/boldt.jpg"</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// set timer and call function</span></span><br><span class="line">			tinit = getTickCount();</span><br><span class="line">			functions[c](images[c], <span class="number">64</span>);</span><br><span class="line">			t[c] += getTickCount() - tinit;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"."</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// short description of each function</span></span><br><span class="line">	<span class="built_in">string</span> descriptions[NTESTS] = &#123;</span><br><span class="line">		<span class="string">"original version:"</span>,</span><br><span class="line">		<span class="string">"with dereference operator:"</span>,</span><br><span class="line">		<span class="string">"using modulo operator:"</span>,</span><br><span class="line">		<span class="string">"using a binary mask:"</span>,</span><br><span class="line">		<span class="string">"direct ptr arithmetic:"</span>,</span><br><span class="line">		<span class="string">"row size recomputation:"</span>,</span><br><span class="line">		<span class="string">"continuous image:"</span>,</span><br><span class="line">		<span class="string">"reshape continuous image:"</span>,</span><br><span class="line">		<span class="string">"with iterators:"</span>,</span><br><span class="line">		<span class="string">"Vec3b iterators:"</span>,</span><br><span class="line">		<span class="string">"iterators and mask:"</span>,</span><br><span class="line">		<span class="string">"iterators from Mat_:"</span>,</span><br><span class="line">		<span class="string">"at method:"</span>,</span><br><span class="line">		<span class="string">"overloaded operators:"</span>,</span><br><span class="line">		<span class="string">"look-up table:"</span>,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NTESTS; i++) &#123;</span><br><span class="line"></span><br><span class="line">		namedWindow(descriptions[i]);</span><br><span class="line">		imshow(descriptions[i], images[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// print average execution time</span></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="string">"-------------------------------------------"</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NTESTS; i++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">". "</span> &lt;&lt; descriptions[i] &lt;&lt; <span class="number">1000.</span>*t[i] / getTickFrequency() / n &lt;&lt; <span class="string">"ms"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.使用flip来进行水平垂直方向的改变<br>2.使用putText添加文本<br>3.使用椒盐噪声<br>4.减色函数clolrReduce</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line">Mat srcImage;</span><br><span class="line">Mat result_1, result_0, result;</span><br><span class="line">Mat src_gray_img;</span><br><span class="line"></span><br><span class="line"><span class="comment">////3.椒盐噪声</span></span><br><span class="line"><span class="comment">//void salt(Mat image, int n)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	//C++11的随机生成器</span></span><br><span class="line"><span class="comment">//	default_random_engine generator;</span></span><br><span class="line"><span class="comment">//	uniform_int_distribution&lt;int&gt; randomRow(0, image.rows - 1);</span></span><br><span class="line"><span class="comment">//	uniform_int_distribution&lt;int&gt; randomCol(0, image.cols - 1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	int i, j;</span></span><br><span class="line"><span class="comment">//	for (int k = 0; k &lt; n; k++)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		//随机生成图形位置</span></span><br><span class="line"><span class="comment">//		i = randomCol(generator);</span></span><br><span class="line"><span class="comment">//		j = randomRow(generator);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		if (image.type() == CV_8UC1) // 灰度图像</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			//单通道8位图像</span></span><br><span class="line"><span class="comment">//			image.at&lt;uchar&gt;(j, i) = 255;</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//		else if (image.type() == CV_8UC3) //彩色图像</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			//3通道图像</span></span><br><span class="line"><span class="comment">//			image.at&lt;Vec3b&gt;(j, i)[0] = 255;</span></span><br><span class="line"><span class="comment">//			image.at&lt;Vec3b&gt;(j, i)[1] = 255;</span></span><br><span class="line"><span class="comment">//			image.at&lt;Vec3b&gt;(j, i)[2] = 255;</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.减色函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">colorReduce</span><span class="params">(Mat image, <span class="keyword">int</span> div = <span class="number">64</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nr = image.rows; <span class="comment">//行数</span></span><br><span class="line">	<span class="comment">//每一行的元素</span></span><br><span class="line">	<span class="keyword">int</span> nc = image.cols * image.channels();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; nr; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//取的行j的地址</span></span><br><span class="line">		uchar *data = image.ptr&lt;uchar&gt;(j);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nc; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//处理每一个元素</span></span><br><span class="line">			data[i] = data[i] / div * div + div / <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	srcImage = imread(<span class="string">"1.jpg"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (srcImage.empty())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"srcImage is error !"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"srcImage"</span>, srcImage);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.调用椒盐噪声</span></span><br><span class="line">	<span class="comment">//salt(srcImage, 3000);</span></span><br><span class="line">	<span class="comment">//imshow("srcImage_salt", srcImage);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//4.减色函数</span></span><br><span class="line">	colorReduce(srcImage, <span class="number">64</span>);</span><br><span class="line">	imshow(<span class="string">"srcImage_colorreduce"</span>, srcImage);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//src_gray_img = imread("1.jpg", IMREAD_GRAYSCALE);</span></span><br><span class="line">	<span class="comment">//imshow("src_grat_img", src_gray_img);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//1.使用flip来进行水平垂直方向的改变</span></span><br><span class="line">	<span class="comment">//flip(srcImage, result_1, 1); //正数表示水平</span></span><br><span class="line">	<span class="comment">//flip(srcImage, result_0, 0); //0表示垂直</span></span><br><span class="line">	<span class="comment">//flip(srcImage, result, -1); //负数表示水平和垂直</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2.使用putText添加文本</span></span><br><span class="line">	<span class="comment">//putText(result_1, "Wangdasha is ppp", Point(4, 200), FONT_HERSHEY_PLAIN, 2.0, 125, 2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("result_1", result_1);</span></span><br><span class="line">	<span class="comment">//imshow("result_0", result_0);</span></span><br><span class="line">	<span class="comment">//imshow("result", result);</span></span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-03-处理图像的颜色"><a href="#Chapter-03-处理图像的颜色" class="headerlink" title="Chapter_03 : 处理图像的颜色"></a>Chapter_03 : 处理图像的颜色</h3><blockquote>
<p>1.用策略设计模式比较颜色<br>2.用GrabCut算法分割图像<br>3.用色调、饱和度、和亮度表示颜色</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ColorDetector.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.用色调、饱和度、和亮度表示颜色 ---- 检测肤色</span></span><br><span class="line">       <span class="comment">//输入图像  色调区间  饱和度区间  输出掩码</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">detectHScolor</span><span class="params">(<span class="keyword">const</span> Mat&amp; image, <span class="keyword">double</span> minHue, <span class="keyword">double</span> maxHue, <span class="keyword">double</span> minSat, <span class="keyword">double</span> maxSat, Mat &amp;mask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//转到HSV空间</span></span><br><span class="line">	Mat hsv;</span><br><span class="line">	cvtColor(image, hsv, CV_BGR2HSV);</span><br><span class="line">	<span class="comment">//将3通道分割成3幅图像</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Mat&gt; channels;</span><br><span class="line">	split(hsv, channels);</span><br><span class="line">	<span class="comment">//色调掩码</span></span><br><span class="line">	Mat mask1;  <span class="comment">//小于maxHue</span></span><br><span class="line">	threshold(channels[<span class="number">0</span>], mask1, maxHue, <span class="number">255</span>, THRESH_BINARY_INV);</span><br><span class="line">	Mat mask2; <span class="comment">//大于minHue</span></span><br><span class="line">	threshold(channels[<span class="number">0</span>], mask2, minHue, <span class="number">255</span>, THRESH_BINARY);</span><br><span class="line"></span><br><span class="line">	Mat hueMask; <span class="comment">//色调掩码</span></span><br><span class="line">	<span class="keyword">if</span> (minHue &lt; maxHue)</span><br><span class="line">		hueMask = mask1 &amp; mask2;</span><br><span class="line">	<span class="keyword">else</span> <span class="comment">//如果区间穿越0度中轴线</span></span><br><span class="line">		hueMask = mask1 | mask2;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//饱和度掩码</span></span><br><span class="line">	<span class="comment">//从minSat 到 maxSat</span></span><br><span class="line">	<span class="comment">//threshold(channels[1], mask1, maxSat, 255, THRESH_BINARY_INV);</span></span><br><span class="line">	<span class="comment">//threshold(channels[1], mask2, minSat, 255, THRESH_BINARY);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat satMask;</span></span><br><span class="line">	<span class="comment">//satMask = mask1 &amp; mask2;</span></span><br><span class="line"></span><br><span class="line">	Mat satMask;</span><br><span class="line">	inRange(channels[<span class="number">1</span>], minSat, maxSat, satMask);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//组合掩码</span></span><br><span class="line">	mask = hueMask &amp; satMask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">////1.用策略设计模式比较颜色</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////创建图像处理器对象</span></span><br><span class="line">	<span class="comment">//ColorDetector cdetect;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////读取图像</span></span><br><span class="line">	<span class="comment">//Mat image = imread("./images/boldt.jpg");</span></span><br><span class="line">	<span class="comment">//if (image.empty())</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("image", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////设置输入参数</span></span><br><span class="line">	<span class="comment">//cdetect.setTargetColor(230, 190, 130); // 这里表示蓝天</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////处理图像并显示结果</span></span><br><span class="line">	<span class="comment">//Mat result = cdetect.process(image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("result", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// or using functor</span></span><br><span class="line">	<span class="comment">//// here distance is measured with the Lab color space</span></span><br><span class="line">	<span class="comment">//ColorDetector colordetector(230, 190, 130,  // color</span></span><br><span class="line">	<span class="comment">//	45, true); // Lab threshold</span></span><br><span class="line">	<span class="comment">//namedWindow("result (functor)");</span></span><br><span class="line">	<span class="comment">//result = colordetector(image);</span></span><br><span class="line">	<span class="comment">//imshow("result (functor)", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// testing floodfill</span></span><br><span class="line">	<span class="comment">//floodFill(image,            // input/ouput image</span></span><br><span class="line">	<span class="comment">//	Point(100, 50),         // seed point</span></span><br><span class="line">	<span class="comment">//	Scalar(255, 255, 255),  // repainted color</span></span><br><span class="line">	<span class="comment">//	(Rect*)0,  // bounding rectangle of the repainted pixel set</span></span><br><span class="line">	<span class="comment">//	Scalar(35, 35, 35),     // low and high difference threshold</span></span><br><span class="line">	<span class="comment">//	Scalar(35, 35, 35),     // most of the time will be identical</span></span><br><span class="line">	<span class="comment">//	FLOODFILL_FIXED_RANGE); // pixels are compared to seed color</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//namedWindow("Flood Fill result");</span></span><br><span class="line">	<span class="comment">//result = colordetector(image);</span></span><br><span class="line">	<span class="comment">//imshow("Flood Fill result", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Creating artificial images to demonstrate color space properties</span></span><br><span class="line">	<span class="comment">//Mat colors(100, 300, CV_8UC3, Scalar(100, 200, 150));</span></span><br><span class="line">	<span class="comment">//Mat range = colors.colRange(0, 100);</span></span><br><span class="line">	<span class="comment">//range = range + Scalar(10, 10, 10);</span></span><br><span class="line">	<span class="comment">//range = colors.colRange(200, 300);</span></span><br><span class="line">	<span class="comment">//range = range + Scalar(-10, -10, 10);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//namedWindow("3 colors");</span></span><br><span class="line">	<span class="comment">//imshow("3 colors", colors);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat labImage(100, 300, CV_8UC3, Scalar(100, 200, 150));</span></span><br><span class="line">	<span class="comment">//cvtColor(labImage, labImage, CV_BGR2Lab);</span></span><br><span class="line">	<span class="comment">//range = colors.colRange(0, 100);</span></span><br><span class="line">	<span class="comment">//range = range + Scalar(10, 10, 10);</span></span><br><span class="line">	<span class="comment">//range = colors.colRange(200, 300);</span></span><br><span class="line">	<span class="comment">//range = range + Scalar(-10, -10, 10);</span></span><br><span class="line">	<span class="comment">//cvtColor(labImage, labImage, CV_Lab2BGR);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//namedWindow("3 colors (Lab)");</span></span><br><span class="line">	<span class="comment">//imshow("3 colors (Lab)", colors);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// brightness versus luminance</span></span><br><span class="line">	<span class="comment">//Mat grayLevels(100, 256, CV_8UC3);</span></span><br><span class="line">	<span class="comment">//for (int i = 0; i &lt; 256; i++) &#123;</span></span><br><span class="line">	<span class="comment">//	grayLevels.col(i) = Scalar(i, i, i);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//range = grayLevels.rowRange(50, 100);</span></span><br><span class="line">	<span class="comment">//Mat channels[3];</span></span><br><span class="line">	<span class="comment">//split(range, channels);</span></span><br><span class="line">	<span class="comment">//channels[1] = 128;</span></span><br><span class="line">	<span class="comment">//channels[2] = 128;</span></span><br><span class="line">	<span class="comment">//merge(channels, 3, range);</span></span><br><span class="line">	<span class="comment">//cvtColor(range, range, CV_Lab2BGR);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//namedWindow("Luminance vs Brightness");</span></span><br><span class="line">	<span class="comment">//imshow("Luminance vs Brightness", grayLevels);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2.用GrabCut算法分割图像</span></span><br><span class="line">	<span class="comment">//Mat image = imread("./images/boldt.jpg");</span></span><br><span class="line">	<span class="comment">//if (image.empty())</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("image", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Rect rectangle(5, 70, 260, 120);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat result;</span></span><br><span class="line">	<span class="comment">//Mat bg, fg;</span></span><br><span class="line">	<span class="comment">////GrabCut分割算法</span></span><br><span class="line">	<span class="comment">//grabCut(image, result, rectangle, bg, fg, 5, GC_INIT_WITH_RECT);</span></span><br><span class="line">	<span class="comment">////取得标记可能为前景的像素</span></span><br><span class="line">	<span class="comment">//compare(result, GC_PR_FGD, result, CMP_EQ);</span></span><br><span class="line">	<span class="comment">////生成输出图像</span></span><br><span class="line">	<span class="comment">//Mat foreground(image.size(), CV_8UC3, Scalar(255, 255, 255));</span></span><br><span class="line">	<span class="comment">//image.copyTo(foreground, result);        //A.copyTo(B, mask);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("foreground", foreground);</span></span><br><span class="line">	<span class="comment">//imshow("result", result);</span></span><br><span class="line">	<span class="comment">//imshow("image_copy", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.用色调、饱和度、和亮度表示颜色</span></span><br><span class="line">	Mat image = imread(<span class="string">"./images/boldt.jpg"</span>);</span><br><span class="line">	<span class="keyword">if</span> (image.empty())</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"image"</span>, image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//转换成HSV</span></span><br><span class="line">	Mat hsv;</span><br><span class="line">	cvtColor(image, hsv, CV_BGR2HSV);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"hsv"</span>, hsv);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//把三个通道放进三个图片中</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Mat&gt; channels;</span><br><span class="line">	split(hsv, channels); <span class="comment">//0-H, 1-S, 2-V</span></span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"H"</span>, channels[<span class="number">0</span>]); <span class="comment">//色调</span></span><br><span class="line">	imshow(<span class="string">"S"</span>, channels[<span class="number">1</span>]); <span class="comment">//饱和度</span></span><br><span class="line">	imshow(<span class="string">"V"</span>, channels[<span class="number">2</span>]); <span class="comment">//亮度</span></span><br><span class="line"></span><br><span class="line">	Mat newImage;</span><br><span class="line">	<span class="function">Mat <span class="title">tmp</span><span class="params">(channels[<span class="number">2</span>].clone())</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//改变亮度（V）</span></span><br><span class="line">	channels[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">	merge(channels, hsv);</span><br><span class="line">	cvtColor(hsv, newImage, CV_HSV2BGR);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"newImage_V"</span>, newImage);</span><br><span class="line">	<span class="comment">//改变饱和度（S）</span></span><br><span class="line">	channels[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">	channels[<span class="number">2</span>] = tmp;</span><br><span class="line">	merge(channels, hsv);</span><br><span class="line">	cvtColor(hsv, newImage, CV_HSV2BGR);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"newImage_S"</span>, newImage);</span><br><span class="line">    <span class="comment">//亮度、饱和度一起改变</span></span><br><span class="line">	channels[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">	channels[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">	merge(channels, hsv);</span><br><span class="line">	cvtColor(hsv, newImage, CV_HSV2BGR);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"newImage_SV"</span>, newImage);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//展现出所有的HS颜色</span></span><br><span class="line">	<span class="function">Mat <span class="title">hs</span><span class="params">(<span class="number">128</span>, <span class="number">360</span>, CV_8UC3)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; <span class="number">360</span>; h++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">0</span>; s &lt; <span class="number">128</span>; s++)</span><br><span class="line">		&#123;</span><br><span class="line">			hs.at&lt;Vec3b&gt;(s, h)[<span class="number">0</span>] = h / <span class="number">2</span>;</span><br><span class="line">			hs.at&lt;Vec3b&gt;(s, h)[<span class="number">1</span>] = <span class="number">255</span> - s * <span class="number">2</span>; <span class="comment">//从高到低</span></span><br><span class="line">			hs.at&lt;Vec3b&gt;(s, h)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cvtColor(hs, newImage, CV_HSV2BGR);</span><br><span class="line">	imshow(<span class="string">"newImage_hs"</span>, newImage);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//肤色检测</span></span><br><span class="line">	image = cv::imread(<span class="string">"./images/girl.jpg"</span>);</span><br><span class="line">	<span class="keyword">if</span> (!image.data)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"girl"</span>, image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//检测肤色</span></span><br><span class="line">	Mat mask;</span><br><span class="line">	detectHScolor(image, <span class="number">160</span>, <span class="number">10</span>, <span class="number">25</span>, <span class="number">166</span>, mask); <span class="comment">//色调为320度- 20度 饱和度为~0.1 到 0.65</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//显示使用掩码后的图像</span></span><br><span class="line">	<span class="function">Mat <span class="title">detected</span><span class="params">(image.size(), CV_8UC3, Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">	image.copyTo(detected, mask);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"detected"</span>, detected);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// A test comparing luminance and brightness</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// create linear intensity image</span></span><br><span class="line">	<span class="function">Mat <span class="title">linear</span><span class="params">(<span class="number">100</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">		linear.col(i) = i;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create a Lab image</span></span><br><span class="line">	linear.copyTo(channels[<span class="number">0</span>]);</span><br><span class="line">	<span class="function">Mat <span class="title">constante</span><span class="params">(<span class="number">100</span>, <span class="number">256</span>, CV_8U, Scalar(<span class="number">128</span>))</span></span>;</span><br><span class="line">	constante.copyTo(channels[<span class="number">1</span>]);</span><br><span class="line">	constante.copyTo(channels[<span class="number">2</span>]);</span><br><span class="line">	merge(channels, image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// convert back to BGR</span></span><br><span class="line">	Mat brightness;</span><br><span class="line">	cvtColor(image, brightness, CV_Lab2BGR);</span><br><span class="line">	split(brightness, channels);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create combined image</span></span><br><span class="line">	<span class="function">Mat <span class="title">combined</span><span class="params">(<span class="number">200</span>, <span class="number">256</span>, CV_8U)</span></span>;</span><br><span class="line">	<span class="function">Mat <span class="title">half1</span><span class="params">(combined, Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">256</span>, <span class="number">100</span>))</span></span>;</span><br><span class="line">	linear.copyTo(half1);</span><br><span class="line">	<span class="function">Mat <span class="title">half2</span><span class="params">(combined, Rect(<span class="number">0</span>, <span class="number">100</span>, <span class="number">256</span>, <span class="number">100</span>))</span></span>;</span><br><span class="line">	channels[<span class="number">0</span>].copyTo(half2);</span><br><span class="line"></span><br><span class="line">	namedWindow(<span class="string">"Luminance vs Brightness"</span>);</span><br><span class="line">	imshow(<span class="string">"Luminance vs Brightness"</span>, combined);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined COLORDETECT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COLORDETECT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColorDetector</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">//允许的最小差距</span></span><br><span class="line">	<span class="keyword">int</span> maxDist;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//目标颜色</span></span><br><span class="line">	Vec3b target;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//image containing color converted image</span></span><br><span class="line">	Mat converted;</span><br><span class="line">	<span class="keyword">bool</span> useLab;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//存储二值映射结果的图像</span></span><br><span class="line">	Mat result;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//空的构造函数</span></span><br><span class="line">	ColorDetector() : maxDist(<span class="number">100</span>), target(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), useLab(<span class="literal">false</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	ColorDetector(<span class="keyword">bool</span> useLab) : maxDist(<span class="number">100</span>), target(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), useLab(useLab) &#123;&#125;</span><br><span class="line">	<span class="comment">//另一只构造函数，使用目标颜色和颜色距离作为参数</span></span><br><span class="line">	ColorDetector(uchar blue, uchar green, uchar red, <span class="keyword">int</span> mxDist = <span class="number">100</span>, <span class="keyword">bool</span> useLab = <span class="literal">false</span>) :</span><br><span class="line">		maxDist(mxDist), useLab(useLab) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//target color </span></span><br><span class="line">		setTargetColor(blue, green, red);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算与目标颜色的差距</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getDistanceToTargetColor</span><span class="params">(<span class="keyword">const</span> Vec3b&amp; color)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getColorDistance(color, target);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算两个颜色之间的城区距离</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getColorDistance</span><span class="params">(<span class="keyword">const</span> Vec3b&amp; color1, <span class="keyword">const</span> Vec3b &amp;color2)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">abs</span>(color1[<span class="number">0</span>] - color2[<span class="number">0</span>]) + <span class="built_in">abs</span>(color1[<span class="number">1</span>] - color2[<span class="number">1</span>]) + <span class="built_in">abs</span>(color1[<span class="number">2</span>] - color2[<span class="number">2</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Mat <span class="title">process</span><span class="params">(<span class="keyword">const</span> Mat &amp;image)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Mat <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> Mat &amp;image)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		Mat input;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (useLab)</span><br><span class="line">		&#123;</span><br><span class="line">			cvtColor(image, input, CV_BGR2Lab);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			input = image;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Mat output;</span><br><span class="line">		<span class="comment">//compute absolute difference with target color</span></span><br><span class="line">		absdiff(input, Scalar(target), output);</span><br><span class="line">		<span class="comment">//split the channel into 3 images</span></span><br><span class="line">		<span class="built_in">vector</span>&lt;Mat&gt; images;</span><br><span class="line">		split(output, images);</span><br><span class="line">		<span class="comment">//add the 3 channels (saturation might occurs here)</span></span><br><span class="line">		output = images[<span class="number">0</span>] + images[<span class="number">1</span>] + images[<span class="number">2</span>];</span><br><span class="line">		<span class="comment">//apply threshold</span></span><br><span class="line">		threshold(output, output, maxDist, <span class="number">255</span>, THRESH_BINARY_INV);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> output;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Getters and setters</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置颜色差距的阈值</span></span><br><span class="line">	<span class="comment">//阈值必须是正数，否则就设置为0</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setColorDistanceThreshold</span><span class="params">(<span class="keyword">int</span> distance)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (distance &lt; <span class="number">0</span>)</span><br><span class="line">			distance = <span class="number">0</span>;</span><br><span class="line">		maxDist = distance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//取得颜色差距的阈值</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getColorDistanceThreshold</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> maxDist;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置需要检测的颜色</span></span><br><span class="line">	<span class="comment">//given in BGR color space</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setTargetColor</span><span class="params">(uchar blue, uchar green, uchar red)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//次序为BGR</span></span><br><span class="line">		target = Vec3b(blue, green, red);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (useLab)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//Temporary 1-pixel image</span></span><br><span class="line">			<span class="function">Mat <span class="title">tmp</span><span class="params">(<span class="number">1</span>, <span class="number">1</span>, CV_8UC3)</span></span>;</span><br><span class="line">			tmp.at&lt;Vec3b&gt;(<span class="number">0</span>, <span class="number">0</span>) = Vec3b(blue, green, red);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//Converting the target to Lab color space</span></span><br><span class="line">			cvtColor(tmp, tmp, CV_BGR2Lab);</span><br><span class="line"></span><br><span class="line">			target = tmp.at&lt;Vec3b&gt;(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置需要检测的颜色</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setTargetColor</span><span class="params">(Vec3b color)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		target = color;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//取得需要检测的颜色</span></span><br><span class="line">	<span class="function">Vec3b <span class="title">getTargetColor</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> target;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined COLORDETECT</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ColorDetector.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line">Mat ColorDetector::process(<span class="keyword">const</span> Mat &amp;image)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//必要时重新分配二值映射</span></span><br><span class="line">	<span class="comment">//与输入图像的尺寸相同，不过是单通道</span></span><br><span class="line">	result.create(image.size(), CV_8U);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Converting to Lab color space </span></span><br><span class="line">	<span class="keyword">if</span> (useLab)</span><br><span class="line">		cvtColor(image, converted, CV_BGR2Lab);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 取得迭代器</span></span><br><span class="line">	Mat_&lt;Vec3b&gt;::const_iterator it = image.begin&lt;Vec3b&gt;();</span><br><span class="line">	Mat_&lt;Vec3b&gt;::const_iterator itend = image.end&lt;Vec3b&gt;();</span><br><span class="line">	Mat_&lt;uchar&gt;::iterator itout = result.begin&lt;uchar&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// get the iterators of the converted image </span></span><br><span class="line">	<span class="keyword">if</span> (useLab) &#123;</span><br><span class="line">		it = converted.begin&lt;Vec3b&gt;();</span><br><span class="line">		itend = converted.end&lt;Vec3b&gt;();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对于每一个像素</span></span><br><span class="line">	<span class="keyword">for</span> (; it != itend; ++it, ++itout) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//比较与目标颜色的差距</span></span><br><span class="line">		<span class="keyword">if</span> (getDistanceToTargetColor(*it)&lt;maxDist) &#123;</span><br><span class="line"></span><br><span class="line">			*itout = <span class="number">255</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			*itout = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// end of pixel processing ----------------</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-04-用直方图统计像素"><a href="#Chapter-04-用直方图统计像素" class="headerlink" title="Chapter_04 : 用直方图统计像素"></a>Chapter_04 : 用直方图统计像素</h3><blockquote>
<p>计算图像直方图</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#include "Histogram1D.h"</span></span><br><span class="line"><span class="comment">//#include "ContentFinder.h"</span></span><br><span class="line"><span class="comment">//#include  "ColorHistogram.h"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	//读入图像，并转成灰度图</span></span><br><span class="line"><span class="comment">//	Mat image = imread("./images/waves.jpg", 0);</span></span><br><span class="line"><span class="comment">//	if (!image.data)</span></span><br><span class="line"><span class="comment">//		return 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("image", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	Mat imageROI;</span></span><br><span class="line"><span class="comment">//	imageROI = image(Rect(216, 33, 24, 30)); //设置感兴趣区域</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("imageROI", imageROI);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//直方图对象</span></span><br><span class="line"><span class="comment">//	//计算直方图</span></span><br><span class="line"><span class="comment">//	Histogram1D h;</span></span><br><span class="line"><span class="comment">//	//计算直方图</span></span><br><span class="line"><span class="comment">//	Mat hist = h.getHistogram(imageROI);</span></span><br><span class="line"><span class="comment">//	imshow("Histogram1D", h.getHistogramImage(imageROI));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//创建内容搜寻器</span></span><br><span class="line"><span class="comment">//	ContentFinder finder;</span></span><br><span class="line"><span class="comment">//	//设置用来反向投影的直方图</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// set histogram to be back-projected</span></span><br><span class="line"><span class="comment">//	finder.setHistogram(hist);</span></span><br><span class="line"><span class="comment">//	finder.setThreshold(-1.0f);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get back-projection</span></span><br><span class="line"><span class="comment">//	cv::Mat result1;</span></span><br><span class="line"><span class="comment">//	result1 = finder.find(image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Create negative image and display result</span></span><br><span class="line"><span class="comment">//	cv::Mat tmp;</span></span><br><span class="line"><span class="comment">//	result1.convertTo(tmp, CV_8U, -1.0, 255.0);</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Backprojection result");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Backprojection result", tmp);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get binary back-projection</span></span><br><span class="line"><span class="comment">//	finder.setThreshold(0.12f);</span></span><br><span class="line"><span class="comment">//	result1 = finder.find(image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Draw a rectangle around the reference area</span></span><br><span class="line"><span class="comment">//	cv::rectangle(image, cv::Rect(216, 33, 24, 30), cv::Scalar(0, 0, 0));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display image</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Image");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Image", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display result</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Detection Result");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Detection Result", result1);</span></span><br><span class="line"><span class="comment">//	</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//装载彩色图片</span></span><br><span class="line"><span class="comment">//	ColorHistogram hc;</span></span><br><span class="line"><span class="comment">//	Mat color = imread("./images/waves.jpg");</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("color", color);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//提取ROI</span></span><br><span class="line"><span class="comment">//	imageROI = color(Rect(0, 0, 100, 45));  //蓝色天空的区域</span></span><br><span class="line"><span class="comment">//    //获取3D颜色直方图（每个通道适合8个箱子）</span></span><br><span class="line"><span class="comment">//	hc.setSize(8);        //8 * 8 * 8</span></span><br><span class="line"><span class="comment">//	Mat shist = hc.getHistogram(imageROI);</span></span><br><span class="line"><span class="comment">//	//创建内容搜寻器</span></span><br><span class="line"><span class="comment">//	//设置用来反向投影的直方图</span></span><br><span class="line"><span class="comment">//	finder.setHistogram(shist);</span></span><br><span class="line"><span class="comment">//	finder.setThreshold(0.05f);</span></span><br><span class="line"><span class="comment">//	//取得颜色直方图的反向投影</span></span><br><span class="line"><span class="comment">//	result1 = finder.find(color);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("result1", result1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//装载彩色图片</span></span><br><span class="line"><span class="comment">//	Mat color2 = imread("./images/dog.jpg");</span></span><br><span class="line"><span class="comment">//	imshow("color2", color2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	Mat result2 = finder.find(color2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("result2", result2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get ab color histogram</span></span><br><span class="line"><span class="comment">//	hc.setSize(256); // 256x256</span></span><br><span class="line"><span class="comment">//	cv::Mat colorhist = hc.getabHistogram(imageROI);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// display 2D histogram</span></span><br><span class="line"><span class="comment">//	colorhist.convertTo(tmp, CV_8U, -1.0, 255.0);</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("ab histogram");</span></span><br><span class="line"><span class="comment">//	cv::imshow("ab histogram", tmp);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// set histogram to be back - projected</span></span><br><span class="line"><span class="comment">//	finder.setHistogram(colorhist);</span></span><br><span class="line"><span class="comment">//	finder.setThreshold(0.05f);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Convert to Lab space</span></span><br><span class="line"><span class="comment">//	cv::Mat lab;</span></span><br><span class="line"><span class="comment">//	cv::cvtColor(color, lab, CV_BGR2Lab);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get back-projection of ab histogram</span></span><br><span class="line"><span class="comment">//	int ch[2] = &#123; 1,2 &#125;;</span></span><br><span class="line"><span class="comment">//	result1 = finder.find(lab, 0, 256.0f, ch);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Result ab (1)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Result ab (1)", result1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Second colour image</span></span><br><span class="line"><span class="comment">//	cv::cvtColor(color2, lab, CV_BGR2Lab);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get back-projection of ab histogram</span></span><br><span class="line"><span class="comment">//	result2 = finder.find(lab, 0, 256.0, ch);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Result ab (2)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Result ab (2)", result2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Draw a rectangle around the reference sky area</span></span><br><span class="line"><span class="comment">//	cv::rectangle(color, cv::Rect(0, 0, 100, 45), cv::Scalar(0, 0, 0));</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Color Image");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Color Image", color);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get Hue colour histogram</span></span><br><span class="line"><span class="comment">//	hc.setSize(180); // 180 bins</span></span><br><span class="line"><span class="comment">//	colorhist = hc.getHueHistogram(imageROI);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// set histogram to be back-projected</span></span><br><span class="line"><span class="comment">//	finder.setHistogram(colorhist);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Convert to HSV space</span></span><br><span class="line"><span class="comment">//	cv::Mat hsv;</span></span><br><span class="line"><span class="comment">//	cv::cvtColor(color, hsv, CV_BGR2HSV);</span></span><br><span class="line"><span class="comment">//	// Get back-projection of hue histogram</span></span><br><span class="line"><span class="comment">//	ch[0] = 0;</span></span><br><span class="line"><span class="comment">//	result1 = finder.find(hsv, 0.0f, 180.0f, ch);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Result Hue (1)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Result Hue (1)", result1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Second colour image</span></span><br><span class="line"><span class="comment">//	//color2 = cv::imread("./images/dog.jpg");</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Convert to HSV space</span></span><br><span class="line"><span class="comment">//	//cv::cvtColor(color2, hsv, CV_BGR2HSV);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Get back-projection of hue histogram</span></span><br><span class="line"><span class="comment">//	//result2 = finder.find(hsv, 0.0f, 180.0f, ch);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Result Hue (2)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Result Hue (2)", result2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined HISTOGRAM</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HISTOGRAM</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建灰度图像的直方图</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Histogram1D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> histSize[<span class="number">1</span>];        <span class="comment">//直方图中箱子的数量</span></span><br><span class="line">	<span class="keyword">float</span> hranges[<span class="number">2</span>];       <span class="comment">//值范围</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">float</span> *ranges[<span class="number">1</span>]; <span class="comment">//值范围的指针</span></span><br><span class="line">	<span class="keyword">int</span> channels[<span class="number">1</span>];        <span class="comment">//要检查的通道数量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Histogram1D()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//准备一维直方图的默认参数</span></span><br><span class="line">		histSize[<span class="number">0</span>] = <span class="number">256</span>;    <span class="comment">//256个箱子</span></span><br><span class="line">		hranges[<span class="number">0</span>] = <span class="number">0.0</span>;     <span class="comment">//从0开始（包含0）</span></span><br><span class="line">		hranges[<span class="number">1</span>] = <span class="number">256.0</span>;   <span class="comment">//到256（不包含256）</span></span><br><span class="line">		ranges[<span class="number">0</span>] = hranges;</span><br><span class="line">		channels[<span class="number">0</span>] = <span class="number">0</span>;      <span class="comment">//先关注通道0</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//void setChannel(int c)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	channels[0] = c;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//int getChannel()</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	return channels[0];</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//void setRange(float minValue, float maxValue)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	hranges[0] = minValue;</span></span><br><span class="line">	<span class="comment">//	hranges[1] = maxValue;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//float getMinValue()</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	return hranges[0];</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//float getMaxValue()</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	return hranges[1];</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//void setNBins(int nbins)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	histSize[0] = nbins;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">////</span></span><br><span class="line">	<span class="comment">//int getNBins()</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	return histSize[0];</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算一维直方图</span></span><br><span class="line">	<span class="function">Mat <span class="title">getHistogram</span><span class="params">(<span class="keyword">const</span> Mat &amp;image)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat hist;</span><br><span class="line">		<span class="comment">//用calcHist函数计算一维直方图</span></span><br><span class="line">		<span class="comment">//一幅图像的直方图   一幅   使用的通道， 不使用掩码  作为结果的直方图  </span></span><br><span class="line">		<span class="comment">//这是一维的直方图  箱子数量  像素值的范围</span></span><br><span class="line">		calcHist(&amp;image, <span class="number">1</span>, channels, Mat(), hist, <span class="number">1</span>, histSize, ranges);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> hist;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算一维直方图，并返回它的图像</span></span><br><span class="line">	<span class="function">Mat <span class="title">getHistogramImage</span><span class="params">(<span class="keyword">const</span> Mat &amp;image, <span class="keyword">int</span> zoom = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//先计算直方图</span></span><br><span class="line">		Mat hist = getHistogram(image);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建图像</span></span><br><span class="line">		<span class="keyword">return</span> Histogram1D::getImageOfHistogram(hist, zoom);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Stretches the source image using min number of count in bins.</span></span><br><span class="line">	<span class="comment">//Mat stretch(const Mat &amp;image, int minValue = 0) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Compute histogram first</span></span><br><span class="line">	<span class="comment">//	Mat hist = getHistogram(image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// find left extremity of the histogram</span></span><br><span class="line">	<span class="comment">//	int imin = 0;</span></span><br><span class="line">	<span class="comment">//	for (; imin &lt; histSize[0]; imin++) &#123;</span></span><br><span class="line">	<span class="comment">//		// ignore bins with less than minValue entries</span></span><br><span class="line">	<span class="comment">//		if (hist.at&lt;float&gt;(imin) &gt; minValue)</span></span><br><span class="line">	<span class="comment">//			break;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// find right extremity of the histogram</span></span><br><span class="line">	<span class="comment">//	int imax = histSize[0] - 1;</span></span><br><span class="line">	<span class="comment">//	for (; imax &gt;= 0; imax--) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//		// ignore bins with less than minValue entries</span></span><br><span class="line">	<span class="comment">//		if (hist.at&lt;float&gt;(imax) &gt; minValue)</span></span><br><span class="line">	<span class="comment">//			break;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Create lookup table</span></span><br><span class="line">	<span class="comment">//	int dims[1] = &#123; 256 &#125;;</span></span><br><span class="line">	<span class="comment">//	Mat lookup(1, dims, CV_8U);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	for (int i = 0; i&lt;256; i++) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//		if (i &lt; imin) lookup.at&lt;uchar&gt;(i) = 0;</span></span><br><span class="line">	<span class="comment">//		else if (i &gt; imax) lookup.at&lt;uchar&gt;(i) = 255;</span></span><br><span class="line">	<span class="comment">//		else lookup.at&lt;uchar&gt;(i) = cvRound(255.0*(i - imin) / (imax - imin));</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Apply lookup table</span></span><br><span class="line">	<span class="comment">//	Mat result;</span></span><br><span class="line">	<span class="comment">//	result = applyLookUp(image, lookup);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	return result;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Stretches the source image using percentile.</span></span><br><span class="line">	<span class="comment">//Mat stretch(const Mat &amp;image, float percentile) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// number of pixels in percentile</span></span><br><span class="line">	<span class="comment">//	float number = image.total() * percentile;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Compute histogram first</span></span><br><span class="line">	<span class="comment">//	Mat hist = getHistogram(image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// find left extremity of the histogram</span></span><br><span class="line">	<span class="comment">//	int imin = 0;</span></span><br><span class="line">	<span class="comment">//	for (float count = 0.0; imin &lt; 256; imin++) &#123;</span></span><br><span class="line">	<span class="comment">//		// number of pixel at imin and below must be &gt; number</span></span><br><span class="line">	<span class="comment">//		if ((count += hist.at&lt;float&gt;(imin)) &gt;= number)</span></span><br><span class="line">	<span class="comment">//			break;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// find right extremity of the histogram</span></span><br><span class="line">	<span class="comment">//	int imax = 255;</span></span><br><span class="line">	<span class="comment">//	for (float count = 0.0; imax &gt;= 0; imax--) &#123;</span></span><br><span class="line">	<span class="comment">//		// number of pixel at imax and below must be &gt; number</span></span><br><span class="line">	<span class="comment">//		if ((count += hist.at&lt;float&gt;(imax)) &gt;= number)</span></span><br><span class="line">	<span class="comment">//			break;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Create lookup table</span></span><br><span class="line">	<span class="comment">//	int dims[1] = &#123; 256 &#125;;</span></span><br><span class="line">	<span class="comment">//	Mat lookup(1, dims, CV_8U);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	for (int i = 0; i&lt;256; i++) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//		if (i &lt; imin) lookup.at&lt;uchar&gt;(i) = 0;</span></span><br><span class="line">	<span class="comment">//		else if (i &gt; imax) lookup.at&lt;uchar&gt;(i) = 255;</span></span><br><span class="line">	<span class="comment">//		else lookup.at&lt;uchar&gt;(i) = cvRound(255.0*(i - imin) / (imax - imin));</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Apply lookup table</span></span><br><span class="line">	<span class="comment">//	Mat result;</span></span><br><span class="line">	<span class="comment">//	result = applyLookUp(image, lookup);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	return result;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建一个表示直方图的图像（静态方法）</span></span><br><span class="line">	<span class="function"><span class="keyword">static</span> Mat <span class="title">getImageOfHistogram</span><span class="params">(<span class="keyword">const</span> Mat &amp;hist, <span class="keyword">int</span> zoom)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//取得箱子值的最大值和最小值</span></span><br><span class="line">		<span class="keyword">double</span> maxVal = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">double</span> minVal = <span class="number">0</span>;</span><br><span class="line">		minMaxLoc(hist, &amp;minVal, &amp;maxVal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//取得直方图的大小</span></span><br><span class="line">		<span class="keyword">int</span> histSize = hist.rows;</span><br><span class="line">		<span class="comment">//用于显示直方图的方形图像</span></span><br><span class="line">		<span class="function">Mat <span class="title">histImg</span><span class="params">(histSize *zoom, histSize *zoom, CV_8U, Scalar(<span class="number">255</span>))</span></span>;</span><br><span class="line">		<span class="comment">//设置最高点为90%（即图像高度）的箱子个数</span></span><br><span class="line">		<span class="keyword">int</span> hpt = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="number">0.9</span> * histSize);</span><br><span class="line">		<span class="comment">//为每个箱子画垂直线</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; histSize; h++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">float</span> binVal = hist.at&lt;<span class="keyword">float</span>&gt;(h);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (binVal &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">int</span> intensity = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(binVal * hpt / maxVal);</span><br><span class="line">				line(histImg, Point(h * zoom, histSize * zoom),</span><br><span class="line">					Point(h * zoom, (histSize - intensity) * zoom), Scalar(<span class="number">0</span>), zoom);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> histImg;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Equalizes the source image.</span></span><br><span class="line">	<span class="comment">//static Mat equalize(const Mat &amp;image) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	Mat result;</span></span><br><span class="line">	<span class="comment">//	equalizeHist(image, result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	return result;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Applies a lookup table transforming an input image into a 1-channel image</span></span><br><span class="line">	<span class="comment">//static Mat applyLookUp(const Mat &amp;image, // input image</span></span><br><span class="line">	<span class="comment">//	const Mat &amp;lookup) &#123; // 1x256 uchar matrix</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//						 // the output image</span></span><br><span class="line">	<span class="comment">//	Mat result;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// apply lookup table</span></span><br><span class="line">	<span class="comment">//	LUT(image, lookup, result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	return result;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Applies a lookup table transforming an input image into a 1-channel image</span></span><br><span class="line">	<span class="comment">//// this is a test version with iterator; always use function cv::LUT</span></span><br><span class="line">	<span class="comment">//static Mat applyLookUpWithIterator(const Mat&amp; image, const Mat&amp; lookup) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Set output image (always 1-channel)</span></span><br><span class="line">	<span class="comment">//	Mat result(image.rows, image.cols, CV_8U);</span></span><br><span class="line">	<span class="comment">//	Mat_&lt;uchar&gt;::iterator itr = result.begin&lt;uchar&gt;();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Iterates over the input image</span></span><br><span class="line">	<span class="comment">//	Mat_&lt;uchar&gt;::const_iterator it = image.begin&lt;uchar&gt;();</span></span><br><span class="line">	<span class="comment">//	Mat_&lt;uchar&gt;::const_iterator itend = image.end&lt;uchar&gt;();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	// Applies lookup to each pixel</span></span><br><span class="line">	<span class="comment">//	for (; it != itend; ++it, ++itr) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//		*itr = lookup.at&lt;uchar&gt;(*it);</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	return result;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined HISTOGRAM</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !<span class="meta-keyword">define</span> OFINDER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OFINDER</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContentFinder</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//直方图参数</span></span><br><span class="line">	<span class="keyword">float</span> hranges[<span class="number">2</span>];</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">float</span> *ranges[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">int</span> channels[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">float</span> threshold;    <span class="comment">//判断阈值</span></span><br><span class="line">	Mat histogram;      <span class="comment">//输入直方图</span></span><br><span class="line">	SparseMat shistogram;</span><br><span class="line">	<span class="keyword">bool</span>  isSparse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	ContentFinder() : threshold(<span class="number">0.1f</span>), isSparse(<span class="literal">false</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//本类中所有的通道的范围相同</span></span><br><span class="line">		ranges[<span class="number">0</span>] = hranges;</span><br><span class="line">		ranges[<span class="number">1</span>] = hranges;</span><br><span class="line">		ranges[<span class="number">2</span>] = hranges;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Sets the threshold on histogram values [0,1]</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setThreshold</span><span class="params">(<span class="keyword">float</span> t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		threshold = t;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Gets the threshold</span></span><br><span class="line">	<span class="function"><span class="keyword">float</span> <span class="title">getThreshold</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> threshold;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置应用的直方图</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setHistogram</span><span class="params">(<span class="keyword">const</span> Mat &amp;h)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		isSparse = <span class="literal">false</span>;</span><br><span class="line">		normalize(h, histogram, <span class="number">1.0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//设置应用的直方图----SparseMat</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setHistogram</span><span class="params">(<span class="keyword">const</span> SparseMat &amp;h)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		isSparse = <span class="literal">true</span>;</span><br><span class="line">		normalize(h, shistogram, <span class="number">1.0</span>, NORM_L2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用全部通道，范围【0， 256】</span></span><br><span class="line">	<span class="function">Mat <span class="title">find</span><span class="params">(<span class="keyword">const</span> Mat &amp;image)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat result;</span><br><span class="line"></span><br><span class="line">		hranges[<span class="number">0</span>] = <span class="number">0.0</span>;    <span class="comment">//默认范围【0， 256】， hranges[1] = 256.0;</span></span><br><span class="line">		hranges[<span class="number">1</span>] = <span class="number">256.0</span>;</span><br><span class="line">		channels[<span class="number">0</span>] = <span class="number">0</span>;     <span class="comment">//三个通道</span></span><br><span class="line">		channels[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">		channels[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> find(image, hranges[<span class="number">0</span>], hranges[<span class="number">1</span>], channels);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//查找属于直方图的像素</span></span><br><span class="line">	<span class="function">Mat <span class="title">find</span><span class="params">(<span class="keyword">const</span> Mat&amp; image, <span class="keyword">float</span> minValue, <span class="keyword">float</span> maxValue, <span class="keyword">int</span> *channels)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat result;</span><br><span class="line">		hranges[<span class="number">0</span>] = minValue;</span><br><span class="line">		hranges[<span class="number">1</span>] = maxValue;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (isSparse)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;shistogram.dims(); i++)</span><br><span class="line">				<span class="keyword">this</span>-&gt;channels[i] = channels[i];</span><br><span class="line"></span><br><span class="line">			calcBackProject(&amp;image,</span><br><span class="line">				<span class="number">1</span>,          <span class="comment">//只使用一幅图像</span></span><br><span class="line">				channels,   <span class="comment">//通道</span></span><br><span class="line">				histogram,  <span class="comment">//直方图</span></span><br><span class="line">				result,     <span class="comment">//反向投影</span></span><br><span class="line">				ranges,     <span class="comment">//每个维度的值范围</span></span><br><span class="line">				<span class="number">255.0</span>       <span class="comment">//选用的换算技术</span></span><br><span class="line">							<span class="comment">//把概率从1映射到255</span></span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//直方图的维度数与通道列表一致</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; histogram.dims; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">this</span>-&gt;channels[i] = channels[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//calcBackProject函数和calcHist函数有些类似，而calcBackProject不会增加箱子的数量，而是从箱子读取的值赋给方向投影图像中对应的像素</span></span><br><span class="line">			calcBackProject(&amp;image,</span><br><span class="line">				<span class="number">1</span>,          <span class="comment">//只使用一幅图像</span></span><br><span class="line">				channels,   <span class="comment">//通道</span></span><br><span class="line">				histogram,  <span class="comment">//直方图</span></span><br><span class="line">				result,     <span class="comment">//反向投影</span></span><br><span class="line">				ranges,     <span class="comment">//每个维度的值范围</span></span><br><span class="line">				<span class="number">255.0</span>       <span class="comment">//选用的换算技术</span></span><br><span class="line">							<span class="comment">//把概率从1映射到255</span></span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//对反射投影结果做阈值化，得到二值图像</span></span><br><span class="line">		<span class="keyword">if</span> (threshold &gt; <span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">			cv::threshold(result, result, <span class="number">255.0</span>*threshold, <span class="number">255.0</span>, cv::THRESH_BINARY);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !define OFINDER</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !<span class="meta-keyword">define</span> COLORHISTOGRAM</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COLORHISTOGRAM</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColorHistogram</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> histSize[<span class="number">3</span>];         <span class="comment">//每个维度的大小</span></span><br><span class="line">	<span class="keyword">float</span> hranges[<span class="number">2</span>];        <span class="comment">//值的大小（三个维度用同一个值）</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">float</span>* ranges[<span class="number">3</span>];  <span class="comment">//每个维度的范围</span></span><br><span class="line">	<span class="keyword">int</span> channels[<span class="number">3</span>];         <span class="comment">//需要处理的通道</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	ColorHistogram()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//准备用于彩色图像的默认参数</span></span><br><span class="line">		<span class="comment">//每个维度的范围和大小是相同的</span></span><br><span class="line">		histSize[<span class="number">0</span>] = histSize[<span class="number">1</span>] = histSize[<span class="number">2</span>] = <span class="number">256</span>;</span><br><span class="line">		hranges[<span class="number">0</span>] = <span class="number">0.0</span>;      <span class="comment">// BGR范围为0-256</span></span><br><span class="line">		hranges[<span class="number">1</span>] = <span class="number">256.0</span>;</span><br><span class="line">		ranges[<span class="number">0</span>] = hranges;   <span class="comment">//这个类中</span></span><br><span class="line">		ranges[<span class="number">1</span>] = hranges;   <span class="comment">//所有通道的范围均相等</span></span><br><span class="line">		ranges[<span class="number">2</span>] = hranges; </span><br><span class="line">		channels[<span class="number">0</span>] = <span class="number">0</span>;           <span class="comment">//三个通道： B</span></span><br><span class="line">		channels[<span class="number">1</span>] = <span class="number">1</span>;           <span class="comment">//G</span></span><br><span class="line">		channels[<span class="number">2</span>] = <span class="number">2</span>;           <span class="comment">//R</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Ã¿¸öÎ¬¶ÈµÃµ½Ö±·½Í¼µÄ´óÐ¡</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setSize</span><span class="params">(<span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//Ã¿¸öÎ¬¶ÈµÄ´óÐ¡¶¼ÏàµÈ</span></span><br><span class="line">		histSize[<span class="number">0</span>] = histSize[<span class="number">1</span>] = histSize[<span class="number">3</span>] = size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算直方图</span></span><br><span class="line">	<span class="function">Mat <span class="title">getHistogram</span><span class="params">(<span class="keyword">const</span> Mat &amp;image)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat hist;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		calcHist(&amp;image, <span class="number">1</span>, <span class="comment">//单幅图像的直方图</span></span><br><span class="line">			channels,  <span class="comment">//用到的通道</span></span><br><span class="line">			Mat(),     <span class="comment">//不使用掩码</span></span><br><span class="line">			hist,      <span class="comment">//得到的直方图</span></span><br><span class="line">			<span class="number">3</span>,         <span class="comment">//这是一个三维的直方图</span></span><br><span class="line">			histSize,  <span class="comment">//箱子数量</span></span><br><span class="line">			ranges);   <span class="comment">//像素值的范围</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> hist;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算直方图</span></span><br><span class="line">	<span class="function">SparseMat <span class="title">getSparseHistogram</span><span class="params">(<span class="keyword">const</span> Mat &amp;image)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="function">SparseMat <span class="title">hist</span><span class="params">(<span class="number">3</span>,       <span class="comment">//维数</span></span></span></span><br><span class="line"><span class="function"><span class="params">			histSize,          <span class="comment">//每个维度的大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">			CV_32F)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//计算直方图</span></span><br><span class="line">		calcHist(&amp;image, <span class="number">1</span>, </span><br><span class="line">			channels,  </span><br><span class="line">			Mat(),    </span><br><span class="line">			hist,      </span><br><span class="line">			<span class="number">3</span>,         </span><br><span class="line">			histSize, </span><br><span class="line">			ranges);  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> hist;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用均值平均算法查找目标</span></span><br><span class="line">	<span class="comment">//计算一维色调直方图</span></span><br><span class="line">	<span class="comment">//BGR 的原图转化为 HSV</span></span><br><span class="line">	<span class="comment">//忽略低饱和度的像素</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getHueHistogram</span><span class="params">(<span class="keyword">const</span> cv::Mat &amp;image,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">int</span> minSaturation = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::Mat hist;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//转化为HSV空间</span></span><br><span class="line">		cv::Mat hsv;</span><br><span class="line">		cv::cvtColor(image, hsv, CV_BGR2HSV);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 掩码（可能用到，可能用不到）</span></span><br><span class="line">		cv::Mat mask;</span><br><span class="line">		<span class="comment">//根据需要创建掩码</span></span><br><span class="line">		<span class="keyword">if</span> (minSaturation&gt;<span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 将3个通道分割进是3个图像</span></span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Mat&gt; v;</span><br><span class="line">			cv::split(hsv, v);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//屏蔽低饱和度的像素</span></span><br><span class="line">			cv::threshold(v[<span class="number">1</span>], mask, minSaturation, <span class="number">255</span>,</span><br><span class="line">				cv::THRESH_BINARY);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 准备一维色调直方图的参数</span></span><br><span class="line">		hranges[<span class="number">0</span>] = <span class="number">0.0</span>;    <span class="comment">//范围为 0 - 180</span></span><br><span class="line">		hranges[<span class="number">1</span>] = <span class="number">180.0</span>;</span><br><span class="line">		channels[<span class="number">0</span>] = <span class="number">0</span>;    <span class="comment">//色调通道</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 计算直方图</span></span><br><span class="line">		cv::calcHist(&amp;hsv,</span><br><span class="line">			<span class="number">1</span>,			</span><br><span class="line">			channels,	</span><br><span class="line">			mask,		</span><br><span class="line">			hist,		</span><br><span class="line">			<span class="number">1</span>,			</span><br><span class="line">			histSize,	</span><br><span class="line">			ranges		</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> hist;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Computes the 2D ab histogram.</span></span><br><span class="line">	<span class="comment">// BGR source image is converted to Lab</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getabHistogram</span><span class="params">(<span class="keyword">const</span> cv::Mat &amp;image)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::Mat hist;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Convert to Lab color space</span></span><br><span class="line">		cv::Mat lab;</span><br><span class="line">		cv::cvtColor(image, lab, CV_BGR2Lab);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Prepare arguments for a 2D color histogram</span></span><br><span class="line">		hranges[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">		hranges[<span class="number">1</span>] = <span class="number">256.0</span>;</span><br><span class="line">		channels[<span class="number">0</span>] = <span class="number">1</span>; <span class="comment">// the two channels used are ab </span></span><br><span class="line">		channels[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Compute histogram</span></span><br><span class="line">		cv::calcHist(&amp;lab,</span><br><span class="line">			<span class="number">1</span>,			<span class="comment">// histogram of 1 image only</span></span><br><span class="line">			channels,	<span class="comment">// the channel used</span></span><br><span class="line">			cv::Mat(),	<span class="comment">// no mask is used</span></span><br><span class="line">			hist,		<span class="comment">// the resulting histogram</span></span><br><span class="line">			<span class="number">2</span>,			<span class="comment">// it is a 2D histogram</span></span><br><span class="line">			histSize,	<span class="comment">// number of bins</span></span><br><span class="line">			ranges		<span class="comment">// pixel value range</span></span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> hist;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !define COLORHISTOGRAM</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-05-用形态学运算变换图像"><a href="#Chapter-05-用形态学运算变换图像" class="headerlink" title="Chapter_05 : 用形态学运算变换图像"></a>Chapter_05 : 用形态学运算变换图像</h3><blockquote>
<p>1.腐蚀、膨胀、开始、闭合等形态学运算<br>2.MSER算法提取特征区域<br>3.用分水岭算法实现图像分割</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"WatershedSegmenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">////1.腐蚀、膨胀、开始、闭合等形态学运算</span></span><br><span class="line">	<span class="comment">//Mat image = imread("./images/binary.bmp");</span></span><br><span class="line">	<span class="comment">//if (!image.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("image", image);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat eroded; </span></span><br><span class="line">	<span class="comment">//erode(image, eroded, Mat());</span></span><br><span class="line">	<span class="comment">//imshow("erode", eroded);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat dilated; </span></span><br><span class="line">	<span class="comment">//dilate(image, dilated, Mat());</span></span><br><span class="line">	<span class="comment">//imshow("dilate", dilated);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat element(7, 7, CV_8U, Scalar(1));</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//erode(image, eroded, element);</span></span><br><span class="line">	<span class="comment">//imshow("Erode-7*7", eroded);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//erode(image, eroded, Mat(), Point(-1, -1), 3);</span></span><br><span class="line">	<span class="comment">//imshow("erode--3time", eroded);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat element5(5, 5, CV_8U, Scalar(1));</span></span><br><span class="line">	<span class="comment">//Mat closed;</span></span><br><span class="line">	<span class="comment">//morphologyEx(image, closed, MORPH_CLOSE, element5);</span></span><br><span class="line">	<span class="comment">//imshow("close", closed);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat opened;</span></span><br><span class="line">	<span class="comment">//morphologyEx(image, opened, MORPH_OPEN, element5);</span></span><br><span class="line">	<span class="comment">//imshow("open", opened);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// explicit closing</span></span><br><span class="line">	<span class="comment">//// 1. dilate original image</span></span><br><span class="line">	<span class="comment">//cv::Mat result;</span></span><br><span class="line">	<span class="comment">//cv::dilate(image, result, element5);</span></span><br><span class="line">	<span class="comment">//// 2. in-place erosion of the dilated image</span></span><br><span class="line">	<span class="comment">//cv::erode(result, result, element5);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Display the closed image</span></span><br><span class="line">	<span class="comment">//cv::namedWindow("Closed Image (2)");</span></span><br><span class="line">	<span class="comment">//cv::imshow("Closed Image (2)", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Close and Open the image</span></span><br><span class="line">	<span class="comment">//cv::morphologyEx(image, image, cv::MORPH_CLOSE, element5);</span></span><br><span class="line">	<span class="comment">//cv::morphologyEx(image, image, cv::MORPH_OPEN, element5);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Display the close/opened image</span></span><br><span class="line">	<span class="comment">//cv::namedWindow("Closed|Opened Image");</span></span><br><span class="line">	<span class="comment">//cv::imshow("Closed|Opened Image", image);</span></span><br><span class="line">	<span class="comment">//cv::imwrite("binaryGroup.bmp", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Read input image</span></span><br><span class="line">	<span class="comment">//image = cv::imread("./images/binary.bmp");</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Open and Close the image</span></span><br><span class="line">	<span class="comment">//cv::morphologyEx(image, image, cv::MORPH_OPEN, element5);</span></span><br><span class="line">	<span class="comment">//cv::morphologyEx(image, image, cv::MORPH_CLOSE, element5);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Display the close/opened image</span></span><br><span class="line">	<span class="comment">//cv::namedWindow("Opened|Closed Image");</span></span><br><span class="line">	<span class="comment">//cv::imshow("Opened|Closed Image", image);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat image2 = imread("./images/boldt.jpg", 0);</span></span><br><span class="line">	<span class="comment">//if (!image2.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//imshow("image2", image2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//morphologyEx(image2, result, MORPH_GRADIENT, Mat());</span></span><br><span class="line">	<span class="comment">//imshow("Edge_result", result);</span></span><br><span class="line">	<span class="comment">//imshow("Edge_255-result", 255 - result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//int threshold(80);</span></span><br><span class="line">	<span class="comment">//cv::threshold(result, result, threshold, 255, THRESH_BINARY);</span></span><br><span class="line">	<span class="comment">//imshow("threshold_result", result);</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//Mat image3 = imread("./images/book.jpg", 0);</span></span><br><span class="line">	<span class="comment">//if (!image3.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//imshow("Image3", image3);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//transpose(image3, image3);</span></span><br><span class="line">	<span class="comment">//imshow("transpose", image3);</span></span><br><span class="line">	<span class="comment">//flip(image3, image3, 0);</span></span><br><span class="line">	<span class="comment">//imshow("image3", image3);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat element7(7, 7, CV_8U, Scalar(1));</span></span><br><span class="line">	<span class="comment">//morphologyEx(image3, result, MORPH_BLACKHAT, element7);</span></span><br><span class="line">	<span class="comment">//imshow("Blackhat", result);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//threshold = 25;</span></span><br><span class="line">	<span class="comment">//cv::threshold(result, result,</span></span><br><span class="line">	<span class="comment">//	threshold, 255, cv::THRESH_BINARY);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Thresholded Black Top-hat", 255 - result);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////2.MSER算法提取特征区域</span></span><br><span class="line">	<span class="comment">//Mat image = imread("./images/building.jpg", 0);</span></span><br><span class="line">	<span class="comment">//if (!image.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//imshow("image", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////基本的MSER检测器</span></span><br><span class="line">	<span class="comment">//Ptr&lt;MSER&gt; ptrMSER = MSER::create(5,  //局部检测时使用的增量值</span></span><br><span class="line">	<span class="comment">//	200,                             //允许的最小面积</span></span><br><span class="line">	<span class="comment">//	2000);                           //允许的最大面积</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////点集的容器</span></span><br><span class="line">	<span class="comment">//vector&lt;vector&lt;Point&gt; &gt; points;</span></span><br><span class="line">	<span class="comment">////矩形的容器</span></span><br><span class="line">	<span class="comment">//vector&lt;Rect&gt; rects;</span></span><br><span class="line">	<span class="comment">////检测MSER特征 ----检测的结果放在两个区域，第一个是区域的容器，每个区域用组成它的像素点表示，</span></span><br><span class="line">	<span class="comment">////第二个是矩形的容器，每个矩形包围一个区域</span></span><br><span class="line">	<span class="comment">//ptrMSER-&gt;detectRegions(image, points, rects);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; points.size() &lt;&lt; "MSERs detected" &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////创建白色区域</span></span><br><span class="line">	<span class="comment">//Mat output(image.size(), CV_8UC3);</span></span><br><span class="line">	<span class="comment">//output = Scalar(255, 255, 255);</span></span><br><span class="line"> <span class="comment">//   //Opencv随机数生成器</span></span><br><span class="line">	<span class="comment">//RNG rng;</span></span><br><span class="line">	<span class="comment">////针对每个检测到的特征区域， 在彩色区域显示MSER</span></span><br><span class="line">	<span class="comment">////反向排序，先显示较大的MSER</span></span><br><span class="line">	<span class="comment">//for (vector&lt;vector&lt;Point&gt; &gt; ::reverse_iterator it = points.rbegin(); it != points.rend(); ++it)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	//生成随机颜色</span></span><br><span class="line">	<span class="comment">//	Vec3b c(rng.uniform(0, 254), rng.uniform(0, 254), rng.uniform(0, 254));</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; "MSER size = " &lt;&lt; it-&gt;size() &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	//针对MSER集合中的每个点</span></span><br><span class="line">	<span class="comment">//	for (vector&lt;Point&gt; ::iterator itPts = it-&gt;begin(); itPts != it-&gt;end(); ++itPts)</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		//不重复MSER的像素</span></span><br><span class="line">	<span class="comment">//		if (output.at&lt;Vec3b&gt;(*itPts)[0] == 255)</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			output.at&lt;Vec3b&gt;(*itPts) = c;</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("MSER point sets", output);</span></span><br><span class="line">	<span class="comment">//imwrite("./images/mser.bmp", output);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////提取并显示矩形的MSER</span></span><br><span class="line">	<span class="comment">//vector&lt;Rect&gt; ::iterator itr = rects.begin();</span></span><br><span class="line">	<span class="comment">//vector&lt;vector&lt;Point&gt; &gt; ::iterator  itp = points.begin();</span></span><br><span class="line">	<span class="comment">//for (; itr != rects.end(); ++itr, ++itp)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	//检查两者比例</span></span><br><span class="line">	<span class="comment">//	if (static_cast&lt;double&gt; (itp-&gt;size()) / itr-&gt;area() &gt; 0.6)</span></span><br><span class="line">	<span class="comment">//		rectangle(image, *itr, Scalar(0, 0, 255), 2);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////显示结果</span></span><br><span class="line">	<span class="comment">//imshow("Rectangle MSERs", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////提取并显示椭圆形的MSER</span></span><br><span class="line">	<span class="comment">//image = imread("./images/building.jpg", 0);</span></span><br><span class="line">	<span class="comment">//if (!image.data)</span></span><br><span class="line">	<span class="comment">//	return 0;</span></span><br><span class="line">	<span class="comment">//for (vector&lt;vector&lt;Point&gt; &gt; ::iterator it = points.begin(); it != points.end(); ++it)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	//遍历MSER集合中的每一个点</span></span><br><span class="line">	<span class="comment">//	for (vector&lt;Point&gt; ::iterator itPts = it-&gt;begin(); itPts != it-&gt;end(); ++itPts)</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		//提取封闭的矩形</span></span><br><span class="line">	<span class="comment">//		RotatedRect rr = minAreaRect(*it);</span></span><br><span class="line">	<span class="comment">//		//检查椭圆得长宽比</span></span><br><span class="line">	<span class="comment">//		if (rr.size.height / rr.size.width &gt; 0.2 || rr.size.height / rr.size.width &lt; 1.6)</span></span><br><span class="line">	<span class="comment">//			ellipse(image, rr, Scalar(255), 2);</span></span><br><span class="line">	<span class="comment">//		</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("MSER ellipses", image);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.用分水岭算法实现图像分割</span></span><br><span class="line">	Mat image = imread(<span class="string">"./images/group.jpg"</span>);</span><br><span class="line">	<span class="keyword">if</span> (!image.data)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"image"</span>, image);</span><br><span class="line"></span><br><span class="line">	Mat binary;</span><br><span class="line">	binary = imread(<span class="string">"./images/binary.bmp"</span>, <span class="number">0</span>);</span><br><span class="line">	imshow(<span class="string">"Binary Image"</span>, binary);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//消除噪声和细小的物体</span></span><br><span class="line">	Mat fg;</span><br><span class="line">	erode(binary, fg, Mat(), Point(<span class="number">-1</span>, <span class="number">-1</span>), <span class="number">4</span>);</span><br><span class="line">	imshow(<span class="string">"erode"</span>, fg);</span><br><span class="line">	<span class="comment">//标识不含物体的图像像素</span></span><br><span class="line">	Mat bg;</span><br><span class="line">	dilate(binary, bg, Mat(), Point(<span class="number">-1</span>, <span class="number">-1</span>), <span class="number">4</span>);</span><br><span class="line">	threshold(bg, bg, <span class="number">1</span>, <span class="number">128</span>, THRESH_BINARY_INV);</span><br><span class="line">	imshow(<span class="string">"dilate_threshold"</span>, bg);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建标记图像</span></span><br><span class="line">	<span class="function">Mat <span class="title">markers</span><span class="params">(binary.size(), CV_8U, Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">	markers = fg + bg;</span><br><span class="line">	imshow(<span class="string">"Markers"</span>, markers);</span><br><span class="line">	<span class="comment">//创建分水岭分割类的对象</span></span><br><span class="line">	WatershedSegmenter segmenter;</span><br><span class="line">	<span class="comment">//设置标记图像，然后执行分割过程</span></span><br><span class="line">	segmenter.setMarkers(markers);</span><br><span class="line">	segmenter.process(image);</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"Segmentation"</span>, segmenter.getSegmentation());</span><br><span class="line"></span><br><span class="line">	imshow(<span class="string">"Watersheds"</span>, segmenter.getWatersheds());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Open another image</span></span><br><span class="line">	image = cv::imread(<span class="string">"./images/tower.jpg"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Identify background pixels</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">imageMask</span><span class="params">(image.size(), CV_8U, cv::Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">	cv::rectangle(imageMask, cv::Point(<span class="number">5</span>, <span class="number">5</span>), cv::Point(image.cols - <span class="number">5</span>, image.rows - <span class="number">5</span>), cv::Scalar(<span class="number">255</span>), <span class="number">3</span>);</span><br><span class="line">	<span class="comment">// Identify foreground pixels (in the middle of the image)</span></span><br><span class="line">	cv::rectangle(imageMask, cv::Point(image.cols / <span class="number">2</span> - <span class="number">10</span>, image.rows / <span class="number">2</span> - <span class="number">10</span>),</span><br><span class="line">		cv::Point(image.cols / <span class="number">2</span> + <span class="number">10</span>, image.rows / <span class="number">2</span> + <span class="number">10</span>), cv::Scalar(<span class="number">1</span>), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set markers and process</span></span><br><span class="line">	segmenter.setMarkers(imageMask);</span><br><span class="line">	segmenter.process(image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Display the image with markers</span></span><br><span class="line">	cv::rectangle(image, cv::Point(<span class="number">5</span>, <span class="number">5</span>), cv::Point(image.cols - <span class="number">5</span>, image.rows - <span class="number">5</span>), cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">3</span>);</span><br><span class="line">	cv::rectangle(image, cv::Point(image.cols / <span class="number">2</span> - <span class="number">10</span>, image.rows / <span class="number">2</span> - <span class="number">10</span>),</span><br><span class="line">		cv::Point(image.cols / <span class="number">2</span> + <span class="number">10</span>, image.rows / <span class="number">2</span> + <span class="number">10</span>), cv::Scalar(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="number">10</span>);</span><br><span class="line">	cv::namedWindow(<span class="string">"Image with marker"</span>);</span><br><span class="line">	cv::imshow(<span class="string">"Image with marker"</span>, image);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Display watersheds</span></span><br><span class="line">	cv::namedWindow(<span class="string">"Watershed"</span>);</span><br><span class="line">	cv::imshow(<span class="string">"Watershed"</span>, segmenter.getWatersheds());</span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !<span class="meta-keyword">define</span> WATERSHS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WATERSHS</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WatershedSegmenter</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Mat markers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setMarkers</span><span class="params">(<span class="keyword">const</span> Mat &amp;markerImage)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//转化为整数型图像</span></span><br><span class="line">		markerImage.convertTo(markers, CV_32S);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Mat <span class="title">process</span><span class="params">(<span class="keyword">const</span> Mat &amp;image)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//应用分水岭</span></span><br><span class="line">		watershed(image, markers);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> markers;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//以图像的形式返回结果</span></span><br><span class="line">	<span class="function">Mat <span class="title">getSegmentation</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat tmp;</span><br><span class="line">		<span class="comment">//所有标签值大于255的区域都赋值为255</span></span><br><span class="line">		markers.convertTo(tmp, CV_8U);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> tmp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//以图像的形式返回分水岭</span></span><br><span class="line">	<span class="function">Mat <span class="title">getWatersheds</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat tmp;</span><br><span class="line">		markers.convertTo(tmp, CV_8U, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> tmp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !define WATERSHS</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-06-图像滤波"><a href="#Chapter-06-图像滤波" class="headerlink" title="Chapter_06  :  图像滤波"></a>Chapter_06  :  图像滤波</h3><blockquote>
<p>1.方块滤波、高斯滤波、resize(), pyrUp(), pyrDown()<br>2.Sobel滤波器<br>3.Laplacian算子<br>4.高斯差分</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/opencv.hpp&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include "LaplacianZC.h"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"><span class="comment">//using namespace cv;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	////1.方块滤波、高斯滤波、resize(), pyrUp(), pyrDown()</span></span><br><span class="line"><span class="comment">//	//Mat image = imread("./images/boldt.jpg", 0);</span></span><br><span class="line"><span class="comment">//	//if (!image.data)</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	cout &lt;&lt; "image is error" &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	//	return 0;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//imshow("image", image);</span></span><br><span class="line"><span class="comment">//	//  </span></span><br><span class="line"><span class="comment">//	////方块滤波</span></span><br><span class="line"><span class="comment">//	//Mat result;</span></span><br><span class="line"><span class="comment">//	//blur(image, result, Size(5, 5));</span></span><br><span class="line"><span class="comment">//	//imshow("Mean Image", result);</span></span><br><span class="line"><span class="comment">// //   //Blur the image with a mean filter 9*9</span></span><br><span class="line"><span class="comment">//	//blur(image, result, Size(9, 9));</span></span><br><span class="line"><span class="comment">//	//imshow("Mean Image(9 * 9)", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////高斯滤波</span></span><br><span class="line"><span class="comment">//	//GaussianBlur(image, result, Size(5, 5), //滤波尺寸</span></span><br><span class="line"><span class="comment">//	//	1.5);                               //控制高斯曲线形状的参数</span></span><br><span class="line"><span class="comment">//	//imshow("Gaussian Filtered Image", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the blurred image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Gaussian filtered Image (9x9)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Gaussian filtered Image (9x9)", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////Get the gaussian kernel (1.5)</span></span><br><span class="line"><span class="comment">//	//Mat gauss = getGaussianKernel(9, 1.5, CV_32F);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////Display kernal value </span></span><br><span class="line"><span class="comment">//	//Mat_&lt;float&gt;::const_iterator it = gauss.begin&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//Mat_&lt;float&gt;::const_iterator itend = gauss.end&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; "1.5 = [";</span></span><br><span class="line"><span class="comment">//	//for (; it != itend; ++it)</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	cout &lt;&lt; "]" &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////Get the gaussian kernel(0.5)</span></span><br><span class="line"><span class="comment">//	//gauss = getGaussianKernel(9, 0.5, CV_32F);</span></span><br><span class="line"><span class="comment">//	//// Display kernel values</span></span><br><span class="line"><span class="comment">//	//it = gauss.begin&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//itend = gauss.end&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "0.5 = [";</span></span><br><span class="line"><span class="comment">//	//for (; it != itend; ++it) &#123;</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; *it &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "]" &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Get the gaussian kernel (2.5)</span></span><br><span class="line"><span class="comment">//	//gauss = cv::getGaussianKernel(9, 2.5, CV_32F);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display kernel values</span></span><br><span class="line"><span class="comment">//	//it = gauss.begin&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//itend = gauss.end&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "2.5 = [";</span></span><br><span class="line"><span class="comment">//	//for (; it != itend; ++it) &#123;</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; *it &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "]" &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Get the gaussian kernel(9 elements)</span></span><br><span class="line"><span class="comment">//	//gauss = cv::getGaussianKernel(9, -1, CV_32F);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display kernel values</span></span><br><span class="line"><span class="comment">//	//it = gauss.begin&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//itend = gauss.end&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "9 = [";</span></span><br><span class="line"><span class="comment">//	//for (; it != itend; ++it) &#123;</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; *it &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "]" &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Get the Deriv kernel (2.5)</span></span><br><span class="line"><span class="comment">//	//cv::Mat kx, ky;</span></span><br><span class="line"><span class="comment">//	//cv::getDerivKernels(kx, ky, 2, 2, 7, true);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display kernel values</span></span><br><span class="line"><span class="comment">//	//cv::Mat_&lt;float&gt;::const_iterator kit = kx.begin&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//cv::Mat_&lt;float&gt;::const_iterator kitend = kx.end&lt;float&gt;();</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "[";</span></span><br><span class="line"><span class="comment">//	//for (; kit != kitend; ++kit) &#123;</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; *kit &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "]" &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Read input image with salt&amp;pepper noise</span></span><br><span class="line"><span class="comment">//	//image = cv::imread("./images/salted.bmp", 0);</span></span><br><span class="line"><span class="comment">//	//if (!image.data)</span></span><br><span class="line"><span class="comment">//	//	return 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the S&amp;P image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("S&amp;P Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("S&amp;P Image", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Blur the image with a mean filter</span></span><br><span class="line"><span class="comment">//	//cv::blur(image, result, cv::Size(5, 5));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the blurred image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Mean filtered S&amp;P Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Mean filtered S&amp;P Image", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Applying a median filter</span></span><br><span class="line"><span class="comment">//	//cv::medianBlur(image, result, 5);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the blurred image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Median filtered Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Median filtered Image", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Reduce by 4 the size of the image (the wrong way)</span></span><br><span class="line"><span class="comment">//	////只保留每四个像素中的一个</span></span><br><span class="line"><span class="comment">//	//image = cv::imread("./images/boldt.jpg", 0);</span></span><br><span class="line"><span class="comment">//	//cv::Mat reduced(image.rows / 4, image.cols / 4, CV_8U);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//for (int i = 0; i&lt;reduced.rows; i++)</span></span><br><span class="line"><span class="comment">//	//	for (int j = 0; j&lt;reduced.cols; j++)</span></span><br><span class="line"><span class="comment">//	//		reduced.at&lt;uchar&gt;(i, j) = image.at&lt;uchar&gt;(i * 4, j * 4);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the reduced image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Badly reduced Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Badly reduced Image", reduced);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::resize(reduced, reduced, cv::Size(), 4, 4, cv::INTER_NEAREST);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the (resized) reduced image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Badly reduced");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Badly reduced", reduced);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::imwrite("badlyreducedimage.bmp", reduced);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// first remove high frequency component</span></span><br><span class="line"><span class="comment">//	//cv::GaussianBlur(image, image, cv::Size(11, 11), 1.75);</span></span><br><span class="line"><span class="comment">//	//// keep only 1 of every 4 pixels</span></span><br><span class="line"><span class="comment">//	//cv::Mat reduced2(image.rows / 4, image.cols / 4, CV_8U);</span></span><br><span class="line"><span class="comment">//	//for (int i = 0; i&lt;reduced2.rows; i++)</span></span><br><span class="line"><span class="comment">//	//	for (int j = 0; j&lt;reduced2.cols; j++)</span></span><br><span class="line"><span class="comment">//	//		reduced2.at&lt;uchar&gt;(i, j) = image.at&lt;uchar&gt;(i * 4, j * 4);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the reduced image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Reduced Image, original size");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Reduced Image, original size", reduced2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::imwrite("reducedimage.bmp", reduced2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// resizing with NN</span></span><br><span class="line"><span class="comment">//	//cv::Mat newImage;</span></span><br><span class="line"><span class="comment">//	//cv::resize(reduced2, newImage, cv::Size(), 4, 4, cv::INTER_NEAREST);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the (resized) reduced image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Reduced Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Reduced Image", newImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// resizing with bilinear</span></span><br><span class="line"><span class="comment">//	//cv::resize(reduced2, newImage, cv::Size(), 4, 4, cv::INTER_LINEAR);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the (resized) reduced image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Bilinear resizing");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Bilinear resizing", newImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Creating an image pyramid</span></span><br><span class="line"><span class="comment">//	//cv::Mat pyramid(image.rows, image.cols + image.cols / 2 + image.cols / 4 + image.cols / 8, CV_8U, cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//	//image.copyTo(pyramid(cv::Rect(0, 0, image.cols, image.rows)));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::pyrDown(image, reduced); // reduce image size by half</span></span><br><span class="line"><span class="comment">//	//reduced.copyTo(pyramid(cv::Rect(image.cols, image.rows / 2, image.cols / 2, image.rows / 2)));</span></span><br><span class="line"><span class="comment">//	//cv::pyrDown(reduced, reduced2); // reduce image size by another half</span></span><br><span class="line"><span class="comment">//	//reduced2.copyTo(pyramid(cv::Rect(image.cols + image.cols / 2, image.rows - image.rows / 4, image.cols / 4, image.rows / 4)));</span></span><br><span class="line"><span class="comment">//	//cv::pyrDown(reduced2, reduced); // reduce image size by another half</span></span><br><span class="line"><span class="comment">//	//reduced.copyTo(pyramid(cv::Rect(image.cols + image.cols / 2 + image.cols / 4, image.rows - image.rows / 8, image.cols / 8, image.rows / 8)));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the pyramid</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Pyramid of images");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Pyramid of images", pyramid);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//2.Sobel滤波器</span></span><br><span class="line"><span class="comment">//    Mat image = imread("./images/boldt.jpg", 0);</span></span><br><span class="line"><span class="comment">//	if (!image.data)</span></span><br><span class="line"><span class="comment">//		return 0;</span></span><br><span class="line"><span class="comment">//	imshow("Image", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//计算Sobel滤波器的X方向</span></span><br><span class="line"><span class="comment">//	Mat sobelX;</span></span><br><span class="line"><span class="comment">//	Sobel(image,    //输入 </span></span><br><span class="line"><span class="comment">//		sobelX,     // 输出</span></span><br><span class="line"><span class="comment">//		CV_8U,      //图像类型</span></span><br><span class="line"><span class="comment">//		1, 0,       //内核规格</span></span><br><span class="line"><span class="comment">//		3,          //正方形内核的尺寸</span></span><br><span class="line"><span class="comment">//		0.4, 128);  // 比例和偏移量</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("Sobel X Image", sobelX);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//计算Sobel滤波器的Y方向</span></span><br><span class="line"><span class="comment">//	Mat sobelY;</span></span><br><span class="line"><span class="comment">//	Sobel(image,    //输入 </span></span><br><span class="line"><span class="comment">//		sobelY,     // 输出</span></span><br><span class="line"><span class="comment">//		CV_8U,      //图像类型</span></span><br><span class="line"><span class="comment">//		0, 1,       //内核规格</span></span><br><span class="line"><span class="comment">//		3,          //正方形内核的尺寸</span></span><br><span class="line"><span class="comment">//		0.4, 128);  // 比例和偏移量</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("Sobel Y Image", sobelY);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//组合这两个结果   计算Sobel滤波器的范数</span></span><br><span class="line"><span class="comment">//	Sobel(image, sobelX, CV_16S, 1, 0);</span></span><br><span class="line"><span class="comment">//	Sobel(image, sobelY, CV_16S, 0, 1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	Mat sobel;</span></span><br><span class="line"><span class="comment">//	//计算L1范数</span></span><br><span class="line"><span class="comment">//	sobel = abs(sobelX) + abs(sobelY);</span></span><br><span class="line"><span class="comment">//	//找到Sobel最大值</span></span><br><span class="line"><span class="comment">//	double sobmin, sobmax;</span></span><br><span class="line"><span class="comment">//	minMaxLoc(sobel, &amp;sobmin, &amp;sobmax);</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "sobel value range:" &lt;&lt; sobmin &lt;&lt; "  " &lt;&lt; sobmax &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Compute Sobel X derivative (7x7)</span></span><br><span class="line"><span class="comment">//	cv::Sobel(image, sobelX, CV_8U, 1, 0, 7, 0.001, 128);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the image</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Sobel X Image (7x7)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Sobel X Image (7x7)", sobelX);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//Print window pixel values</span></span><br><span class="line"><span class="comment">//	for (int i = 0; i &lt; 12; i++)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		for (int j = 0; j &lt; 12; j++)</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			cout &lt;&lt; setw(5) &lt;&lt; static_cast&lt;int&gt;(sobel.at&lt;short&gt;(i + 79, j + 215)) &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//		cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//转换成8位图像</span></span><br><span class="line"><span class="comment">//	Mat sobelImage;</span></span><br><span class="line"><span class="comment">//	sobel.convertTo(sobelImage, CV_8U, -255./sobmax, 255);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("sobelImage", sobelImage);</span></span><br><span class="line"><span class="comment">//	//进行阈值化</span></span><br><span class="line"><span class="comment">//	Mat sobelThresholded;</span></span><br><span class="line"><span class="comment">//	threshold(sobelImage, sobelThresholded, 225, 255, THRESH_BINARY);</span></span><br><span class="line"><span class="comment">//	imshow("sobelThresholded", sobelThresholded);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//3.Laplacian算子</span></span><br><span class="line"><span class="comment">//	//默认的拉普拉斯算子的核的值的大小是 3 * 3</span></span><br><span class="line"><span class="comment">//	Mat laplace;</span></span><br><span class="line"><span class="comment">//	Laplacian(image, laplace, CV_8U, 1, 1, 128);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("Laplacian Image", laplace);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	int cx(238), cy(90);</span></span><br><span class="line"><span class="comment">//	int dx(12), dy(12);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//一个小的窗口</span></span><br><span class="line"><span class="comment">//	Mat window(image, Rect(cx, cy, dx, dy));</span></span><br><span class="line"><span class="comment">//	imshow("window", window);</span></span><br><span class="line"><span class="comment">//	imwrite("./images/window.bmp", window);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//用LaplacianZC类计算拉普拉斯</span></span><br><span class="line"><span class="comment">//	LaplactionZC laplacian;</span></span><br><span class="line"><span class="comment">//	laplacian.setAperture(7);</span></span><br><span class="line"><span class="comment">//	Mat flap = laplacian.computeLaplacian(image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// display min max values of the lapalcian</span></span><br><span class="line"><span class="comment">//	double lapmin, lapmax;</span></span><br><span class="line"><span class="comment">//	cv::minMaxLoc(flap, &amp;lapmin, &amp;lapmax);</span></span><br><span class="line"><span class="comment">//	// display laplacian image</span></span><br><span class="line"><span class="comment">//	laplace = laplacian.getLaplacianImage();</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Laplacian Image (7x7)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Laplacian Image (7x7)", laplace);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Print image values</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; "Image values:\n\n";</span></span><br><span class="line"><span class="comment">//	for (int i = 0; i&lt;dx; i++) &#123;</span></span><br><span class="line"><span class="comment">//		for (int j = 0; j&lt;dy; j++)</span></span><br><span class="line"><span class="comment">//			std::cout &lt;&lt; std::setw(5) &lt;&lt; static_cast&lt;int&gt;(image.at&lt;uchar&gt;(i + cy, j + cx)) &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//		std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Print Laplacian values</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; "Laplacian value range=[" &lt;&lt; lapmin &lt;&lt; "," &lt;&lt; lapmax &lt;&lt; "]\n";</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	for (int i = 0; i&lt;dx; i++) &#123;</span></span><br><span class="line"><span class="comment">//		for (int j = 0; j&lt;dy; j++)</span></span><br><span class="line"><span class="comment">//			std::cout &lt;&lt; std::setw(5) &lt;&lt; static_cast&lt;int&gt;(flap.at&lt;float&gt;(i + cy, j + cx) / 100) &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//		std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Compute and display the zero-crossing points</span></span><br><span class="line"><span class="comment">//	cv::Mat zeros;</span></span><br><span class="line"><span class="comment">//	zeros = laplacian.getZeroCrossings(flap);</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Zero-crossings");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Zero-crossings", 255 - zeros);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Print window pixel values</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; "Zero values:\n\n";</span></span><br><span class="line"><span class="comment">//	for (int i = 0; i&lt;dx; i++) &#123;</span></span><br><span class="line"><span class="comment">//		for (int j = 0; j&lt;dy; j++)</span></span><br><span class="line"><span class="comment">//			std::cout &lt;&lt; std::setw(2) &lt;&lt; static_cast&lt;int&gt;(zeros.at&lt;uchar&gt;(i + cy, j + cx)) / 255 &lt;&lt; " ";</span></span><br><span class="line"><span class="comment">//		std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// down-sample and up-sample the image</span></span><br><span class="line"><span class="comment">//	cv::Mat reduced, rescaled;</span></span><br><span class="line"><span class="comment">//	cv::pyrDown(image, reduced);</span></span><br><span class="line"><span class="comment">//	cv::pyrUp(reduced, rescaled);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the rescaled image</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Rescaled Image");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Rescaled Image", rescaled);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//4.高斯差分（DoG）</span></span><br><span class="line"><span class="comment">//	cv::Mat dog;</span></span><br><span class="line"><span class="comment">//	//计算高斯差分</span></span><br><span class="line"><span class="comment">//	cv::subtract(rescaled, image, dog, cv::Mat(), CV_16S);</span></span><br><span class="line"><span class="comment">//	cv::Mat dogImage;</span></span><br><span class="line"><span class="comment">//	dog.convertTo(dogImage, CV_8U, 1.0, 128);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the DoG image</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("DoG Image (from pyrdown/pyrup)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("DoG Image (from pyrdown/pyrup)", dogImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Apply two Gaussian filters</span></span><br><span class="line"><span class="comment">//	cv::Mat gauss05;</span></span><br><span class="line"><span class="comment">//	cv::Mat gauss15;</span></span><br><span class="line"><span class="comment">//	cv::GaussianBlur(image, gauss05, cv::Size(), 0.5);</span></span><br><span class="line"><span class="comment">//	cv::GaussianBlur(image, gauss15, cv::Size(), 1.5);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// compute a difference of Gaussians </span></span><br><span class="line"><span class="comment">//	cv::subtract(gauss15, gauss05, dog, cv::Mat(), CV_16S);</span></span><br><span class="line"><span class="comment">//	dog.convertTo(dogImage, CV_8U, 2.0, 128);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the DoG image</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("DoG Image");</span></span><br><span class="line"><span class="comment">//	cv::imshow("DoG Image", dogImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Apply two Gaussian filters</span></span><br><span class="line"><span class="comment">//	cv::Mat gauss20;</span></span><br><span class="line"><span class="comment">//	cv::GaussianBlur(image, gauss20, cv::Size(), 2.0);</span></span><br><span class="line"><span class="comment">//	cv::Mat gauss22;</span></span><br><span class="line"><span class="comment">//	cv::GaussianBlur(image, gauss22, cv::Size(), 2.2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// compute a difference of Gaussians </span></span><br><span class="line"><span class="comment">//	cv::subtract(gauss22, gauss20, dog, cv::Mat(), CV_32F);</span></span><br><span class="line"><span class="comment">//	dog.convertTo(dogImage, CV_8U, 10.0, 128);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the DoG image</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("DoG Image (2)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("DoG Image (2)", dogImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// 计算高斯差分的过零点</span></span><br><span class="line"><span class="comment">//	zeros = laplacian.getZeroCrossings(dog);</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Zero-crossings of DoG");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Zero-crossings of DoG", 255 - zeros);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the image with window</span></span><br><span class="line"><span class="comment">//	cv::rectangle(image, cv::Rect(cx, cy, dx, dy), cv::Scalar(255, 255, 255));</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Original Image with window");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Original Image with window", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-07-提取直线、轮廓和区域"><a href="#Chapter-07-提取直线、轮廓和区域" class="headerlink" title="Chapter_07 : 提取直线、轮廓和区域"></a>Chapter_07 : 提取直线、轮廓和区域</h3><blockquote>
<p>1.Sobel算子的部分   Canny边缘提取<br>2.用霍夫变换检测直线<br>3.用概率霍夫变换检测直线<br>4.点集的直线拟合<br>5.提取连续区域</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/opencv.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;vector&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include "EdgeDetector.h"</span></span><br><span class="line"><span class="comment">//#include "LineFinder.h"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"><span class="comment">//using namespace cv;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	//Mat image = imread("./images/road.jpg", 0);</span></span><br><span class="line"><span class="comment">//	//if (!image.data)</span></span><br><span class="line"><span class="comment">//	//	return 0;</span></span><br><span class="line"><span class="comment">//	//imshow("Image", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////计算Sobel</span></span><br><span class="line"><span class="comment">//	//EdgeDetector ed;</span></span><br><span class="line"><span class="comment">//	//ed.computeSobel(image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////展示Sobel</span></span><br><span class="line"><span class="comment">//	//imshow("Sobel (orientation)", ed.getSobelOrientationImage());</span></span><br><span class="line"><span class="comment">//	//imwrite("./images/ori.bmp", ed.getSobelOrientationImage());</span></span><br><span class="line"><span class="comment">//	//// Display the Sobel low threshold</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Sobel (low threshold)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Sobel (low threshold)", ed.getBinaryMap(125));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the Sobel high threshold</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Sobel (high threshold)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Sobel (high threshold)", ed.getBinaryMap(350));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////运用Canny边缘算子</span></span><br><span class="line"><span class="comment">//	//Mat contours;</span></span><br><span class="line"><span class="comment">//	//Canny(image,             //灰度图像</span></span><br><span class="line"><span class="comment">//	//	contours,            //输出轮廓</span></span><br><span class="line"><span class="comment">//	//	125,                 //低阈值</span></span><br><span class="line"><span class="comment">//	//	350);                //高阈值</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("Canny", 255 - contours);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////创建一个测试的图像</span></span><br><span class="line"><span class="comment">//	//Mat test(200, 200, CV_8U, Scalar(0));</span></span><br><span class="line"><span class="comment">//	//cv::line(test, cv::Point(100, 0), cv::Point(200, 200), cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//	//cv::line(test, cv::Point(0, 50), cv::Point(200, 200), cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//	//cv::line(test, cv::Point(0, 200), cv::Point(200, 0), cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//	//cv::line(test, cv::Point(200, 0), cv::Point(0, 200), cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//	//cv::line(test, cv::Point(100, 0), cv::Point(100, 200), cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//	//cv::line(test, cv::Point(0, 100), cv::Point(200, 100), cv::Scalar(255));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the test image</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Test Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Test Image", test);</span></span><br><span class="line"><span class="comment">//	//cv::imwrite("test.bmp", test);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////2.用霍夫变换检测直线</span></span><br><span class="line"><span class="comment">//	//vector&lt;Vec2f&gt; lines;</span></span><br><span class="line"><span class="comment">//	//HoughLines(contours, lines, 1,</span></span><br><span class="line"><span class="comment">//	//	PI/180,          //步长</span></span><br><span class="line"><span class="comment">//	//    60);             //最小投票数</span></span><br><span class="line"><span class="comment">//	////画线</span></span><br><span class="line"><span class="comment">//	//Mat result(contours.rows, contours.cols, CV_8U, Scalar(255));</span></span><br><span class="line"><span class="comment">//	//image.copyTo(result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; "Lines detected" &lt;&lt; lines.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//vector&lt;Vec2f&gt;::const_iterator it = lines.begin();</span></span><br><span class="line"><span class="comment">//	//while (it != lines.end())</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	float rho = (*it)[0];     //第一个元素是距离rho</span></span><br><span class="line"><span class="comment">//	//	float theta = (*it)[1];   //第二个元素是角度theta</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	if (theta &lt; PI/4. || theta &gt; 3.*PI / 4) //垂直线（大致）</span></span><br><span class="line"><span class="comment">//	//	&#123;</span></span><br><span class="line"><span class="comment">//	//		//直线与第一行的交叉点</span></span><br><span class="line"><span class="comment">//	//		Point pt1(rho/cos(theta), 0);</span></span><br><span class="line"><span class="comment">//	//		//直线与最后一行的交叉点</span></span><br><span class="line"><span class="comment">//	//		Point pt2((rho - result.rows * sin(theta)) / cos(theta), result.rows);</span></span><br><span class="line"><span class="comment">//	//		//画白色的线</span></span><br><span class="line"><span class="comment">//	//		line(result, pt1, pt2, Scalar(255), 1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	&#125;</span></span><br><span class="line"><span class="comment">//	//	else //水平线（大致）</span></span><br><span class="line"><span class="comment">//	//	&#123;</span></span><br><span class="line"><span class="comment">//	//		//直线与第一列的交叉点</span></span><br><span class="line"><span class="comment">//	//		Point pt1(0, rho/sin(theta));</span></span><br><span class="line"><span class="comment">//	//		//直线与最后一列的交叉点</span></span><br><span class="line"><span class="comment">//	//		Point pt2(result.cols, (rho - result.cols * cos(theta)) / sin(theta));</span></span><br><span class="line"><span class="comment">//	//		//画白色的线</span></span><br><span class="line"><span class="comment">//	//		line(result, pt1, pt2, Scalar(255), 1);</span></span><br><span class="line"><span class="comment">//	//	&#125;</span></span><br><span class="line"><span class="comment">//	//	cout &lt;&lt; "line: (" &lt;&lt; rho &lt;&lt; "," &lt;&lt; theta &lt;&lt; ")\n";</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	++it;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//imshow("HoughLines", result);</span></span><br><span class="line"><span class="comment">//	//</span></span><br><span class="line"><span class="comment">//	////3.用概率霍夫变换检测直线</span></span><br><span class="line"><span class="comment">//	////创建LineFinder类的实例</span></span><br><span class="line"><span class="comment">//	//LineFinder finder;</span></span><br><span class="line"><span class="comment">//	////设置概率霍夫变换的参数</span></span><br><span class="line"><span class="comment">//	//finder.setLineLengthAndGap(100, 20);</span></span><br><span class="line"><span class="comment">//	//finder.setMinVote(60);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////检测直线并画直线</span></span><br><span class="line"><span class="comment">//	//vector&lt;Vec4i&gt; linesp = finder.findLines(contours);</span></span><br><span class="line"><span class="comment">//	//finder.drawDetectedLines(image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Vec4i&gt;::const_iterator it2 = linesp.begin();</span></span><br><span class="line"><span class="comment">//	//while (it2 != linesp.end()) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; "(" &lt;&lt; (*it2)[0] &lt;&lt; "," &lt;&lt; (*it2)[1] &lt;&lt; ")-("</span></span><br><span class="line"><span class="comment">//	//		&lt;&lt; (*it2)[2] &lt;&lt; "," &lt;&lt; (*it2)[3] &lt;&lt; ")" &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	++it2;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("HoughLinesp", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////4.点集的直线拟合</span></span><br><span class="line"><span class="comment">//	//image = imread("./images/road.jpg", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//int n = 0;  //选用直线0</span></span><br><span class="line"><span class="comment">//	//line(image, Point(linesp[n][0], linesp[n][1]), Point(linesp[n][2], linesp[n][3]),Scalar(255), 5);</span></span><br><span class="line"><span class="comment">//	//imshow("One line of the Image", image);</span></span><br><span class="line"><span class="comment">//	////黑白图像</span></span><br><span class="line"><span class="comment">//	//Mat oneline(image.size(), CV_8U, Scalar(0));</span></span><br><span class="line"><span class="comment">//	////白色直线</span></span><br><span class="line"><span class="comment">//	//line(oneline, Point(linesp[n][0], linesp[n][1]), Point(linesp[n][2], linesp[n][3]), Scalar(255), 3);</span></span><br><span class="line"><span class="comment">//	////轮廓与白色直线进行与&amp;操作</span></span><br><span class="line"><span class="comment">//	//bitwise_and(contours, oneline, oneline);</span></span><br><span class="line"><span class="comment">//	//imshow("One line", 255 - oneline);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//vector&lt;Point&gt; points;</span></span><br><span class="line"><span class="comment">//	////迭代遍历像素，得到所有点的位置</span></span><br><span class="line"><span class="comment">//	//for (int y = 0; y &lt; oneline.rows; y++)</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	//行y</span></span><br><span class="line"><span class="comment">//	//	uchar *rowPtr = oneline.ptr&lt;uchar&gt;(y);</span></span><br><span class="line"><span class="comment">//	//	for (int x = 0; x &lt; oneline.cols; x++)</span></span><br><span class="line"><span class="comment">//	//	&#123;</span></span><br><span class="line"><span class="comment">//	//		//列x</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//		//如果在轮廓上</span></span><br><span class="line"><span class="comment">//	//		if (rowPtr[x])</span></span><br><span class="line"><span class="comment">//	//		&#123;</span></span><br><span class="line"><span class="comment">//	//			points.push_back(Point(x, y));</span></span><br><span class="line"><span class="comment">//	//		&#125;</span></span><br><span class="line"><span class="comment">//	//	&#125;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////得到点集后， 利用这些点集拟合出直线， fitLine可以轻松的得到最优的拟合直线</span></span><br><span class="line"><span class="comment">//	//Vec4f line;</span></span><br><span class="line"><span class="comment">//	//fitLine(points, line,</span></span><br><span class="line"><span class="comment">//	//	DIST_L2,    //距离类型</span></span><br><span class="line"><span class="comment">//	//	0,          //L2距离不用这个参数</span></span><br><span class="line"><span class="comment">//	//	0.01, 0.01);//精度</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; "line: (" &lt;&lt; line[0] &lt;&lt; "," &lt;&lt; line[1] &lt;&lt; ")(" &lt;&lt; line[2] &lt;&lt; "," &lt;&lt; line[3] &lt;&lt; ")\n";</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//int x0 = line[2];      //直线上一个点</span></span><br><span class="line"><span class="comment">//	//int y0 = line[3];      </span></span><br><span class="line"><span class="comment">//	//int x1 = x0 + 100 * line[0];  //加上长度为100的向量</span></span><br><span class="line"><span class="comment">//	//int y1 = y0 + 100 * line[1];  //（用单位向量生成）</span></span><br><span class="line"><span class="comment">//	//image = imread("./images/road.jpg", 0);</span></span><br><span class="line"><span class="comment">//	////绘制这条线</span></span><br><span class="line"><span class="comment">//	//cv::line(image, Point(x0, y0), Point(x1, y1), Scalar(0), 0.2); //颜色和宽度</span></span><br><span class="line"><span class="comment">//	//imshow("Fitted line", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// eliminate inconsistent lines</span></span><br><span class="line"><span class="comment">//	//finder.removeLinesOfInconsistentOrientations(ed.getOrientation(), 0.4, 0.1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the detected line image</span></span><br><span class="line"><span class="comment">//	//image = cv::imread("./images/road.jpg", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//finder.drawDetectedLines(image);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Detected Lines (2)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Detected Lines (2)", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////创建霍夫累加器</span></span><br><span class="line"><span class="comment">//	////这里的用的图像类型是uchar，实际类型应该是int</span></span><br><span class="line"><span class="comment">//	//cv::Mat acc(200, 180, CV_8U, cv::Scalar(0));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////选取一个像素点</span></span><br><span class="line"><span class="comment">//	//int x = 50, y = 30;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////循环遍历所有角度</span></span><br><span class="line"><span class="comment">//	//for (int i = 0; i&lt;180; i++) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	double theta = i*PI / 180.;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	//找到对应的rho值</span></span><br><span class="line"><span class="comment">//	//	double rho = x*std::cos(theta) + y*std::sin(theta);</span></span><br><span class="line"><span class="comment">//	//	//j对应-100到100的rho</span></span><br><span class="line"><span class="comment">//	//	int j = static_cast&lt;int&gt;(rho + 100.5);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; i &lt;&lt; "," &lt;&lt; j &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	//增加累加器</span></span><br><span class="line"><span class="comment">//	//	acc.at&lt;uchar&gt;(j, i)++;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// draw the axes</span></span><br><span class="line"><span class="comment">//	//cv::line(acc, cv::Point(0, 0), cv::Point(0, acc.rows - 1), 255);</span></span><br><span class="line"><span class="comment">//	//cv::line(acc, cv::Point(acc.cols - 1, acc.rows - 1), cv::Point(0, acc.rows - 1), 255);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::imwrite("./images/hough1.bmp", 255 - (acc * 100));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Choose a second point</span></span><br><span class="line"><span class="comment">//	//x = 30, y = 10;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// loop over all angles</span></span><br><span class="line"><span class="comment">//	//for (int i = 0; i&lt;180; i++) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	double theta = i*PI / 180.;</span></span><br><span class="line"><span class="comment">//	//	double rho = x*cos(theta) + y*sin(theta);</span></span><br><span class="line"><span class="comment">//	//	int j = static_cast&lt;int&gt;(rho + 100.5);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	acc.at&lt;uchar&gt;(j, i)++;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Hough Accumulator");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Hough Accumulator", acc * 100);</span></span><br><span class="line"><span class="comment">//	//cv::imwrite("./images/hough2.bmp", 255 - (acc * 100));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////检测圆</span></span><br><span class="line"><span class="comment">//	//image = cv::imread("./images/chariot.jpg", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::GaussianBlur(image, image, cv::Size(5, 5), 1.5);</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Vec3f&gt; circles;</span></span><br><span class="line"><span class="comment">//	//cv::HoughCircles(image, circles, cv::HOUGH_GRADIENT,</span></span><br><span class="line"><span class="comment">//	//	2,   // 累加器分辨率(图像尺寸 / 2) </span></span><br><span class="line"><span class="comment">//	//	20,  // 两个圆之间的最小距离</span></span><br><span class="line"><span class="comment">//	//	200, // Canny算子的高阈值</span></span><br><span class="line"><span class="comment">//	//	60, // 最小投票数</span></span><br><span class="line"><span class="comment">//	//	15, 50); // 最小和最大半径</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Circles: " &lt;&lt; circles.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Draw the circles</span></span><br><span class="line"><span class="comment">//	//image = cv::imread("./images/chariot.jpg", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Vec3f&gt;::const_iterator itc = circles.begin();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//while (itc != circles.end()) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	cv::circle(image,</span></span><br><span class="line"><span class="comment">//	//		cv::Point((*itc)[0], (*itc)[1]), // 圆心</span></span><br><span class="line"><span class="comment">//	//		(*itc)[2], //半径</span></span><br><span class="line"><span class="comment">//	//		cv::Scalar(255), // 颜色</span></span><br><span class="line"><span class="comment">//	//		2); // 厚度</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	++itc;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Detected Circles");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Detected Circles", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//5.提取连续区域</span></span><br><span class="line"><span class="comment">//    Mat image = imread("./images/binaryGroup.bmp", 0);</span></span><br><span class="line"><span class="comment">//	if (!image.data)</span></span><br><span class="line"><span class="comment">//		return 0;</span></span><br><span class="line"><span class="comment">//	imshow("Binary Image", image);</span></span><br><span class="line"><span class="comment">//	//用于存储轮廓的向量</span></span><br><span class="line"><span class="comment">//	vector&lt;vector&lt;Point&gt; &gt; contours;</span></span><br><span class="line"><span class="comment">//	findContours(image,</span></span><br><span class="line"><span class="comment">//		contours,           //存储轮廓的向量</span></span><br><span class="line"><span class="comment">//		RETR_EXTERNAL,      //检查外部轮廓</span></span><br><span class="line"><span class="comment">//		CHAIN_APPROX_NONE); //每个轮廓的全部像素</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//查看轮廓得数量</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Contours: " &lt;&lt; contours.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	vector&lt;vector&lt;Point&gt; &gt;::const_iterator itContours = contours.begin();</span></span><br><span class="line"><span class="comment">//	for (; itContours != contours.end(); ++itContours)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		cout &lt;&lt; "Size: " &lt;&lt; itContours-&gt;size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	//在白色图像上画黑色轮廓</span></span><br><span class="line"><span class="comment">//	Mat result(image.size(), CV_8U, Scalar(255));</span></span><br><span class="line"><span class="comment">//	drawContours(result, contours,</span></span><br><span class="line"><span class="comment">//		-1,  //画出全部轮廓</span></span><br><span class="line"><span class="comment">//		0,   //用黑色画</span></span><br><span class="line"><span class="comment">//		2    //厚度为2</span></span><br><span class="line"><span class="comment">//	);</span></span><br><span class="line"><span class="comment">//	imshow("Contours", result);</span></span><br><span class="line"><span class="comment">//	//删除太短或者太长的轮廓</span></span><br><span class="line"><span class="comment">//	int cmin = 50;</span></span><br><span class="line"><span class="comment">//	int cmax = 500;</span></span><br><span class="line"><span class="comment">//	vector&lt; vector&lt;Point&gt; &gt; ::iterator itc = contours.begin();</span></span><br><span class="line"><span class="comment">//	while (itc != contours.end())</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		if (itc-&gt;size() &lt; cmin || itc-&gt;size() &gt; cmax)</span></span><br><span class="line"><span class="comment">//			itc = contours.erase(itc);</span></span><br><span class="line"><span class="comment">//		else</span></span><br><span class="line"><span class="comment">//			++itc;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// draw contours on the original image</span></span><br><span class="line"><span class="comment">//	cv::Mat original = cv::imread("./images/group.jpg");</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::drawContours(original, contours,</span></span><br><span class="line"><span class="comment">//		-1, // draw all contours</span></span><br><span class="line"><span class="comment">//		cv::Scalar(255, 255, 255), // in white</span></span><br><span class="line"><span class="comment">//		2); // with a thickness of 2</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Contours on Animals");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Contours on Animals", original);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	result.setTo(Scalar(255));</span></span><br><span class="line"><span class="comment">//	drawContours(result, contours, -1, 0, 1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	image = imread("./images/binaryGroup.bmp", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//需要思考的是这个二维的矩阵，行代表什么，列代表什么？</span></span><br><span class="line"><span class="comment">//	//首先说，行：代表了一个轮廓，每行的数据是一个数组，数组里面是一系列的点</span></span><br><span class="line"><span class="comment">//	//这些点代表了这个轮廓的位置</span></span><br><span class="line"><span class="comment">//	//所以，contours[0]，代表了第一个轮廓，contours[0][0]，代表了第一个轮廓的某个点</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//A.测试边界框</span></span><br><span class="line"><span class="comment">//	Rect r0 = boundingRect(contours[0]);</span></span><br><span class="line"><span class="comment">//	//画矩形</span></span><br><span class="line"><span class="comment">//	rectangle(result, r0, 0, 2);</span></span><br><span class="line"><span class="comment">//	//B.测试覆盖圆</span></span><br><span class="line"><span class="comment">//	float radius;</span></span><br><span class="line"><span class="comment">//	Point2f center;</span></span><br><span class="line"><span class="comment">//	minEnclosingCircle(contours[1], center, radius);</span></span><br><span class="line"><span class="comment">//	//画圆型</span></span><br><span class="line"><span class="comment">//	circle(result, center, static_cast&lt;int&gt;(radius), 0, 2);</span></span><br><span class="line"><span class="comment">//	//C.测试多边形逼近</span></span><br><span class="line"><span class="comment">//	vector&lt;Point&gt; poly;</span></span><br><span class="line"><span class="comment">//	approxPolyDP(contours[2], poly, 5, true);</span></span><br><span class="line"><span class="comment">//	//画多边形</span></span><br><span class="line"><span class="comment">//	polylines(result, poly, true, 0, 2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Polygon size: " &lt;&lt; poly.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	//D.测试凸包（另一种形式的多边形逼近）</span></span><br><span class="line"><span class="comment">//	std::vector&lt;cv::Point&gt; hull;</span></span><br><span class="line"><span class="comment">//	cv::convexHull(contours[3], hull);</span></span><br><span class="line"><span class="comment">//	//画多边形</span></span><br><span class="line"><span class="comment">//	cv::polylines(result, hull, true, 0, 2);</span></span><br><span class="line"><span class="comment">//	//检测轮廓矩</span></span><br><span class="line"><span class="comment">//	//迭代遍历所有轮廓</span></span><br><span class="line"><span class="comment">//	//在所有区域内部画出重心</span></span><br><span class="line"><span class="comment">//	itc = contours.begin();</span></span><br><span class="line"><span class="comment">//	while (itc != contours.end()) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//计算所有矩形轮廓</span></span><br><span class="line"><span class="comment">//		cv::Moments mom = cv::moments(*itc++);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		//画重心</span></span><br><span class="line"><span class="comment">//		cv::circle(result,</span></span><br><span class="line"><span class="comment">//			// 将重心位置转换成整数</span></span><br><span class="line"><span class="comment">//			cv::Point(mom.m10 / mom.m00, mom.m01 / mom.m00),</span></span><br><span class="line"><span class="comment">//			2, cv::Scalar(0), 2); // 画黑点</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Some Shape descriptors");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Some Shape descriptors", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// 打开一副新的图像</span></span><br><span class="line"><span class="comment">//	image = cv::imread("./images/binaryGroup.bmp", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::findContours(image,</span></span><br><span class="line"><span class="comment">//		contours, </span></span><br><span class="line"><span class="comment">//		cv::RETR_LIST, </span></span><br><span class="line"><span class="comment">//		cv::CHAIN_APPROX_NONE); </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	result.setTo(255);</span></span><br><span class="line"><span class="comment">//	cv::drawContours(result, contours,</span></span><br><span class="line"><span class="comment">//		-1, </span></span><br><span class="line"><span class="comment">//		0,  </span></span><br><span class="line"><span class="comment">//		2); </span></span><br><span class="line"><span class="comment">//	cv::namedWindow("All Contours");</span></span><br><span class="line"><span class="comment">//	cv::imshow("All Contours", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// get a MSER image</span></span><br><span class="line"><span class="comment">//	cv::Mat components;</span></span><br><span class="line"><span class="comment">//	components = cv::imread("./images/mser.bmp", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// create a binary version</span></span><br><span class="line"><span class="comment">//	components = components == 255;</span></span><br><span class="line"><span class="comment">//	// open the image (white background)</span></span><br><span class="line"><span class="comment">//	cv::morphologyEx(components, components, cv::MORPH_OPEN, cv::Mat(), cv::Point(-1, -1), 3);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("MSER image");</span></span><br><span class="line"><span class="comment">//	cv::imshow("MSER image", components);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	contours.clear();</span></span><br><span class="line"><span class="comment">//	//翻转图像 (background must be black)</span></span><br><span class="line"><span class="comment">//	cv::Mat componentsInv = 255 - components;</span></span><br><span class="line"><span class="comment">//	//得到连续区域的轮廓</span></span><br><span class="line"><span class="comment">//	cv::findContours(componentsInv,</span></span><br><span class="line"><span class="comment">//		contours, </span></span><br><span class="line"><span class="comment">//		cv::RETR_EXTERNAL, //检索外部向量</span></span><br><span class="line"><span class="comment">//		cv::CHAIN_APPROX_NONE); </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// white image</span></span><br><span class="line"><span class="comment">//	cv::Mat quadri(components.size(), CV_8U, 255);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//针对全部轮廓</span></span><br><span class="line"><span class="comment">//	std::vector&lt;std::vector&lt;cv::Point&gt; &gt;::iterator it = contours.begin();</span></span><br><span class="line"><span class="comment">//	while (it != contours.end()) &#123;</span></span><br><span class="line"><span class="comment">//		poly.clear();</span></span><br><span class="line"><span class="comment">//		// 多边形逼近轮廓</span></span><br><span class="line"><span class="comment">//		cv::approxPolyDP(*it, poly, 5, true);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		// 是否为四边形</span></span><br><span class="line"><span class="comment">//		if (poly.size() == 4) &#123;</span></span><br><span class="line"><span class="comment">//			// 画出来</span></span><br><span class="line"><span class="comment">//			cv::polylines(quadri, poly, true, 0, 2);</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		++it;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("MSER quadrilateral");</span></span><br><span class="line"><span class="comment">//	cv::imshow("MSER quadrilateral", quadri);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defineed SOBELEDGES</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SOBELEDGES</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EdgeDetector</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">// original image</span></span><br><span class="line">	cv::Mat img;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 16-bit signed int image</span></span><br><span class="line">	cv::Mat sobel;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Aperture size of the Sobel kernel</span></span><br><span class="line">	<span class="keyword">int</span> aperture;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Sobel magnitude</span></span><br><span class="line">	cv::Mat sobelMagnitude;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Sobel orientation</span></span><br><span class="line">	cv::Mat sobelOrientation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	EdgeDetector() : aperture(<span class="number">3</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the aperture size of the kernel</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setAperture</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		aperture = a;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get the aperture size of the kernel</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getAperture</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> aperture;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Compute the Sobel</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">computeSobel</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; image)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::Mat sobelX;</span><br><span class="line">		cv::Mat sobelY;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Compute Sobel</span></span><br><span class="line">		cv::Sobel(image, sobelX, CV_32F, <span class="number">1</span>, <span class="number">0</span>, aperture);</span><br><span class="line">		cv::Sobel(image, sobelY, CV_32F, <span class="number">0</span>, <span class="number">1</span>, aperture);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将笛卡尔坐标系转化为极坐标，得到幅值和角度</span></span><br><span class="line">		cv::cartToPolar(sobelX, sobelY, sobelMagnitude, sobelOrientation);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Compute the Sobel</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">computeSobel</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; image, cv::Mat &amp;sobelX, cv::Mat &amp;sobelY)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Compute Sobel</span></span><br><span class="line">		cv::Sobel(image, sobelX, CV_32F, <span class="number">1</span>, <span class="number">0</span>, aperture);</span><br><span class="line">		cv::Sobel(image, sobelY, CV_32F, <span class="number">0</span>, <span class="number">1</span>, aperture);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Compute magnitude and orientation</span></span><br><span class="line">		cv::cartToPolar(sobelX, sobelY, sobelMagnitude, sobelOrientation);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get Sobel magnitude</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getMagnitude</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> sobelMagnitude;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get Sobel orientation</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getOrientation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> sobelOrientation;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get a thresholded binary map</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getBinaryMap</span><span class="params">(<span class="keyword">double</span> threshold)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::Mat bin;</span><br><span class="line">		cv::threshold(sobelMagnitude, bin, threshold, <span class="number">255</span>, cv::THRESH_BINARY_INV);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> bin;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get a CV_8U image of the Sobel</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getSobelImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::Mat bin;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> minval, maxval;</span><br><span class="line">		cv::minMaxLoc(sobelMagnitude, &amp;minval, &amp;maxval);</span><br><span class="line">		sobelMagnitude.convertTo(bin, CV_8U, <span class="number">255</span> / maxval);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> bin;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get a CV_8U image of the Sobel orientation</span></span><br><span class="line">	<span class="comment">// 1 gray-level = 2 degrees</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getSobelOrientationImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::Mat bin;</span><br><span class="line"></span><br><span class="line">		sobelOrientation.convertTo(bin, CV_8U, <span class="number">90</span> / PI);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> bin;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defineed SOBELEDGES</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !<span class="meta-keyword">define</span> LINEF</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LINEF</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineFinder</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//原始图像</span></span><br><span class="line">	Mat img;</span><br><span class="line">	<span class="comment">//包含被检测直线的端点的向量</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Vec4i&gt; lines;</span><br><span class="line">	<span class="comment">//累加器分辨率参数</span></span><br><span class="line">	<span class="keyword">double</span> deltaRho;</span><br><span class="line">	<span class="keyword">double</span> deltaTheta;</span><br><span class="line">	<span class="comment">//确认直线之前必须收到的最小投票数</span></span><br><span class="line">	<span class="keyword">int</span> minVote;</span><br><span class="line">	<span class="comment">//直线的最小长度</span></span><br><span class="line">	<span class="keyword">double</span> minLength;</span><br><span class="line">	<span class="comment">//直线上允许的最大空隙</span></span><br><span class="line">	<span class="keyword">double</span> maxGap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//默认累加器分辨率是1像素，1度</span></span><br><span class="line">	<span class="comment">//没有空隙，没有最小长度</span></span><br><span class="line">	LineFinder() :deltaRho(<span class="number">1</span>), deltaTheta(PI / <span class="number">180</span>), minVote(<span class="number">10</span>), minLength(<span class="number">0.</span>), maxGap(<span class="number">0.</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置累加器的分辨率</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setAccResolution</span><span class="params">(<span class="keyword">double</span> dRho, <span class="keyword">double</span> dTheta)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		deltaRho = dRho;</span><br><span class="line">		deltaTheta = dTheta;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//设置最小投票数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setMinVote</span><span class="params">(<span class="keyword">int</span> minv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		minVote = minv;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置直线长度和空隙</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setLineLengthAndGap</span><span class="params">(<span class="keyword">double</span> length, <span class="keyword">double</span> gap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		minLength = length;</span><br><span class="line">		maxGap = gap;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//应用概率霍夫变换</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Vec4i&gt; findLines(Mat &amp;binary)</span><br><span class="line">	&#123;</span><br><span class="line">		lines.clear();</span><br><span class="line">		HoughLinesP(binary, lines, deltaRho, deltaTheta, minVote, minLength, maxGap);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> lines;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在图像上绘制出检测出来的直线</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">drawDetectedLines</span><span class="params">(Mat &amp;image, Scalar color = Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//画直线</span></span><br><span class="line">		<span class="built_in">vector</span>&lt;Vec4i&gt;::const_iterator it2 = lines.begin();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (it2 != lines.end())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">Point <span class="title">pt1</span><span class="params">((*it2)[<span class="number">0</span>], (*it2)[<span class="number">1</span>])</span></span>;</span><br><span class="line">			<span class="function">Point <span class="title">pt2</span><span class="params">((*it2)[<span class="number">2</span>], (*it2)[<span class="number">3</span>])</span></span>;</span><br><span class="line"></span><br><span class="line">			line(image, pt1, pt2, color);</span><br><span class="line"></span><br><span class="line">			++it2;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Eliminates lines that do not have an orientation equals to</span></span><br><span class="line">	<span class="comment">// the ones specified in the input matrix of orientations</span></span><br><span class="line">	<span class="comment">// At least the given percentage of pixels on the line must </span></span><br><span class="line">	<span class="comment">// be within plus or minus delta of the corresponding orientation</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4i&gt; removeLinesOfInconsistentOrientations(</span><br><span class="line">		<span class="keyword">const</span> cv::Mat &amp;orientations, <span class="keyword">double</span> percentage, <span class="keyword">double</span> delta) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4i&gt;::iterator it = lines.begin();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// check all lines</span></span><br><span class="line">		<span class="keyword">while</span> (it != lines.end()) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// end points</span></span><br><span class="line">			<span class="keyword">int</span> x1 = (*it)[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">int</span> y1 = (*it)[<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">int</span> x2 = (*it)[<span class="number">2</span>];</span><br><span class="line">			<span class="keyword">int</span> y2 = (*it)[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">			<span class="comment">// line orientation + 90o to get the parallel line</span></span><br><span class="line">			<span class="keyword">double</span> ori1 = <span class="built_in">atan2</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(y1 - y2), <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(x1 - x2)) + PI / <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span> (ori1&gt;PI) ori1 = ori1 - <span class="number">2</span> * PI;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">double</span> ori2 = <span class="built_in">atan2</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(y2 - y1), <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(x2 - x1)) + PI / <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span> (ori2&gt;PI) ori2 = ori2 - <span class="number">2</span> * PI;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// for all points on the line</span></span><br><span class="line">			cv::<span class="function">LineIterator <span class="title">lit</span><span class="params">(orientations, cv::Point(x1, y1), cv::Point(x2, y2))</span></span>;</span><br><span class="line">			<span class="keyword">int</span> i, count = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>, count = <span class="number">0</span>; i &lt; lit.count; i++, ++lit) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">float</span> ori = *(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">float</span> *&gt;(*lit));</span><br><span class="line"></span><br><span class="line">				<span class="comment">// is line orientation similar to gradient orientation ?</span></span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">std</span>::min(<span class="built_in">fabs</span>(ori - ori1), <span class="built_in">fabs</span>(ori - ori2))&lt;delta)</span><br><span class="line">					count++;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">double</span> consistency = count / <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(i);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// set to zero lines of inconsistent orientation</span></span><br><span class="line">			<span class="keyword">if</span> (consistency &lt; percentage) &#123;</span><br><span class="line"></span><br><span class="line">				(*it)[<span class="number">0</span>] = (*it)[<span class="number">1</span>] = (*it)[<span class="number">2</span>] = (*it)[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			++it;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> lines;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !define LINEF</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-08-检测兴趣点"><a href="#Chapter-08-检测兴趣点" class="headerlink" title="Chapter_08 : 检测兴趣点"></a>Chapter_08 : 检测兴趣点</h3><blockquote>
<p>1.Harris角点检测<br>2.GFTT(good-features-to-track)<br>3.drawKeypoints() 换关键点的通用函数<br>4.FAST角点检测<br>5.SURF尺度不变的特征检测<br>6.SIFT尺度不变特征转换<br>7.BRISK(二元稳健恒定可扩展关键点)检测法<br>8.ORB特征检测算法</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/opencv.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/core.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/features2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/imgproc.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/highgui.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/xfeatures2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include "HarrisDetector.h"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"><span class="comment">//using namespace cv;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	//1.Harris角点检测</span></span><br><span class="line"><span class="comment">//	Mat image = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	if (!image.data)</span></span><br><span class="line"><span class="comment">//		return 0;</span></span><br><span class="line"><span class="comment">//	//变成水平的</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("Image", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//检测Harris角点</span></span><br><span class="line"><span class="comment">//	Mat cornerStrength;</span></span><br><span class="line"><span class="comment">//	cornerHarris(image, cornerStrength, </span></span><br><span class="line"><span class="comment">//		         3,     //领域尺寸</span></span><br><span class="line"><span class="comment">//		         3,     //口径尺寸</span></span><br><span class="line"><span class="comment">//		         0.01); //Harris参数</span></span><br><span class="line"><span class="comment">//	//对角点强度进行阈值化</span></span><br><span class="line"><span class="comment">//	Mat harrisCorners;</span></span><br><span class="line"><span class="comment">//	double threshold = 0.0001;</span></span><br><span class="line"><span class="comment">//	cv::threshold(cornerStrength, harrisCorners, threshold, 255, THRESH_BINARY_INV);</span></span><br><span class="line"><span class="comment">//	imshow("Harris_threshold", harrisCorners);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//用一个类去封装Harris</span></span><br><span class="line"><span class="comment">//	HarrisDetected harris;</span></span><br><span class="line"><span class="comment">//	//计算Harris值</span></span><br><span class="line"><span class="comment">//	harris.detect(image);</span></span><br><span class="line"><span class="comment">//	//检测Harris角点</span></span><br><span class="line"><span class="comment">//	vector&lt;Point&gt; pts;</span></span><br><span class="line"><span class="comment">//	harris.getCorners(pts, 0.02);</span></span><br><span class="line"><span class="comment">//	//画出Harris角点</span></span><br><span class="line"><span class="comment">//	harris.drawOnImage(image, pts);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("HarrisDetected", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//2.GFTT(good-features-to-track)</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	// rotate the image (to produce a horizontal image)</span></span><br><span class="line"><span class="comment">//	cv::transpose(image, image);</span></span><br><span class="line"><span class="comment">//	cv::flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//	//计算适合跟踪的特征</span></span><br><span class="line"><span class="comment">//	vector&lt;KeyPoint&gt; keypoints;</span></span><br><span class="line"><span class="comment">//	//GFTT检测器</span></span><br><span class="line"><span class="comment">//	Ptr&lt;GFTTDetector&gt; ptrGFTT = GFTTDetector::create(</span></span><br><span class="line"><span class="comment">//		500,   //关键点的最大值</span></span><br><span class="line"><span class="comment">//		0.01,  //质量等级</span></span><br><span class="line"><span class="comment">//		10     //角点之间允许的最短距离</span></span><br><span class="line"><span class="comment">//	);</span></span><br><span class="line"><span class="comment">//	//检测GFTT</span></span><br><span class="line"><span class="comment">//	ptrGFTT-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	//展示所有关键点</span></span><br><span class="line"><span class="comment">//	vector&lt;KeyPoint&gt;::const_iterator it = keypoints.begin();</span></span><br><span class="line"><span class="comment">//	while (it != keypoints.end())</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		//对每个关键点画圆</span></span><br><span class="line"><span class="comment">//		circle(image, it-&gt;pt, 3, Scalar(255, 255, 255), 1);</span></span><br><span class="line"><span class="comment">//		++it;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("GFTT", image);</span></span><br><span class="line"><span class="comment">//	//3.drawKeypoints() 换关键点的通用函数</span></span><br><span class="line"><span class="comment">//	// Read input image</span></span><br><span class="line"><span class="comment">//	image = cv::imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	// rotate the image (to produce a horizontal image)</span></span><br><span class="line"><span class="comment">//	cv::transpose(image, image);</span></span><br><span class="line"><span class="comment">//	cv::flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Opencv也提供了在图像上画关键点的通用函数</span></span><br><span class="line"><span class="comment">//	cv::drawKeypoints(image,		// 原始图像</span></span><br><span class="line"><span class="comment">//		keypoints,					// 关键点的向量</span></span><br><span class="line"><span class="comment">//		image,						// 输出图像</span></span><br><span class="line"><span class="comment">//		cv::Scalar(255, 255, 255),	// 关键点颜色</span></span><br><span class="line"><span class="comment">//		cv::DrawMatchesFlags::DRAW_OVER_OUTIMG); //画图标志</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the keypoints</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Good Features to Track Detector");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Good Features to Track Detector", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//4.FAST角点检测</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//	//最终的关键点容器</span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	//FAST特征检测器，阈值为40</span></span><br><span class="line"><span class="comment">//	Ptr&lt;FastFeatureDetector&gt; ptrFAST = FastFeatureDetector::create(40);</span></span><br><span class="line"><span class="comment">//	//检测关键点</span></span><br><span class="line"><span class="comment">//	ptrFAST-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	//画关键点</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, image, Scalar(255, 255,255), DrawMatchesFlags::DRAW_OVER_OUTIMG);</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Number of keypoints(FAST): " &lt;&lt; keypoints.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("FAST_01", image);</span></span><br><span class="line"><span class="comment">//	//FAST_02----非极大抑制</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	//检测关键点</span></span><br><span class="line"><span class="comment">//	ptrFAST-&gt;setNonmaxSuppression(false);</span></span><br><span class="line"><span class="comment">//	ptrFAST-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	//画出关键点</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, image, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_OVER_OUTIMG);</span></span><br><span class="line"><span class="comment">//	imshow("FAST FEATURES(ALL)", image);</span></span><br><span class="line"><span class="comment">//	//FAST_03----Grid</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	int total(100);</span></span><br><span class="line"><span class="comment">//	int hstep(5), vstep(3);</span></span><br><span class="line"><span class="comment">//	int hsize(image.cols / hstep), vsize(image.rows / vstep);</span></span><br><span class="line"><span class="comment">//	int subtotal(total / (hstep * vstep));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	Mat imageROI;</span></span><br><span class="line"><span class="comment">//	vector&lt;KeyPoint&gt; gridpoints;</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Grid of" &lt;&lt; vstep &lt;&lt; "by" &lt;&lt; hstep &lt;&lt; "each of size" &lt;&lt; vsize &lt;&lt; "by" &lt;&lt; hsize &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//检测低阈值</span></span><br><span class="line"><span class="comment">//	ptrFAST-&gt;setThreshold(20);</span></span><br><span class="line"><span class="comment">//	//非极大抑制</span></span><br><span class="line"><span class="comment">//	ptrFAST-&gt;setNonmaxSuppression(true);</span></span><br><span class="line"><span class="comment">//	//最终的关键点容器</span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	//检测每一个网格</span></span><br><span class="line"><span class="comment">//	for (int i = 0; i &lt; vstep; i++)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		for (int j = 0; j &lt; hstep; j++)</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			//在当前网格创建ROI</span></span><br><span class="line"><span class="comment">//			imageROI = image(Rect(j * hsize, i * vsize, hsize, vsize));</span></span><br><span class="line"><span class="comment">//			//在网格中检测关键点</span></span><br><span class="line"><span class="comment">//			gridpoints.clear();</span></span><br><span class="line"><span class="comment">//			ptrFAST-&gt;detect(imageROI, gridpoints);</span></span><br><span class="line"><span class="comment">//			cout &lt;&lt; "Number of FAST in grid" &lt;&lt; i &lt;&lt; "," &lt;&lt; j &lt;&lt; ":" &lt;&lt; gridpoints.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//			if (gridpoints.size() &gt; subtotal)</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				for (auto it = gridpoints.begin(); it != gridpoints.begin() + subtotal; ++it)</span></span><br><span class="line"><span class="comment">//				&#123;</span></span><br><span class="line"><span class="comment">//					std::cout &lt;&lt; "  " &lt;&lt; it-&gt;response &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//				&#125;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//			//获取最大强度的FAST特征</span></span><br><span class="line"><span class="comment">//			auto itEnd(gridpoints.end());</span></span><br><span class="line"><span class="comment">//			if (gridpoints.size() &gt; subtotal)</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				//选取最强的特征</span></span><br><span class="line"><span class="comment">//				nth_element(gridpoints.begin(), gridpoints.begin() + subtotal, gridpoints.end(),</span></span><br><span class="line"><span class="comment">//					[](KeyPoint &amp;a, KeyPoint &amp;b) &#123;return a.response &gt; b.response; &#125;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//				itEnd = gridpoints.begin() + subtotal;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//			//加入全局特征容器</span></span><br><span class="line"><span class="comment">//			for (auto it = gridpoints.begin(); it != itEnd; ++it)</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				//转换成图上的坐标</span></span><br><span class="line"><span class="comment">//				it-&gt;pt += Point2f(j * hsize, i * vsize);</span></span><br><span class="line"><span class="comment">//				keypoints.push_back(*it);</span></span><br><span class="line"><span class="comment">//				cout &lt;&lt; "  " &lt;&lt; it-&gt;response &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	//画关键点</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, image, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_OVER_OUTIMG);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("FAST Features (grid)", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//5.SURF尺度不变的特征检测</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//   </span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	//创建SURF特征检测器对象</span></span><br><span class="line"><span class="comment">//	Ptr&lt;xfeatures2d::SurfFeatureDetector&gt; ptrSURF = xfeatures2d::SurfFeatureDetector::create(2000.0);</span></span><br><span class="line"><span class="comment">//	//检测关键点</span></span><br><span class="line"><span class="comment">//	ptrSURF-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	//画出关键点，包括尺度和方向信息</span></span><br><span class="line"><span class="comment">//	Mat featureImage;</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("SURF", featureImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Number of SURF keypoints: " &lt;&lt; keypoints.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Read a second input image</span></span><br><span class="line"><span class="comment">//	image = cv::imread("./images/church03.jpg", cv::IMREAD_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	// rotate the image (to produce a horizontal image)</span></span><br><span class="line"><span class="comment">//	cv::transpose(image, image);</span></span><br><span class="line"><span class="comment">//	cv::flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Detect the SURF features</span></span><br><span class="line"><span class="comment">//	ptrSURF-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::drawKeypoints(image, keypoints, featureImage, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Display the keypoints</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("SURF (2)");</span></span><br><span class="line"><span class="comment">//	cv::imshow("SURF (2)", featureImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//6.SIFT尺度不变特征转换</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", IMREAD_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	Ptr&lt;xfeatures2d::SiftFeatureDetector&gt; ptrSIFT = xfeatures2d::SiftFeatureDetector::create();</span></span><br><span class="line"><span class="comment">//	ptrSIFT-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	//画关键点</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255,255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	</span></span><br><span class="line"><span class="comment">//	imshow("SIFT", featureImage);</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Number of SIFT keypoints: " &lt;&lt; keypoints.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//7.BRISK(二元稳健恒定可扩展关键点)检测法</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	//构造BRISK特征检测器对象</span></span><br><span class="line"><span class="comment">//	Ptr&lt;BRISK&gt; ptrBRISK = BRISK::create(60, 5);</span></span><br><span class="line"><span class="comment">//	//检测关键点</span></span><br><span class="line"><span class="comment">//	ptrBRISK-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	imshow("BRISK", featureImage);</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Number of BRISK keypoints: " &lt;&lt; keypoints.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//8.ORB特征检测算法</span></span><br><span class="line"><span class="comment">//	image = imread("./images/church01.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	transpose(image, image);</span></span><br><span class="line"><span class="comment">//	flip(image, image, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	keypoints.clear();</span></span><br><span class="line"><span class="comment">//	//构造ORB特征检测器</span></span><br><span class="line"><span class="comment">//	Ptr&lt;ORB&gt; ptrORB = ORB::create(75, 1.2, 8);</span></span><br><span class="line"><span class="comment">//	//检测关键点</span></span><br><span class="line"><span class="comment">//	ptrORB-&gt;detect(image, keypoints);</span></span><br><span class="line"><span class="comment">//	//画出关键点</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	imshow("ORB", featureImage);</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; "Number of ORB keypoints: " &lt;&lt; keypoints.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !<span class="meta-keyword">define</span> HARRISD</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HARRISD</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HarrisDetected</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//32位浮点整数的角点强度图像</span></span><br><span class="line">	Mat cornerStrength;</span><br><span class="line">	<span class="comment">//32位浮点整数的阈值化角点图像</span></span><br><span class="line">	Mat cornerTh;</span><br><span class="line">	<span class="comment">//局部最大值图像（内部）</span></span><br><span class="line">	Mat localMax;</span><br><span class="line">	<span class="comment">//平滑导数的领域尺寸</span></span><br><span class="line">	<span class="keyword">int</span> neighborhood;</span><br><span class="line">	<span class="comment">//梯度计算的口径</span></span><br><span class="line">	<span class="keyword">int</span> aperture;</span><br><span class="line">	<span class="comment">//Harris参数</span></span><br><span class="line">	<span class="keyword">double</span> k;</span><br><span class="line">	<span class="comment">//阈值计算的最大强度</span></span><br><span class="line">	<span class="keyword">double</span> maxStrength;</span><br><span class="line">	<span class="comment">//计算得到的阈值（内部）</span></span><br><span class="line">	<span class="keyword">double</span> threshold;</span><br><span class="line">	<span class="comment">//非最大值抑制的领域尺寸</span></span><br><span class="line">	<span class="keyword">double</span> nonMaxSize;</span><br><span class="line">	<span class="comment">//非最大值抑制的内核</span></span><br><span class="line">	Mat kernel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	HarrisDetected() : neighborhood(<span class="number">3</span>), aperture(<span class="number">3</span>), k(<span class="number">0.1</span>), maxStrength(<span class="number">0.0</span>), threshold(<span class="number">0.01</span>), nonMaxSize(<span class="number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		setLocalMaxWindowSize(nonMaxSize);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建用于抑制非最大值的内核</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setLocalMaxWindowSize</span><span class="params">(<span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		nonMaxSize = size;</span><br><span class="line">		kernel.create(nonMaxSize, nonMaxSize, CV_8U);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//计算Harris角点</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">detect</span><span class="params">(<span class="keyword">const</span> Mat&amp; image)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//计算Harris</span></span><br><span class="line">		cornerHarris(image, cornerStrength, neighborhood, aperture, k);</span><br><span class="line">		<span class="comment">//计算内部阈值</span></span><br><span class="line">		minMaxLoc(cornerStrength, <span class="number">0</span>, &amp;maxStrength);</span><br><span class="line">		<span class="comment">//检测局部最大值</span></span><br><span class="line">		Mat dilated;  <span class="comment">//临时图像</span></span><br><span class="line">		dilate(cornerStrength, dilated, Mat());</span><br><span class="line">		compare(cornerStrength, dilated, localMax, CMP_EQ);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用Harris值得到角点分布图</span></span><br><span class="line">	<span class="function">Mat <span class="title">getCornerMap</span><span class="params">(<span class="keyword">double</span> qualityLeval)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Mat cornerMap;</span><br><span class="line">		<span class="comment">//对角点强度进行阈值化</span></span><br><span class="line">		threshold = qualityLeval * maxStrength;</span><br><span class="line">		cv::threshold(cornerStrength, cornerTh, threshold, <span class="number">255</span>, THRESH_BINARY);</span><br><span class="line">		<span class="comment">//转换成8位图像</span></span><br><span class="line">		cornerTh.convertTo(cornerMap, CV_8U);</span><br><span class="line">		<span class="comment">//非最大值抑制</span></span><br><span class="line">		bitwise_and(cornerMap, localMax, cornerMap);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> cornerMap;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用Harris值得到特征点</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getCorners</span><span class="params">(<span class="built_in">vector</span>&lt;Point&gt; &amp;points, <span class="keyword">double</span> qualityLevel)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//获得角点分布图</span></span><br><span class="line">		Mat cornerMap = getCornerMap(qualityLevel);</span><br><span class="line">		<span class="comment">//获得角点</span></span><br><span class="line">		getCorners(points, cornerMap);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//用角点分布图得到特征点</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getCorners</span><span class="params">(<span class="built_in">vector</span>&lt;Point&gt; &amp;points, <span class="keyword">const</span> Mat &amp;cornerMap)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//迭代遍历像素，得到所有特征</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; cornerMap.rows; y++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">const</span> uchar *rowPtr = cornerMap.ptr&lt;uchar&gt;(y);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; cornerMap.cols; x++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//如果他是一个特征点</span></span><br><span class="line">				<span class="keyword">if</span> (rowPtr[x])</span><br><span class="line">				&#123;</span><br><span class="line">					points.push_back(Point(x, y));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在特征点的位置画圆</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">drawOnImage</span><span class="params">(Mat &amp;image, <span class="keyword">const</span> <span class="built_in">vector</span>&lt;Point&gt; &amp;points, Scalar color = Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="keyword">int</span> radius = <span class="number">3</span>, <span class="keyword">int</span> thickness = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">vector</span> &lt;Point&gt; ::const_iterator it = points.begin();</span><br><span class="line">		<span class="comment">//针对所有角点</span></span><br><span class="line">		<span class="keyword">while</span> (it != points.end())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//在每个角点位置画圆</span></span><br><span class="line">			circle(image, *it, radius, color, thickness);</span><br><span class="line">			++it;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !define HARRISD</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-09-描述和匹配兴趣点"><a href="#Chapter-09-描述和匹配兴趣点" class="headerlink" title="Chapter_09 : 描述和匹配兴趣点"></a>Chapter_09 : 描述和匹配兴趣点</h3><blockquote>
<p>1.局部模板匹配—-两个图像的匹配和找一样的模板<br>2.描述并匹配局部强度值模式—-SURF和SIFT<br>3.用二值描述子匹配关键点</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/core.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/imgproc.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/highgui.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/features2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/objdetect.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/xfeatures2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"><span class="comment">//using namespace cv;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	////1.局部模板匹配 ---- 两个图像的匹配</span></span><br><span class="line"><span class="comment">//	//Mat image1 = imread("./images/church01.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	//Mat image2 = imread("./images/church02.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("image1", image1);</span></span><br><span class="line"><span class="comment">//	//imshow("image2", image2);</span></span><br><span class="line"><span class="comment">//	////定义关键点容器</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints1;</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints2;</span></span><br><span class="line"><span class="comment">//	////定义特征检测器</span></span><br><span class="line"><span class="comment">//	//Ptr&lt;FeatureDetector&gt; ptrDetector;  //泛型检测器指针</span></span><br><span class="line"><span class="comment">//	////这里使用FAST检测器</span></span><br><span class="line"><span class="comment">//	//ptrDetector = FastFeatureDetector::create(80);</span></span><br><span class="line"><span class="comment">//	////检测关键点</span></span><br><span class="line"><span class="comment">//	//ptrDetector-&gt;detect(image1, keypoints1);</span></span><br><span class="line"><span class="comment">//	//ptrDetector-&gt;detect(image2, keypoints2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of keypoints (image 1): " &lt;&lt; keypoints1.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of keypoints (image 2): " &lt;&lt; keypoints2.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////定义一个特定大小的矩形（11 * 11）， 用于表示每个关键点周围的图像块</span></span><br><span class="line"><span class="comment">//	////定义正方形的领域</span></span><br><span class="line"><span class="comment">//	//const int nsize(11);</span></span><br><span class="line"><span class="comment">//	//Rect neighborhood(0, 0, nsize, nsize); //11 * 11</span></span><br><span class="line"><span class="comment">//	//Mat patch1;</span></span><br><span class="line"><span class="comment">//	//Mat patch2;</span></span><br><span class="line"><span class="comment">//	////将一副图像的关键点与另一幅图像的所有关键点进行比较，找出最相似的</span></span><br><span class="line"><span class="comment">//	////在第二幅图像中找出与第一幅图像中的每个关键点最匹配的</span></span><br><span class="line"><span class="comment">//	//Mat result;</span></span><br><span class="line"><span class="comment">//	//vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//	////针对图像一的全部关键点</span></span><br><span class="line"><span class="comment">//	//for (int i = 0; i &lt; keypoints1.size(); i++)</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	//定义图像块</span></span><br><span class="line"><span class="comment">//	//	neighborhood.x = keypoints1[i].pt.x - nsize / 2;</span></span><br><span class="line"><span class="comment">//	//	neighborhood.y = keypoints1[i].pt.y - nsize / 2;</span></span><br><span class="line"><span class="comment">//	//	//如果领域超出图像范围，就继续处理下一个点</span></span><br><span class="line"><span class="comment">//	//	if (neighborhood.x &lt; 0 || neighborhood.y &lt; 0 || </span></span><br><span class="line"><span class="comment">//	//		neighborhood.x + nsize &gt;= image1.cols || neighborhood.y + nsize &gt;= image1.rows)</span></span><br><span class="line"><span class="comment">//	//		continue;</span></span><br><span class="line"><span class="comment">//	//	//第一幅图像的块</span></span><br><span class="line"><span class="comment">//	//	patch1 = image1(neighborhood);</span></span><br><span class="line"><span class="comment">//	//	//存放最匹配的值</span></span><br><span class="line"><span class="comment">//	//	DMatch bestMatch;</span></span><br><span class="line"><span class="comment">//	//	//针对第二幅图像的全部关键点</span></span><br><span class="line"><span class="comment">//	//	for (int j = 0; j &lt; keypoints2.size(); j++)</span></span><br><span class="line"><span class="comment">//	//	&#123;</span></span><br><span class="line"><span class="comment">//	//		//定义图像块</span></span><br><span class="line"><span class="comment">//	//		neighborhood.x = keypoints2[j].pt.x - nsize / 2;</span></span><br><span class="line"><span class="comment">//	//		neighborhood.y = keypoints2[j].pt.y - nsize / 2;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//		//如果领域超出图像范围，就继续处理下一个点</span></span><br><span class="line"><span class="comment">//	//		if (neighborhood.x &lt; 0 || neighborhood.y &lt; 0 ||</span></span><br><span class="line"><span class="comment">//	//			neighborhood.x + nsize &gt;= image2.cols || neighborhood.y + nsize &gt;= image2.rows)</span></span><br><span class="line"><span class="comment">//	//			continue;</span></span><br><span class="line"><span class="comment">//	//		//第二幅图像的块</span></span><br><span class="line"><span class="comment">//	//		patch2 = image2(neighborhood);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	    //匹配两个图像块</span></span><br><span class="line"><span class="comment">//	//		matchTemplate(patch1, patch2, result, TM_SQDIFF);</span></span><br><span class="line"><span class="comment">//	//		//cv::matchTemplate(patch1, patch2, result, cv::TM_SQDIFF);</span></span><br><span class="line"><span class="comment">//	//		//检查是否为最佳匹配</span></span><br><span class="line"><span class="comment">//	//		if (result.at&lt;float&gt;(0, 0) &lt; bestMatch.distance)</span></span><br><span class="line"><span class="comment">//	//		&#123;</span></span><br><span class="line"><span class="comment">//	//			bestMatch.distance = result.at &lt;float&gt;(0, 0);</span></span><br><span class="line"><span class="comment">//	//			bestMatch.queryIdx = i;</span></span><br><span class="line"><span class="comment">//	//			bestMatch.trainIdx = j;</span></span><br><span class="line"><span class="comment">//	//		&#125;</span></span><br><span class="line"><span class="comment">//	//	&#125;</span></span><br><span class="line"><span class="comment">//	//	//添加最佳匹配</span></span><br><span class="line"><span class="comment">//	//	matches.push_back(bestMatch);</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of matches: " &lt;&lt; matches.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	////提取50个最佳匹配项</span></span><br><span class="line"><span class="comment">//	//nth_element(matches.begin(), matches.begin() + 50, matches.end());</span></span><br><span class="line"><span class="comment">//	//matches.erase(matches.begin() + 50, matches.end());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of matches (after): " &lt;&lt; matches.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////画出匹配结果</span></span><br><span class="line"><span class="comment">//	//Mat matchImage;</span></span><br><span class="line"><span class="comment">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, matchImage, Scalar(255, 255, 255), Scalar(255, 255, 255));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("Matches", matchImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////模板匹配----寻找一样的部分</span></span><br><span class="line"><span class="comment">//	////定义一个模板</span></span><br><span class="line"><span class="comment">//	//Mat target(image1, Rect(80, 105, 30, 30));</span></span><br><span class="line"><span class="comment">//	////展示模板</span></span><br><span class="line"><span class="comment">//	//imshow("Template", target);</span></span><br><span class="line"><span class="comment">//	////定义搜索区域-----这里用图像的上半部分</span></span><br><span class="line"><span class="comment">//	//Mat roi(image2, Rect(0, 0, image2.cols, image2.rows / 2));</span></span><br><span class="line"><span class="comment">//	////进行模板匹配</span></span><br><span class="line"><span class="comment">//	//matchTemplate(roi,  //搜索区域</span></span><br><span class="line"><span class="comment">//	//	target,         //模板</span></span><br><span class="line"><span class="comment">//	//	result,         //结果</span></span><br><span class="line"><span class="comment">//	//	TM_SQDIFF);     //相似度</span></span><br><span class="line"><span class="comment">//	////找到最相似的位置</span></span><br><span class="line"><span class="comment">//	//double minVal, maxVal;</span></span><br><span class="line"><span class="comment">//	//Point minPt, maxPt;</span></span><br><span class="line"><span class="comment">//	//minMaxLoc(result, &amp;minVal, &amp;maxVal, &amp;minPt, &amp;maxPt);</span></span><br><span class="line"><span class="comment">//	////在相似度最高的位置画矩形框</span></span><br><span class="line"><span class="comment">//	////本例为minPt</span></span><br><span class="line"><span class="comment">//	//rectangle(roi, Rect(minPt.x, minPt.y, target.cols, target.rows), 255);</span></span><br><span class="line"><span class="comment">//	////展示模板</span></span><br><span class="line"><span class="comment">//	//imshow("Best", image2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//////2.描述并匹配局部强度值模式----SURF和SIFT</span></span><br><span class="line"><span class="comment">//	////SURF</span></span><br><span class="line"><span class="comment">//	////读图片</span></span><br><span class="line"><span class="comment">//	//Mat image1 = imread("./images/church01.jpg", IMREAD_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	//Mat image2 = imread("./images/church02.jpg", IMREAD_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//if (!image1.data || !image2.data)</span></span><br><span class="line"><span class="comment">//	//	return 0;</span></span><br><span class="line"><span class="comment">//	//imshow("image1", image1);</span></span><br><span class="line"><span class="comment">//	//imshow("image2", image2);</span></span><br><span class="line"><span class="comment">//	////定义关键点的检测器</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints1;</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints2;</span></span><br><span class="line"><span class="comment">//	////定义特征检测器----SURF</span></span><br><span class="line"><span class="comment">//	//Ptr&lt;Feature2D&gt; ptrFeature2D = xfeatures2d::SURF::create(2000.0);</span></span><br><span class="line"><span class="comment">//	////检测关键点</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detect(image1, keypoints1);</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detect(image2, keypoints2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////画出特征点</span></span><br><span class="line"><span class="comment">//	//cv::Mat featureImage;</span></span><br><span class="line"><span class="comment">//	//cv::drawKeypoints(image1, keypoints1, featureImage, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("SURF");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("SURF", featureImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of SURF keypoints (image 1): " &lt;&lt; keypoints1.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of SURF keypoints (image 2): " &lt;&lt; keypoints2.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////提取描述子</span></span><br><span class="line"><span class="comment">//	//Mat descriptors1;</span></span><br><span class="line"><span class="comment">//	//Mat descriptors2;</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;compute(image1, keypoints1, descriptors1);</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;compute(image2, keypoints2, descriptors2);</span></span><br><span class="line"><span class="comment">//	////构造匹配器</span></span><br><span class="line"><span class="comment">//	//BFMatcher matcher(NORM_L2);  //度量距离</span></span><br><span class="line"><span class="comment">//	////匹配两幅图片的描述子</span></span><br><span class="line"><span class="comment">//	//vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//	//matcher.match(descriptors1, descriptors2, matches);</span></span><br><span class="line"><span class="comment">//	////画出匹配的描述子</span></span><br><span class="line"><span class="comment">//	//Mat imageMatches;</span></span><br><span class="line"><span class="comment">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, imageMatches, </span></span><br><span class="line"><span class="comment">//	//	Scalar(255, 255, 255), Scalar(255, 255, 255), vector&lt;char&gt;(), </span></span><br><span class="line"><span class="comment">//	//	DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	//imshow("SURF Matches", imageMatches);</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; "Number of matches: " &lt;&lt; matches.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////对于每个关键点找出最符合的2个匹配点 ----比率检验法</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;std::vector&lt;cv::DMatch&gt; &gt; matches2;</span></span><br><span class="line"><span class="comment">//	//matcher.knnMatch(descriptors1, descriptors2,</span></span><br><span class="line"><span class="comment">//	//	matches2,</span></span><br><span class="line"><span class="comment">//	//	2); //找出k个最佳匹配项</span></span><br><span class="line"><span class="comment">//	//matches.clear();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// 执行比率检验法</span></span><br><span class="line"><span class="comment">//	//double ratioMax = 0.6;</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;std::vector&lt;cv::DMatch&gt; &gt;::iterator it;</span></span><br><span class="line"><span class="comment">//	//for (it = matches2.begin(); it != matches2.end(); ++it) &#123;</span></span><br><span class="line"><span class="comment">//	//	//  第一个最佳匹配项/第二个最佳匹配项</span></span><br><span class="line"><span class="comment">//	//	if ((*it)[0].distance / (*it)[1].distance &lt; ratioMax) &#123;</span></span><br><span class="line"><span class="comment">//	//		// 这个匹配项可以接收</span></span><br><span class="line"><span class="comment">//	//		matches.push_back((*it)[0]);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	&#125;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//// </span></span><br><span class="line"><span class="comment">//	//cv::drawMatches(</span></span><br><span class="line"><span class="comment">//	//	image1, keypoints1, // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	image2, keypoints2, // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	matches,           // the matches</span></span><br><span class="line"><span class="comment">//	//	imageMatches,      // the image produced</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of lines</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of points</span></span><br><span class="line"><span class="comment">//	//	std::vector&lt; char &gt;(),    // masks if any </span></span><br><span class="line"><span class="comment">//	//	cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of matches (after ratio test): " &lt;&lt; matches.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("SURF Matches (ratio test at 0.6)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("SURF Matches (ratio test at 0.6)", imageMatches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////匹配差值的阈值化</span></span><br><span class="line"><span class="comment">//	//// 指定范围的匹配</span></span><br><span class="line"><span class="comment">//	//float maxDist = 0.3;</span></span><br><span class="line"><span class="comment">//	//matches2.clear();</span></span><br><span class="line"><span class="comment">//	//matcher.radiusMatch(descriptors1, descriptors2, matches2,maxDist); //两个描述子之间的最大允许差值</span></span><br><span class="line"><span class="comment">//	//			</span></span><br><span class="line"><span class="comment">//	//cv::drawMatches(</span></span><br><span class="line"><span class="comment">//	//	image1, keypoints1, // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	image2, keypoints2, // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	matches2,          // the matches</span></span><br><span class="line"><span class="comment">//	//	imageMatches,      // the image produced</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of lines</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of points</span></span><br><span class="line"><span class="comment">//	//	std::vector&lt;std::vector&lt; char &gt;&gt;(),    // masks if any </span></span><br><span class="line"><span class="comment">//	//	cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//int nmatches = 0;</span></span><br><span class="line"><span class="comment">//	//for (int i = 0; i&lt; matches2.size(); i++)</span></span><br><span class="line"><span class="comment">//	//	nmatches += matches2[i].size();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of matches (with max radius): " &lt;&lt; nmatches &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("SURF Matches (with max radius)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("SURF Matches (with max radius)", imageMatches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////SIFT</span></span><br><span class="line"><span class="comment">//	//image1 = cv::imread("./images/church01.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	//image2 = cv::imread("./images/church03.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of SIFT keypoints (image 1): " &lt;&lt; keypoints1.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of SIFT keypoints (image 2): " &lt;&lt; keypoints2.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("image1_sift", image1);</span></span><br><span class="line"><span class="comment">//	//imshow("image2_sift", image2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D = xfeatures2d::SIFT::create();</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detectAndCompute(image1, noArray(), keypoints1, descriptors1);</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//matcher.match(descriptors1, descriptors2, matches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// extract the 50 best matches</span></span><br><span class="line"><span class="comment">//	//std::nth_element(matches.begin(), matches.begin() + 50, matches.end());</span></span><br><span class="line"><span class="comment">//	//matches.erase(matches.begin() + 50, matches.end());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// draw matches</span></span><br><span class="line"><span class="comment">//	//cv::drawMatches(</span></span><br><span class="line"><span class="comment">//	//	image1, keypoints1, // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	image2, keypoints2, // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	matches,            // the matches</span></span><br><span class="line"><span class="comment">//	//	imageMatches,      // the image produced</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of lines</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255), // color of points</span></span><br><span class="line"><span class="comment">//	//	std::vector&lt;char&gt;(), cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	//// Display the image of matches</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Multi-scale SIFT Matches");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Multi-scale SIFT Matches", imageMatches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of matches: " &lt;&lt; matches.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//3.用二值描述子匹配关键点</span></span><br><span class="line"><span class="comment">//    Mat image1 = imread("./images/church01.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//	Mat image2 = imread("./images/church02.jpg", CV_LOAD_IMAGE_GRAYSCALE);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//定义关键点容器和描述子</span></span><br><span class="line"><span class="comment">//	vector&lt;KeyPoint&gt; keypoints1;</span></span><br><span class="line"><span class="comment">//	vector&lt;KeyPoint&gt; keypoints2;</span></span><br><span class="line"><span class="comment">//	Mat descriptors1;</span></span><br><span class="line"><span class="comment">//	Mat descriptors2;</span></span><br><span class="line"><span class="comment">//	//定义特征检测器/描述子</span></span><br><span class="line"><span class="comment">//	Ptr&lt;Feature2D&gt; feature = ORB::create(60);   //大约60个特征点</span></span><br><span class="line"><span class="comment">//	//检测并描述关键点</span></span><br><span class="line"><span class="comment">//	//检测ORB特征</span></span><br><span class="line"><span class="comment">//	feature-&gt;detectAndCompute(image1, noArray(), keypoints1, descriptors1);</span></span><br><span class="line"><span class="comment">//	feature-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);</span></span><br><span class="line"><span class="comment">//	</span></span><br><span class="line"><span class="comment">//	Mat featureImage;</span></span><br><span class="line"><span class="comment">//	drawKeypoints(image1, keypoints1, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	//展示角点</span></span><br><span class="line"><span class="comment">//	imshow("ORB", featureImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; "Number of ORB keypoints (image 1): " &lt;&lt; keypoints1.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; "Number of ORB keypoints (image 2): " &lt;&lt; keypoints2.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//构建匹配器</span></span><br><span class="line"><span class="comment">//	BFMatcher matcher(NORM_HAMMING);</span></span><br><span class="line"><span class="comment">//	//匹配两幅图像的描述子</span></span><br><span class="line"><span class="comment">//	vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//	matcher.match(descriptors1, descriptors2, matches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::Mat imageMatches;</span></span><br><span class="line"><span class="comment">//	cv::drawMatches(</span></span><br><span class="line"><span class="comment">//		image1, keypoints1, // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//		image2, keypoints2, // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//		matches,           // the matches</span></span><br><span class="line"><span class="comment">//		imageMatches,      // the image produced</span></span><br><span class="line"><span class="comment">//		cv::Scalar(255, 255, 255),  // color of lines</span></span><br><span class="line"><span class="comment">//		cv::Scalar(255, 255, 255),  // color of points</span></span><br><span class="line"><span class="comment">//		std::vector&lt; char &gt;(),    // masks if any </span></span><br><span class="line"><span class="comment">//		cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::imshow("ORB Matches", imageMatches);</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; "Number of matches: " &lt;&lt; matches.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-10-估算图像之间的投影关系"><a href="#Chapter-10-估算图像之间的投影关系" class="headerlink" title="Chapter_10 : 估算图像之间的投影关系"></a>Chapter_10 : 估算图像之间的投影关系</h3><blockquote>
<p>1.计算图像对的基础矩阵<br>2.用RANSAC算法匹配图像<br>3.计算两幅图像之间的单应矩阵—-找到对应的点和拼接两幅图像<br>4.检测图像中的平面目标</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;vector&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/core.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/imgproc.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/highgui.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/features2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/calib3d.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/objdetect.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/xfeatures2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/stitching.hpp&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include "RobustMatcher.h"</span></span><br><span class="line"><span class="comment">//#include "TargetMatcher.h"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"><span class="comment">//using namespace cv;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	////1.计算图像对的基础矩阵</span></span><br><span class="line"><span class="comment">//	//Mat image1 = imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">//	//Mat image2 = imread("./images/church03.jpg", 0);</span></span><br><span class="line"><span class="comment">//	//if (!image1.data || !image2.data)</span></span><br><span class="line"><span class="comment">//	//	return 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the images</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Right Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Right Image", image1);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Left Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Left Image", image2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////定义关键点容器和描述子、</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints1;</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints2;</span></span><br><span class="line"><span class="comment">//	//Mat descriptors1, descriptors2;</span></span><br><span class="line"><span class="comment">//	////构建SIFT特征检测器</span></span><br><span class="line"><span class="comment">//	//Ptr&lt;Feature2D&gt; ptrFeature2D = xfeatures2d::SIFT::create(74);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detectAndCompute(image1, noArray(), keypoints1, descriptors1);</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of SIFT points (1): " &lt;&lt; keypoints1.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of SIFT points (2): " &lt;&lt; keypoints2.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////画关键点</span></span><br><span class="line"><span class="comment">//	//cv::Mat imageKP;</span></span><br><span class="line"><span class="comment">//	//cv::drawKeypoints(image1, keypoints1, imageKP, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Right SIFT Features");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Right SIFT Features", imageKP);</span></span><br><span class="line"><span class="comment">//	//cv::drawKeypoints(image2, keypoints2, imageKP, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Left SIFT Features");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Left SIFT Features", imageKP);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////构建匹配类的实例</span></span><br><span class="line"><span class="comment">//	//BFMatcher matcher(NORM_L2, true);</span></span><br><span class="line"><span class="comment">//	////匹配描述子</span></span><br><span class="line"><span class="comment">//	//vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//	//matcher.match(descriptors1, descriptors2, matches);</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "Number of matched points: " &lt;&lt; matches.size() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	////手动的选择一些匹配的描述子</span></span><br><span class="line"><span class="comment">//	//vector&lt;DMatch&gt; selMatches;</span></span><br><span class="line"><span class="comment">//	//// make sure to double-check if the selected matches are valid</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[2]);</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[5]);</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[16]);</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[19]);</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[14]);</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[34]);</span></span><br><span class="line"><span class="comment">//	//selMatches.push_back(matches[29]);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////画出选择的描述子</span></span><br><span class="line"><span class="comment">//	//cv::Mat imageMatches;</span></span><br><span class="line"><span class="comment">//	//cv::drawMatches(image1, keypoints1,  // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	image2, keypoints2,  // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	selMatches,			// the selected matches</span></span><br><span class="line"><span class="comment">//	//	imageMatches,		// the image produced</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),</span></span><br><span class="line"><span class="comment">//	//	std::vector&lt;char&gt;(),</span></span><br><span class="line"><span class="comment">//	//	2</span></span><br><span class="line"><span class="comment">//	//); // color of the lines</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Matches");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Matches", imageMatches);</span></span><br><span class="line"><span class="comment">//	////将一维关键点转变为二维的点</span></span><br><span class="line"><span class="comment">//	//vector&lt;int&gt; pointIndexes1;</span></span><br><span class="line"><span class="comment">//	//vector&lt;int&gt; pointIndexes2;</span></span><br><span class="line"><span class="comment">//	//for (vector&lt;DMatch&gt;::const_iterator it = selMatches.begin(); it != selMatches.end(); ++it)</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	pointIndexes1.push_back(it-&gt;queryIdx);</span></span><br><span class="line"><span class="comment">//	//	pointIndexes2.push_back(it-&gt;trainIdx);</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	////为了在findFundamentalMat中使用，需要先把这些关键点转化为Point2f类型</span></span><br><span class="line"><span class="comment">//	//vector&lt;Point2f&gt; selPoints1, selPoints2;</span></span><br><span class="line"><span class="comment">//	//KeyPoint::convert(keypoints1, selPoints1, pointIndexes1);</span></span><br><span class="line"><span class="comment">//	//KeyPoint::convert(keypoints2, selPoints2, pointIndexes2);</span></span><br><span class="line"><span class="comment">//	////通过画点来检查</span></span><br><span class="line"><span class="comment">//	//vector&lt;Point2f&gt; ::const_iterator it = selPoints1.begin();</span></span><br><span class="line"><span class="comment">//	//while (it != selPoints1.end())</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	//在每个角点位置画圆</span></span><br><span class="line"><span class="comment">//	//	circle(image1, *it, 3, Scalar(255, 255, 255), 2);</span></span><br><span class="line"><span class="comment">//	//	++it;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	//it = selPoints2.begin();</span></span><br><span class="line"><span class="comment">//	//while (it != selPoints2.end()) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	// draw a circle at each corner location</span></span><br><span class="line"><span class="comment">//	//	cv::circle(image2, *it, 3, cv::Scalar(255, 255, 255), 2);</span></span><br><span class="line"><span class="comment">//	//	++it;</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//	////用7对匹配项计算基础矩阵</span></span><br><span class="line"><span class="comment">//	//Mat fundamental = findFundamentalMat(</span></span><br><span class="line"><span class="comment">//	//    selPoints1, //第一幅图像的7个点</span></span><br><span class="line"><span class="comment">//	//    selPoints2, //第二幅图像的7个点</span></span><br><span class="line"><span class="comment">//	//	FM_7POINT); //7个点的方法</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; "F-Matrix size= " &lt;&lt; fundamental.rows &lt;&lt; "," &lt;&lt; fundamental.cols &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	//Mat fund(fundamental, cv::Rect(0, 0, 3, 3));</span></span><br><span class="line"><span class="comment">//	////在右侧图像上画出对极线的左侧点</span></span><br><span class="line"><span class="comment">//	//vector&lt;Vec3f&gt; lines1;</span></span><br><span class="line"><span class="comment">//	//computeCorrespondEpilines(selPoints1, //图像点</span></span><br><span class="line"><span class="comment">//	//	1,                 //在第一副图像中（也可在第二幅图像中）</span></span><br><span class="line"><span class="comment">//	//	fund,       //基础矩阵</span></span><br><span class="line"><span class="comment">//	//	lines1);           //对极线的向量</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; "size of F matrix:" &lt;&lt; fund.rows &lt;&lt; "x" &lt;&lt; fund.cols &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	////遍历全部对极线</span></span><br><span class="line"><span class="comment">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines1.begin();</span></span><br><span class="line"><span class="comment">//	//	it != lines1.end(); ++it) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	// 画出第一列和最后一列之间的线条</span></span><br><span class="line"><span class="comment">//	//	cv::line(image2, cv::Point(0, -(*it)[2] / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Point(image2.cols, -((*it)[2] + (*it)[0] * image2.cols) / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Scalar(255, 255, 255));</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// draw the left points corresponding epipolar lines in left image </span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Vec3f&gt; lines2;</span></span><br><span class="line"><span class="comment">//	//cv::computeCorrespondEpilines(cv::Mat(selPoints2), 2, fund, lines2);</span></span><br><span class="line"><span class="comment">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines2.begin();</span></span><br><span class="line"><span class="comment">//	//	it != lines2.end(); ++it) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	// draw the epipolar line between first and last column</span></span><br><span class="line"><span class="comment">//	//	cv::line(image1, cv::Point(0, -(*it)[2] / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Point(image1.cols, -((*it)[2] + (*it)[0] * image1.cols) / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Scalar(255, 255, 255));</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// combine both images</span></span><br><span class="line"><span class="comment">//	//cv::Mat both(image1.rows, image1.cols + image2.cols, CV_8U);</span></span><br><span class="line"><span class="comment">//	//image1.copyTo(both.colRange(0, image1.cols));</span></span><br><span class="line"><span class="comment">//	//image2.copyTo(both.colRange(image1.cols, image1.cols + image2.cols));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the images with points and epipolar lines</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Epilines");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Epilines", both);</span></span><br><span class="line"><span class="comment">//	///*</span></span><br><span class="line"><span class="comment">//	//// Convert keypoints into Point2f</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Point2f&gt; points1, points2, newPoints1, newPoints2;</span></span><br><span class="line"><span class="comment">//	//cv::KeyPoint::convert(keypoints1, points1);</span></span><br><span class="line"><span class="comment">//	//cv::KeyPoint::convert(keypoints2, points2);</span></span><br><span class="line"><span class="comment">//	//cv::correctMatches(fund, points1, points2, newPoints1, newPoints2);</span></span><br><span class="line"><span class="comment">//	//cv::KeyPoint::convert(newPoints1, keypoints1);</span></span><br><span class="line"><span class="comment">//	//cv::KeyPoint::convert(newPoints2, keypoints2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::drawMatches(image1, keypoints1,  // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//	//image2, keypoints2,  // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//	//matches,			// the matches</span></span><br><span class="line"><span class="comment">//	//imageMatches,		// the image produced</span></span><br><span class="line"><span class="comment">//	//cv::Scalar(255, 255, 255),</span></span><br><span class="line"><span class="comment">//	//cv::Scalar(255, 255, 255),</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;char&gt;(),</span></span><br><span class="line"><span class="comment">//	//2</span></span><br><span class="line"><span class="comment">//	//); // color of the lines</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Corrected matches");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Corrected matches", imageMatches);</span></span><br><span class="line"><span class="comment">//	//*/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//2.用RANSAC算法匹配图像</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//	// Read input images</span></span><br><span class="line"><span class="comment">// //   cv::Mat image1 = cv::imread("./images/church01.jpg", 0);</span></span><br><span class="line"><span class="comment">// //   cv::Mat image2 = cv::imread("./images/church03.jpg", 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// //   if (!image1.data || !image2.data)</span></span><br><span class="line"><span class="comment">// //        return 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// //   // Display the images</span></span><br><span class="line"><span class="comment">// //   cv::namedWindow("Right Image");</span></span><br><span class="line"><span class="comment">// //   cv::imshow("Right Image", image1);</span></span><br><span class="line"><span class="comment">// //   cv::namedWindow("Left Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Left Image", image2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////准备匹配器（用默认参数）</span></span><br><span class="line"><span class="comment">//	////SIFT检测器和描述子</span></span><br><span class="line"><span class="comment">//	//RobustMatcher rmatcher(xfeatures2d::SIFT::create(250));</span></span><br><span class="line"><span class="comment">//	////匹配两幅图像</span></span><br><span class="line"><span class="comment">//	//vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints1, keypoints2;</span></span><br><span class="line"><span class="comment">//	//Mat fundamental = rmatcher.match(image1, image2, matches, keypoints1, keypoints2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//Mat imageMatches;</span></span><br><span class="line"><span class="comment">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, imageMatches,</span></span><br><span class="line"><span class="comment">//	//	Scalar(255, 255, 255), Scalar(255, 255, 255), vector&lt;char&gt;(), 2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("Matches", imageMatches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Convert keypoints into Point2f	</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Point2f&gt; points1, points2;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//for (std::vector&lt;cv::DMatch&gt;::const_iterator it = matches.begin();</span></span><br><span class="line"><span class="comment">//	//	it != matches.end(); ++it) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	// Get the position of left keypoints</span></span><br><span class="line"><span class="comment">//	//	float x = keypoints1[it-&gt;queryIdx].pt.x;</span></span><br><span class="line"><span class="comment">//	//	float y = keypoints1[it-&gt;queryIdx].pt.y;</span></span><br><span class="line"><span class="comment">//	//	points1.push_back(keypoints1[it-&gt;queryIdx].pt);</span></span><br><span class="line"><span class="comment">//	//	cv::circle(image1, cv::Point(x, y), 3, cv::Scalar(255, 255, 255), 3);</span></span><br><span class="line"><span class="comment">//	//	// Get the position of right keypoints</span></span><br><span class="line"><span class="comment">//	//	x = keypoints2[it-&gt;trainIdx].pt.x;</span></span><br><span class="line"><span class="comment">//	//	y = keypoints2[it-&gt;trainIdx].pt.y;</span></span><br><span class="line"><span class="comment">//	//	cv::circle(image2, cv::Point(x, y), 3, cv::Scalar(255, 255, 255), 3);</span></span><br><span class="line"><span class="comment">//	//	points2.push_back(keypoints2[it-&gt;trainIdx].pt);</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Draw the epipolar lines</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Vec3f&gt; lines1;</span></span><br><span class="line"><span class="comment">//	//cv::computeCorrespondEpilines(points1, 1, fundamental, lines1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines1.begin();</span></span><br><span class="line"><span class="comment">//	//	it != lines1.end(); ++it) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	cv::line(image2, cv::Point(0, -(*it)[2] / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Point(image2.cols, -((*it)[2] + (*it)[0] * image2.cols) / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Scalar(255, 255, 255));</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;cv::Vec3f&gt; lines2;</span></span><br><span class="line"><span class="comment">//	//cv::computeCorrespondEpilines(points2, 2, fundamental, lines2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines2.begin();</span></span><br><span class="line"><span class="comment">//	//	it != lines2.end(); ++it) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	cv::line(image1, cv::Point(0, -(*it)[2] / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Point(image1.cols, -((*it)[2] + (*it)[0] * image1.cols) / (*it)[1]),</span></span><br><span class="line"><span class="comment">//	//		cv::Scalar(255, 255, 255));</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Display the images with epipolar lines</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Right Image Epilines (RANSAC)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Right Image Epilines (RANSAC)", image1);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Left Image Epilines (RANSAC)");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Left Image Epilines (RANSAC)", image2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////3.计算两幅图像之间的单应矩阵----找到对应的点和拼接两幅图像</span></span><br><span class="line"><span class="comment">//	//// Read input images</span></span><br><span class="line"><span class="comment">// //   cv::Mat image1 = cv::imread("./images/parliament1.jpg", 0);</span></span><br><span class="line"><span class="comment">// //   cv::Mat image2 = cv::imread("./images/parliament2.jpg", 0);</span></span><br><span class="line"><span class="comment">// //   if (!image1.data || !image2.data)</span></span><br><span class="line"><span class="comment">// //         return 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// //   // Display the images</span></span><br><span class="line"><span class="comment">// //   cv::namedWindow("Image 1");</span></span><br><span class="line"><span class="comment">// //   cv::imshow("Image 1", image1);</span></span><br><span class="line"><span class="comment">// //   cv::namedWindow("Image 2");</span></span><br><span class="line"><span class="comment">// //   cv::imshow("Image 2", image2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////构建关键点容器和描述子</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints1;</span></span><br><span class="line"><span class="comment">//	//vector&lt;KeyPoint&gt; keypoints2;</span></span><br><span class="line"><span class="comment">//	//Mat descriptors1, descriptors2;</span></span><br><span class="line"><span class="comment">// //   //构建SIFT特征检测器</span></span><br><span class="line"><span class="comment">//	//Ptr&lt;Feature2D&gt; ptrFeature2D = xfeatures2d::SIFT::create(74);</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detectAndCompute(image1, noArray() ,keypoints1, descriptors1);</span></span><br><span class="line"><span class="comment">//	//ptrFeature2D-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; " Number of feature points (1):" &lt;&lt; keypoints1.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; " Number of feature points (2):" &lt;&lt; keypoints2.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//BFMatcher matcher(NORM_L2, true);</span></span><br><span class="line"><span class="comment">//	//vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//	//matcher.match(descriptors1, descriptors2, matches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//Mat imageMatches;</span></span><br><span class="line"><span class="comment">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, imageMatches, </span></span><br><span class="line"><span class="comment">//	//	Scalar(255, 255, 255), Scalar(255, 255, 255), vector&lt;char&gt;(), 2);</span></span><br><span class="line"><span class="comment">//	//imshow("Matches (pure rotation case)", imageMatches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////接下来使用findHomography函数实现，和findFundamentalMat函数相似</span></span><br><span class="line"><span class="comment">//	////我们要将关键点转变为Point2f</span></span><br><span class="line"><span class="comment">//	//vector&lt;Point2f&gt; points1, points2;</span></span><br><span class="line"><span class="comment">//	//for (vector&lt;DMatch&gt;::const_iterator it = matches.begin(); it != matches.end(); ++it)</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//	//获得左边关键点的位置</span></span><br><span class="line"><span class="comment">//	//	float x = keypoints1[it-&gt;queryIdx].pt.x;</span></span><br><span class="line"><span class="comment">//	//	float y = keypoints1[it-&gt;queryIdx].pt.y;</span></span><br><span class="line"><span class="comment">//	//	points1.push_back(Point2f(x, y));</span></span><br><span class="line"><span class="comment">//	//	//获得右边关键点的位置</span></span><br><span class="line"><span class="comment">//	//    x = keypoints2[it-&gt;trainIdx].pt.x;</span></span><br><span class="line"><span class="comment">//	//	y = keypoints2[it-&gt;trainIdx].pt.y;</span></span><br><span class="line"><span class="comment">//	//	points2.push_back(Point2f(x, y));</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cout &lt;&lt; points1.size() &lt;&lt; " " &lt;&lt; points2.size() &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">//	////找到第一幅图像和第二幅图像之间的单应矩阵</span></span><br><span class="line"><span class="comment">//	//vector&lt;char&gt; inliers;</span></span><br><span class="line"><span class="comment">//	//Mat homography = findHomography(</span></span><br><span class="line"><span class="comment">//	//    points1, points2,   //对应的点</span></span><br><span class="line"><span class="comment">//	//	inliers,            //输出的局部匹配项</span></span><br><span class="line"><span class="comment">//	//	RANSAC,             //RANSAC方法</span></span><br><span class="line"><span class="comment">//	//	1.);                //到重复投影点最大的距离</span></span><br><span class="line"><span class="comment">//	//						// Draw the inlier points</span></span><br><span class="line"><span class="comment">//	//cv::drawMatches(image1, keypoints1,  // 1st image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	image2, keypoints2,  // 2nd image and its keypoints</span></span><br><span class="line"><span class="comment">//	//	matches,			// the matches</span></span><br><span class="line"><span class="comment">//	//	imageMatches,		// the image produced</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of the lines</span></span><br><span class="line"><span class="comment">//	//	cv::Scalar(255, 255, 255),  // color of the keypoints</span></span><br><span class="line"><span class="comment">//	//	inliers,</span></span><br><span class="line"><span class="comment">//	//	2);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Homography inlier points");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Homography inlier points", imageMatches);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////将第一幅图像扭曲到第二幅图像----实现两幅图像的拼接</span></span><br><span class="line"><span class="comment">//	//Mat result;</span></span><br><span class="line"><span class="comment">//	//warpPerspective(image1,     //输入图像</span></span><br><span class="line"><span class="comment">//	//	result,                 //输出图像</span></span><br><span class="line"><span class="comment">//	//	homography,             //单应矩阵</span></span><br><span class="line"><span class="comment">//	//	Size(2 * image1.cols, image1.rows)); //输出图像的尺寸</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////把第一幅图像复制到完整图像的第一个半边</span></span><br><span class="line"><span class="comment">//	//Mat harf(result, Rect(0, 0, image2.cols, image2.rows));</span></span><br><span class="line"><span class="comment">//	//image2.copyTo(harf);  //把image2复制到image1的感兴趣区域</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//imshow("Image mosaic", result);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	////图像拼接技术----用Stitcher生成全景图</span></span><br><span class="line"><span class="comment">//	////Mat img1 = imread("./images/parliament1.jpg");</span></span><br><span class="line"><span class="comment">//	////Mat img2 = imread("./images/parliament2.jpg");</span></span><br><span class="line"><span class="comment">//	////imshow("img1", img1);</span></span><br><span class="line"><span class="comment">//	////imshow("img2", img2);</span></span><br><span class="line"><span class="comment">//	////vector&lt;Mat&gt; images;</span></span><br><span class="line"><span class="comment">//	////images.push_back(img1);</span></span><br><span class="line"><span class="comment">//	////images.push_back(img2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//vector&lt;Mat&gt; images;</span></span><br><span class="line"><span class="comment">//	//images.push_back(imread("./images/parliament1_1.jpg"));</span></span><br><span class="line"><span class="comment">//	//images.push_back(imread("./images/parliament2_1.jpg"));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//Mat panorama;  //输出的全景图</span></span><br><span class="line"><span class="comment">//	////创建拼接器</span></span><br><span class="line"><span class="comment">//	//Stitcher stitcher = Stitcher::createDefault();</span></span><br><span class="line"><span class="comment">//	////拼接图像</span></span><br><span class="line"><span class="comment">//	//Stitcher::Status status = stitcher.stitch(images, panorama);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//if (status == cv::Stitcher::OK) // success?</span></span><br><span class="line"><span class="comment">//	//&#123;</span></span><br><span class="line"><span class="comment">//	//</span></span><br><span class="line"><span class="comment">// //    	cv::namedWindow("Panorama");</span></span><br><span class="line"><span class="comment">//	//	cv::imshow("Panorama", panorama);</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//4.检测图像中的平面目标</span></span><br><span class="line"><span class="comment">//	// Read input images</span></span><br><span class="line"><span class="comment">//    cv::Mat target = cv::imread("./images/cookbook1.bmp", 0);</span></span><br><span class="line"><span class="comment">//    cv::Mat image = cv::imread("./images/objects.jpg", 0);</span></span><br><span class="line"><span class="comment">//    if (!target.data || !image.data)</span></span><br><span class="line"><span class="comment">//      return 0;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    // Display the images</span></span><br><span class="line"><span class="comment">//    cv::namedWindow("Target");</span></span><br><span class="line"><span class="comment">//    cv::imshow("Target", target);</span></span><br><span class="line"><span class="comment">//    cv::namedWindow("Image");</span></span><br><span class="line"><span class="comment">//    cv::imshow("Image", image);</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//	//初始化匹配器</span></span><br><span class="line"><span class="comment">//	TargetMatcher tmatcher(FastFeatureDetector::create(10), BRISK::create());</span></span><br><span class="line"><span class="comment">//	tmatcher.setNormType(NORM_HAMMING);</span></span><br><span class="line"><span class="comment">//	//定义输出数据</span></span><br><span class="line"><span class="comment">//	vector&lt;DMatch&gt; matches;</span></span><br><span class="line"><span class="comment">//	vector&lt;KeyPoint&gt; keypoints1, keypoints2;</span></span><br><span class="line"><span class="comment">//	vector&lt;Point2f&gt; corners;</span></span><br><span class="line"><span class="comment">//	//设定目标图像</span></span><br><span class="line"><span class="comment">//	tmatcher.setTarget(target);</span></span><br><span class="line"><span class="comment">//	//匹配目标图像</span></span><br><span class="line"><span class="comment">//	tmatcher.detectTarget(image, corners);</span></span><br><span class="line"><span class="comment">//	//画出目标角点</span></span><br><span class="line"><span class="comment">//	if (corners.size() == 4) &#123; //已获得检测结果</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		cv::line(image, cv::Point(corners[0]), cv::Point(corners[1]), cv::Scalar(255, 255, 255), 6);</span></span><br><span class="line"><span class="comment">//		cv::line(image, cv::Point(corners[1]), cv::Point(corners[2]), cv::Scalar(255, 255, 255), 6);</span></span><br><span class="line"><span class="comment">//		cv::line(image, cv::Point(corners[2]), cv::Point(corners[3]), cv::Scalar(255, 255, 255), 6);</span></span><br><span class="line"><span class="comment">//		cv::line(image, cv::Point(corners[3]), cv::Point(corners[0]), cv::Scalar(255, 255, 255), 6);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::namedWindow("Target detection");</span></span><br><span class="line"><span class="comment">//	cv::imshow("Target detection", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined MATCHER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MATCHER</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/features2d.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/xfeatures2d.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NOCHECK      0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CROSSCHECK   1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RATIOCHECK   2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOTHCHECK    3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobustMatcher</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//特征点检测器对象的指针</span></span><br><span class="line">	Ptr&lt;FeatureDetector&gt; detector;</span><br><span class="line">	<span class="comment">//特征描述子提取器对象的指针</span></span><br><span class="line">	Ptr&lt;DescriptorExtractor&gt; descriptor;</span><br><span class="line">	<span class="keyword">int</span> normType;</span><br><span class="line">	<span class="keyword">float</span> ratio;   <span class="comment">//第一个和第二个NN之间的最大比率</span></span><br><span class="line">	<span class="keyword">bool</span> refineF;  <span class="comment">//如果等于true，则会优化基础矩阵</span></span><br><span class="line">	<span class="keyword">bool</span> refineM;  <span class="comment">//如果等于true，则会优化匹配结果</span></span><br><span class="line">	<span class="keyword">double</span> distance;    <span class="comment">//到极点的最小距离</span></span><br><span class="line">	<span class="keyword">double</span> confidence;  <span class="comment">//可信度（概率）</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	RobustMatcher(<span class="keyword">const</span> cv::Ptr&lt;cv::FeatureDetector&gt; &amp;detector,</span><br><span class="line">		<span class="keyword">const</span> cv::Ptr&lt;cv::DescriptorExtractor&gt; &amp;descriptor = cv::Ptr&lt;cv::DescriptorExtractor&gt;())</span><br><span class="line">		: detector(detector), descriptor(descriptor), normType(cv::NORM_L2),</span><br><span class="line">		ratio(<span class="number">0.8f</span>), refineF(<span class="literal">true</span>), refineM(<span class="literal">true</span>), confidence(<span class="number">0.98</span>), distance(<span class="number">1.0</span>)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//这里使用关联描述子</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;descriptor) &#123;</span><br><span class="line">			<span class="keyword">this</span>-&gt;descriptor = <span class="keyword">this</span>-&gt;detector;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the feature detector</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFeatureDetector</span><span class="params">(<span class="keyword">const</span> cv::Ptr&lt;cv::FeatureDetector&gt;&amp; detect)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>-&gt;detector = detect;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set descriptor extractor</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setDescriptorExtractor</span><span class="params">(<span class="keyword">const</span> cv::Ptr&lt;cv::DescriptorExtractor&gt;&amp; desc)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>-&gt;descriptor = desc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the norm to be used for matching</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setNormType</span><span class="params">(<span class="keyword">int</span> norm)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		normType = norm;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the minimum distance to epipolar in RANSAC</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setMinDistanceToEpipolar</span><span class="params">(<span class="keyword">double</span> d)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		distance = d;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set confidence level in RANSAC</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setConfidenceLevel</span><span class="params">(<span class="keyword">double</span> c)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		confidence = c;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the NN ratio</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setRatio</span><span class="params">(<span class="keyword">float</span> r)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		ratio = r;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// if you want the F matrix to be recalculated</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">refineFundamental</span><span class="params">(<span class="keyword">bool</span> flag)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		refineF = flag;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// if you want the matches to be refined using F</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">refineMatches</span><span class="params">(<span class="keyword">bool</span> flag)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		refineM = flag;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Clear matches for which NN ratio is &gt; than threshold</span></span><br><span class="line">	<span class="comment">// return the number of removed points </span></span><br><span class="line">	<span class="comment">// (corresponding entries being cleared, i.e. size will be 0)</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">ratioTest</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; &gt;&amp; inputMatches,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; outputMatches)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> removed = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// for all matches</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; &gt;::const_iterator matchIterator = inputMatches.begin();</span><br><span class="line">			matchIterator != inputMatches.end(); ++matchIterator) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//   first best match/second best match</span></span><br><span class="line">			<span class="keyword">if</span> ((matchIterator-&gt;size() &gt; <span class="number">1</span>) &amp;&amp; <span class="comment">// if 2 NN has been identified </span></span><br><span class="line">				(*matchIterator)[<span class="number">0</span>].distance / (*matchIterator)[<span class="number">1</span>].distance &lt; ratio) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// it is an acceptable match</span></span><br><span class="line">				outputMatches.push_back((*matchIterator)[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">				removed++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> removed;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Insert symmetrical matches in symMatches vector</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">symmetryTest</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; matches1,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; matches2,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; symMatches)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// for all matches image 1 -&gt; image 2</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator matchIterator1 = matches1.begin();</span><br><span class="line">			matchIterator1 != matches1.end(); ++matchIterator1) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// for all matches image 2 -&gt; image 1</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator matchIterator2 = matches2.begin();</span><br><span class="line">				matchIterator2 != matches2.end(); ++matchIterator2) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Match symmetry test</span></span><br><span class="line">				<span class="keyword">if</span> (matchIterator1-&gt;queryIdx == matchIterator2-&gt;trainIdx  &amp;&amp;</span><br><span class="line">					matchIterator2-&gt;queryIdx == matchIterator1-&gt;trainIdx) &#123;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// add symmetrical match</span></span><br><span class="line">					symMatches.push_back(*matchIterator1);</span><br><span class="line">					<span class="keyword">break</span>; <span class="comment">// next match in image 1 -&gt; image 2</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Apply both ratio and symmetry test</span></span><br><span class="line">	<span class="comment">// (often an over-kill)</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ratioAndSymmetryTest</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; &gt;&amp; matches1,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; &gt;&amp; matches2,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; outputMatches)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Remove matches for which NN ratio is &gt; than threshold</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// clean image 1 -&gt; image 2 matches</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; ratioMatches1;</span><br><span class="line">		<span class="keyword">int</span> removed = ratioTest(matches1, ratioMatches1);</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2 (ratio test) : "</span> &lt;&lt; ratioMatches1.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="comment">// clean image 2 -&gt; image 1 matches</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; ratioMatches2;</span><br><span class="line">		removed = ratioTest(matches2, ratioMatches2);</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2 (ratio test) : "</span> &lt;&lt; ratioMatches2.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Remove non-symmetrical matches</span></span><br><span class="line">		symmetryTest(ratioMatches1, ratioMatches2, outputMatches);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points (symmetry test): "</span> &lt;&lt; outputMatches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 用RANSAC算法获取优质匹配项</span></span><br><span class="line">	<span class="comment">// 返回基础矩阵和匹配项</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">ransacTest</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; matches,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;&amp; keypoints1,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;&amp; keypoints2,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; outMatches)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//把关键点转变为Point2f类型	</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; points1, points2;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator it = matches.begin();</span><br><span class="line">			it != matches.end(); ++it) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//获取左侧关键点的位置</span></span><br><span class="line">			points1.push_back(keypoints1[it-&gt;queryIdx].pt);</span><br><span class="line">			<span class="comment">//获取右侧关键点的位置</span></span><br><span class="line">			points2.push_back(keypoints2[it-&gt;trainIdx].pt);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 用 RANSAC 计算F矩阵</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;uchar&gt; inliers(points1.size(), <span class="number">0</span>);</span><br><span class="line">		cv::Mat fundamental = cv::findFundamentalMat(</span><br><span class="line">			points1, points2, <span class="comment">//匹配像素点</span></span><br><span class="line">			inliers,         <span class="comment">//匹配状态(inlier or outlier)  </span></span><br><span class="line">			cv::FM_RANSAC,   <span class="comment">// RANSAC 算法</span></span><br><span class="line">			distance,        <span class="comment">// 到对极线的距离</span></span><br><span class="line">			confidence);     <span class="comment">// 置信度</span></span><br><span class="line"></span><br><span class="line">		 <span class="comment">//取下剩下的 (inliers) 匹配项</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;uchar&gt;::const_iterator itIn = inliers.begin();</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator itM = matches.begin();</span><br><span class="line">		<span class="comment">// 遍历所有的匹配项</span></span><br><span class="line">		<span class="keyword">for</span> (; itIn != inliers.end(); ++itIn, ++itM) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (*itIn) &#123; <span class="comment">// it is a valid match</span></span><br><span class="line"></span><br><span class="line">				outMatches.push_back(*itM);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (refineF || refineM) &#123;</span><br><span class="line">			<span class="comment">// The F matrix will be recomputed with all accepted matches</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// Convert keypoints into Point2f for final F computation	</span></span><br><span class="line">			points1.clear();</span><br><span class="line">			points2.clear();</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator it = outMatches.begin();</span><br><span class="line">				it != outMatches.end(); ++it) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Get the position of left keypoints</span></span><br><span class="line">				points1.push_back(keypoints1[it-&gt;queryIdx].pt);</span><br><span class="line">				<span class="comment">// Get the position of right keypoints</span></span><br><span class="line">				points2.push_back(keypoints2[it-&gt;trainIdx].pt);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Compute 8-point F from all accepted matches</span></span><br><span class="line">			fundamental = cv::findFundamentalMat(</span><br><span class="line">				points1, points2, <span class="comment">// matching points</span></span><br><span class="line">				cv::FM_8POINT); <span class="comment">// 8-point method</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (refineM) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; newPoints1, newPoints2;</span><br><span class="line">				<span class="comment">// refine the matches</span></span><br><span class="line">				correctMatches(fundamental,             <span class="comment">// F matrix</span></span><br><span class="line">					points1, points2,        <span class="comment">// original position</span></span><br><span class="line">					newPoints1, newPoints2); <span class="comment">// new position</span></span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; points1.size(); i++) &#123;</span><br><span class="line"></span><br><span class="line">					<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"("</span> &lt;&lt; keypoints1[outMatches[i].queryIdx].pt.x</span><br><span class="line">						&lt;&lt; <span class="string">","</span> &lt;&lt; keypoints1[outMatches[i].queryIdx].pt.y</span><br><span class="line">						&lt;&lt; <span class="string">") -&gt; "</span>;</span><br><span class="line">					<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"("</span> &lt;&lt; newPoints1[i].x</span><br><span class="line">						&lt;&lt; <span class="string">","</span> &lt;&lt; newPoints1[i].y &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">					<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"("</span> &lt;&lt; keypoints2[outMatches[i].trainIdx].pt.x</span><br><span class="line">						&lt;&lt; <span class="string">","</span> &lt;&lt; keypoints2[outMatches[i].trainIdx].pt.y</span><br><span class="line">						&lt;&lt; <span class="string">") -&gt; "</span>;</span><br><span class="line">					<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"("</span> &lt;&lt; newPoints2[i].x</span><br><span class="line">						&lt;&lt; <span class="string">","</span> &lt;&lt; newPoints2[i].y &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">					keypoints1[outMatches[i].queryIdx].pt.x = newPoints1[i].x;</span><br><span class="line">					keypoints1[outMatches[i].queryIdx].pt.y = newPoints1[i].y;</span><br><span class="line">					keypoints2[outMatches[i].trainIdx].pt.x = newPoints2[i].x;</span><br><span class="line">					keypoints2[outMatches[i].trainIdx].pt.y = newPoints2[i].y;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> fundamental;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//用RANSAC算法匹配特征点</span></span><br><span class="line">	<span class="comment">//返回基础矩阵和输出的匹配项</span></span><br><span class="line">	<span class="comment">//这是一个简单的展示，和书上的一样，下面有个比较复杂的</span></span><br><span class="line">	<span class="function">Mat <span class="title">matchBook</span><span class="params">(Mat &amp;image1, Mat &amp;image2,  <span class="comment">//输入图像</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">vector</span>&lt;DMatch&gt; &amp;matches,         <span class="comment">//输出匹配项</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">vector</span>&lt;KeyPoint&gt; &amp;keypoints1,    <span class="comment">//输出关键点</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">vector</span>&lt;KeyPoint&gt; &amp;keypoints2)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//1.检测特征点</span></span><br><span class="line">		detector-&gt;detect(image1, keypoints1);</span><br><span class="line">		detector-&gt;detect(image2, keypoints2);</span><br><span class="line">		<span class="comment">//2.提取特征描述子</span></span><br><span class="line">		Mat descriptors1, descriptors2;</span><br><span class="line">		descriptor-&gt;compute(image1, keypoints1, descriptors1);</span><br><span class="line">		descriptor-&gt;compute(image2, keypoints2, descriptors2);</span><br><span class="line">		<span class="comment">//3.匹配两幅图像描述子</span></span><br><span class="line">		<span class="comment">//（用于部分检测方法）</span></span><br><span class="line">		<span class="comment">//构造匹配类的实例（带交叉检查）</span></span><br><span class="line">		<span class="function">BFMatcher <span class="title">matcher</span><span class="params">(normType,  <span class="comment">//差距衡量</span></span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="literal">true</span>)</span></span>;                   <span class="comment">//交叉检查标志</span></span><br><span class="line">		<span class="comment">//匹配描述子</span></span><br><span class="line">		<span class="built_in">vector</span>&lt;DMatch&gt; outputMatches;</span><br><span class="line">		matcher.match(descriptors1, descriptors2, outputMatches);</span><br><span class="line">		<span class="comment">//4.用RANSAC算法验证匹配项</span></span><br><span class="line">		Mat fundamental = ransacTest(outputMatches, keypoints1, keypoints2, matches);</span><br><span class="line">		<span class="comment">//返回基础矩阵</span></span><br><span class="line">		<span class="keyword">return</span> fundamental;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//用RANSAC算法匹配特征点</span></span><br><span class="line">	<span class="comment">//返回基础矩阵和输出的匹配项</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">match</span><span class="params">(cv::Mat&amp; image1, cv::Mat&amp; image2, <span class="comment">// 输入图像</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; matches, <span class="comment">// 输出匹配项和关键点</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;&amp; keypoints1, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;&amp; keypoints2,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">int</span> check = CROSSCHECK)</span> </span>&#123;  <span class="comment">// check type (symmetry or ratio or none or both)</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//检测特征点</span></span><br><span class="line">		detector-&gt;detect(image1, keypoints1);</span><br><span class="line">		detector-&gt;detect(image2, keypoints2);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of feature points (1): "</span> &lt;&lt; keypoints1.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of feature points (2): "</span> &lt;&lt; keypoints2.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 提取特征描述子</span></span><br><span class="line">		cv::Mat descriptors1, descriptors2;</span><br><span class="line">		descriptor-&gt;compute(image1, keypoints1, descriptors1);</span><br><span class="line">		descriptor-&gt;compute(image2, keypoints2, descriptors2);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"descriptor matrix size: "</span> &lt;&lt; descriptors1.rows &lt;&lt; <span class="string">" by "</span> &lt;&lt; descriptors1.cols &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3. Match the two image descriptors</span></span><br><span class="line">		<span class="comment">//    (optionaly apply some checking method)</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Construction of the matcher with crosscheck </span></span><br><span class="line">		cv::<span class="function">BFMatcher <span class="title">matcher</span><span class="params">(normType,            <span class="comment">//distance measure</span></span></span></span><br><span class="line"><span class="function"><span class="params">			check == CROSSCHECK)</span></span>;  <span class="comment">// crosscheck flag</span></span><br><span class="line"></span><br><span class="line">								   <span class="comment">// vectors of matches</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; &gt; matches1;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; &gt; matches2;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; outputMatches;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// call knnMatch if ratio check is required</span></span><br><span class="line">		<span class="keyword">if</span> (check == RATIOCHECK || check == BOTHCHECK) &#123;</span><br><span class="line">			<span class="comment">// from image 1 to image 2</span></span><br><span class="line">			<span class="comment">// based on k nearest neighbours (with k=2)</span></span><br><span class="line">			matcher.knnMatch(descriptors1, descriptors2,</span><br><span class="line">				matches1, <span class="comment">// vector of matches (up to 2 per entry) </span></span><br><span class="line">				<span class="number">2</span>);		  <span class="comment">// return 2 nearest neighbours</span></span><br><span class="line"></span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2: "</span> &lt;&lt; matches1.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (check == BOTHCHECK) &#123;</span><br><span class="line">				<span class="comment">// from image 2 to image 1</span></span><br><span class="line">				<span class="comment">// based on k nearest neighbours (with k=2)</span></span><br><span class="line">				matcher.knnMatch(descriptors2, descriptors1,</span><br><span class="line">					matches2, <span class="comment">// vector of matches (up to 2 per entry) </span></span><br><span class="line">					<span class="number">2</span>);		  <span class="comment">// return 2 nearest neighbours</span></span><br><span class="line"></span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 2-&gt;1: "</span> &lt;&lt; matches2.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// select check method</span></span><br><span class="line">		<span class="keyword">switch</span> (check) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CROSSCHECK:</span><br><span class="line">			matcher.match(descriptors1, descriptors2, outputMatches);</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2 (after cross-check): "</span> &lt;&lt; outputMatches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> RATIOCHECK:</span><br><span class="line">			ratioTest(matches1, outputMatches);</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2 (after ratio test): "</span> &lt;&lt; outputMatches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> BOTHCHECK:</span><br><span class="line">			ratioAndSymmetryTest(matches1, matches2, outputMatches);</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2 (after ratio and cross-check): "</span> &lt;&lt; outputMatches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> NOCHECK:</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			matcher.match(descriptors1, descriptors2, outputMatches);</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points 1-&gt;2: "</span> &lt;&lt; outputMatches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 4. Validate matches using RANSAC</span></span><br><span class="line">		cv::Mat fundamental = ransacTest(outputMatches, keypoints1, keypoints2, matches);</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matched points (after RANSAC): "</span> &lt;&lt; matches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// return the found fundamental matrix</span></span><br><span class="line">		<span class="keyword">return</span> fundamental;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// ！define MATCHER</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined TMATCHER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TMATCHER</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VERBOSE 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/features2d.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/calib3d.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/features2d.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TargetMatcher</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//特征点检测器对象的指针</span></span><br><span class="line">	Ptr&lt;FeatureDetector&gt; detector;</span><br><span class="line">	<span class="comment">//特征描述子提取器对象的指针</span></span><br><span class="line">	Ptr&lt;DescriptorExtractor&gt; descriptor;</span><br><span class="line">	<span class="comment">//目标图像</span></span><br><span class="line">	Mat target;</span><br><span class="line">	<span class="comment">//比较描述子容器</span></span><br><span class="line">	<span class="keyword">int</span> normType;</span><br><span class="line">	<span class="comment">//最小重投影误差</span></span><br><span class="line">	<span class="keyword">double</span> distance;</span><br><span class="line">	<span class="comment">//金字塔形图像的数量</span></span><br><span class="line">	<span class="keyword">int</span> numberOfLevels;</span><br><span class="line">	<span class="comment">//层级之间的范围</span></span><br><span class="line">	<span class="keyword">double</span> scaleFactor;</span><br><span class="line">	<span class="comment">//目标图像构建的金字塔以及它的关键点</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Mat&gt; pyramid;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;KeyPoint&gt; &gt; pyrKeypoints;</span><br><span class="line">	<span class="built_in">vector</span>&lt;Mat&gt; pyrDescriptors;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建目标图像的金字塔</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">createPyramid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建目标图像的金字塔</span></span><br><span class="line">		pyramid.clear();</span><br><span class="line">		cv::<span class="function">Mat <span class="title">layer</span><span class="params">(target)</span></span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfLevels; i++) &#123; <span class="comment">// 逐层缩小</span></span><br><span class="line">			pyramid.push_back(target.clone());</span><br><span class="line">			resize(target, target, cv::Size(), scaleFactor, scaleFactor);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		pyrKeypoints.clear();</span><br><span class="line">		pyrDescriptors.clear();</span><br><span class="line">		<span class="comment">// 逐层检测关键点和描述子</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfLevels; i++) &#123;</span><br><span class="line">			<span class="comment">// 在第i层检测目标关键点</span></span><br><span class="line">			pyrKeypoints.push_back(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;());</span><br><span class="line">			detector-&gt;detect(pyramid[i], pyrKeypoints[i]);</span><br><span class="line">			<span class="keyword">if</span> (VERBOSE)</span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Interest points: target="</span> &lt;&lt; pyrKeypoints[i].size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			<span class="comment">//在第i层计算描述子</span></span><br><span class="line">			pyrDescriptors.push_back(cv::Mat());</span><br><span class="line">			descriptor-&gt;compute(pyramid[i], pyrKeypoints[i], pyrDescriptors[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	TargetMatcher(<span class="keyword">const</span> cv::Ptr&lt;cv::FeatureDetector&gt; &amp;detector,</span><br><span class="line">		<span class="keyword">const</span> cv::Ptr&lt;cv::DescriptorExtractor&gt; &amp;descriptor = cv::Ptr&lt;cv::DescriptorExtractor&gt;(),</span><br><span class="line">		<span class="keyword">int</span> numberOfLevels = <span class="number">8</span>, <span class="keyword">double</span> scaleFactor = <span class="number">0.9</span>)</span><br><span class="line">		: detector(detector), descriptor(descriptor), normType(cv::NORM_L2), distance(<span class="number">1.0</span>),</span><br><span class="line">		numberOfLevels(numberOfLevels), scaleFactor(scaleFactor) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// in this case use the associated descriptor</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;descriptor) &#123;</span><br><span class="line">			<span class="keyword">this</span>-&gt;descriptor = <span class="keyword">this</span>-&gt;detector;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the norm to be used for matching</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setNormType</span><span class="params">(<span class="keyword">int</span> norm)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		normType = norm;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the minimum reprojection distance</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setReprojectionDistance</span><span class="params">(<span class="keyword">double</span> d)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		distance = d;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置目标图像</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setTarget</span><span class="params">(<span class="keyword">const</span> Mat t)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (VERBOSE)</span><br><span class="line">			cv::imshow(<span class="string">"Target"</span>, t);</span><br><span class="line">		target = t;</span><br><span class="line">		createPyramid();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Identify good matches using RANSAC</span></span><br><span class="line">	<span class="comment">// Return homography matrix and output matches</span></span><br><span class="line">	<span class="comment">//下面的是更好的</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">ransacTest</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; matches,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;&amp; keypoints1,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt;&amp; keypoints2,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;&amp; outMatches)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Convert keypoints into Point2f	</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; points1, points2;</span><br><span class="line">		outMatches.clear();</span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator it = matches.begin();</span><br><span class="line">			it != matches.end(); ++it) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Get the position of left keypoints</span></span><br><span class="line">			points1.push_back(keypoints1[it-&gt;queryIdx].pt);</span><br><span class="line">			<span class="comment">// Get the position of right keypoints</span></span><br><span class="line">			points2.push_back(keypoints2[it-&gt;trainIdx].pt);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Find the homography between image 1 and image 2</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;uchar&gt; inliers(points1.size(), <span class="number">0</span>);</span><br><span class="line">		cv::Mat homography = cv::findHomography(</span><br><span class="line">			points1, points2, <span class="comment">// corresponding points</span></span><br><span class="line">			inliers,         <span class="comment">// match status (inlier or outlier)  </span></span><br><span class="line">			cv::RHO,	     <span class="comment">// RHO method</span></span><br><span class="line">			distance);       <span class="comment">// max distance to reprojection point</span></span><br><span class="line"></span><br><span class="line">							 <span class="comment">// extract the surviving (inliers) matches</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;uchar&gt;::const_iterator itIn = inliers.begin();</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt;::const_iterator itM = matches.begin();</span><br><span class="line">		<span class="comment">// for all matches</span></span><br><span class="line">		<span class="keyword">for</span> (; itIn != inliers.end(); ++itIn, ++itM) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (*itIn) &#123; <span class="comment">// it is a valid match</span></span><br><span class="line"></span><br><span class="line">				outMatches.push_back(*itM);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> homography;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 检测预先定义的平面目标</span></span><br><span class="line">	<span class="comment">// 返回单应矩阵和检测到的目标的4个角点</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">detectTarget</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; image,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="comment">// 目标角点的坐标（顺时针方向）</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt;&amp; detectedCorners)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1. 检测图像的关键点</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::KeyPoint&gt; keypoints;</span><br><span class="line">		detector-&gt;detect(image, keypoints);</span><br><span class="line">		<span class="keyword">if</span> (VERBOSE)</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Interest points: image="</span> &lt;&lt; keypoints.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="comment">// 计算描述子</span></span><br><span class="line">		cv::Mat descriptors;</span><br><span class="line">		descriptor-&gt;compute(image, keypoints, descriptors);</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; matches;</span><br><span class="line"></span><br><span class="line">		cv::Mat bestHomography;</span><br><span class="line">		cv::Size bestSize;</span><br><span class="line">		<span class="keyword">int</span> maxInliers = <span class="number">0</span>;</span><br><span class="line">		cv::Mat homography;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 构建匹配器</span></span><br><span class="line">		cv::<span class="function">BFMatcher <span class="title">matcher</span><span class="params">(normType)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2. 对金字塔的每层， 鲁棒匹配单应矩阵</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfLevels; i++) &#123;</span><br><span class="line">			<span class="comment">// 在目标和图像之间发现RANSAC单应矩阵</span></span><br><span class="line">			matches.clear();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 匹配描述子</span></span><br><span class="line">			matcher.match(pyrDescriptors[i], descriptors, matches);</span><br><span class="line">			<span class="keyword">if</span> (VERBOSE)</span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of matches (level "</span> &lt;&lt; i &lt;&lt; <span class="string">")="</span> &lt;&lt; matches.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">			<span class="comment">// 用RANSAC验证匹配项</span></span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::DMatch&gt; inliers;</span><br><span class="line">			homography = ransacTest(matches, pyrKeypoints[i], keypoints, inliers);</span><br><span class="line">			<span class="keyword">if</span> (VERBOSE)</span><br><span class="line">				<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of inliers="</span> &lt;&lt; inliers.size() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (inliers.size() &gt; maxInliers) &#123; <span class="comment">// 有更好的 H</span></span><br><span class="line">				maxInliers = inliers.size();</span><br><span class="line">				bestHomography = homography;</span><br><span class="line">				bestSize = pyramid[i].size();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (VERBOSE) &#123;</span><br><span class="line">				cv::Mat imageMatches;</span><br><span class="line">				cv::drawMatches(target, pyrKeypoints[i],  <span class="comment">// 1st image and its keypoints</span></span><br><span class="line">					image, keypoints,  <span class="comment">// 2nd image and its keypoints</span></span><br><span class="line">					inliers,			<span class="comment">// the matches</span></span><br><span class="line">					imageMatches,		<span class="comment">// the image produced</span></span><br><span class="line">					cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>),  <span class="comment">// color of the lines</span></span><br><span class="line">					cv::Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>),  <span class="comment">// color of the keypoints</span></span><br><span class="line">					<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;(),</span><br><span class="line">					<span class="number">2</span>);</span><br><span class="line">				cv::imshow(<span class="string">"Target matches"</span>, imageMatches);</span><br><span class="line">				cv::waitKey();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3. 用最佳单应矩阵找出角点坐标</span></span><br><span class="line">		<span class="keyword">if</span> (maxInliers &gt; <span class="number">8</span>) &#123; <span class="comment">// 估计值有效</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">//最佳尺寸的目标角点</span></span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; corners;</span><br><span class="line">			corners.push_back(cv::Point2f(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">			corners.push_back(cv::Point2f(bestSize.width - <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">			corners.push_back(cv::Point2f(bestSize.width - <span class="number">1</span>, bestSize.height - <span class="number">1</span>));</span><br><span class="line">			corners.push_back(cv::Point2f(<span class="number">0</span>, bestSize.height - <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 重新投影目标角点</span></span><br><span class="line">			cv::perspectiveTransform(corners, detectedCorners, bestHomography);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (VERBOSE)</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Best number of inliers="</span> &lt;&lt; maxInliers &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> bestHomography;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined TMATCHER</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-11-三维重建"><a href="#Chapter-11-三维重建" class="headerlink" title="Chapter_11  :   三维重建"></a>Chapter_11  :   三维重建</h3><blockquote>
<p>1.相机标定<br>2.相机姿态还原<br>3.用标定相机实现三维重建<br>4.计算立体图像的深度</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;iomanip&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;vector&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/core.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/imgproc.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/highgui.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/features2d.hpp&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/viz.hpp&gt;</span></span><br><span class="line"><span class="comment">//#include &lt;opencv2/calib3d.hpp&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//#include "CameraCalibrator.h"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int main()</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	////1.相机标定</span></span><br><span class="line"><span class="comment">//	//cv::Mat image;</span></span><br><span class="line"><span class="comment">//	//std::vector&lt;std::string&gt; filelist;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// generate list of chessboard image filename</span></span><br><span class="line"><span class="comment">//	//// named chessboard01 to chessboard27 in chessboard sub-dir</span></span><br><span class="line"><span class="comment">//	//for (int i = 1; i &lt;= 27; i++) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	std::stringstream str;</span></span><br><span class="line"><span class="comment">//	//	str &lt;&lt; "images/chessboards/chessboard" &lt;&lt; std::setw(2) &lt;&lt; std::setfill('0') &lt;&lt; i &lt;&lt; ".jpg";</span></span><br><span class="line"><span class="comment">//	//	std::cout &lt;&lt; str.str() &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	filelist.push_back(str.str());</span></span><br><span class="line"><span class="comment">//	//	image = cv::imread(str.str(), 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//	// cv::imshow("Board Image",image);	</span></span><br><span class="line"><span class="comment">//	//	// cv::waitKey(100);</span></span><br><span class="line"><span class="comment">//	//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Create calibrator object</span></span><br><span class="line"><span class="comment">//	//CameraCalibrator cameraCalibrator;</span></span><br><span class="line"><span class="comment">//	//// add the corners from the chessboard</span></span><br><span class="line"><span class="comment">//	//cv::Size boardSize(7, 5);</span></span><br><span class="line"><span class="comment">//	//cameraCalibrator.addChessboardPoints(</span></span><br><span class="line"><span class="comment">//	//	filelist,	// filenames of chessboard image</span></span><br><span class="line"><span class="comment">//	//	boardSize, "Detected points");	// size of chessboard</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//									// calibrate the camera</span></span><br><span class="line"><span class="comment">//	//cameraCalibrator.setCalibrationFlag(true, true);</span></span><br><span class="line"><span class="comment">//	//cameraCalibrator.calibrate(image.size());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Exampple of Image Undistortion</span></span><br><span class="line"><span class="comment">//	//image = cv::imread(filelist[14], 0);</span></span><br><span class="line"><span class="comment">//	//cv::Size newSize(static_cast&lt;int&gt;(image.cols*1.5), static_cast&lt;int&gt;(image.rows*1.5));</span></span><br><span class="line"><span class="comment">//	//cv::Mat uImage = cameraCalibrator.remap(image, newSize);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// display camera matrix</span></span><br><span class="line"><span class="comment">//	//cv::Mat cameraMatrix = cameraCalibrator.getCameraMatrix();</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; " Camera intrinsic: " &lt;&lt; cameraMatrix.rows &lt;&lt; "x" &lt;&lt; cameraMatrix.cols &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 0) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 1) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 2) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 0) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 1) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 2) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	//std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 0) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 1) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 2) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Original Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Original Image", image);</span></span><br><span class="line"><span class="comment">//	//cv::namedWindow("Undistorted Image");</span></span><br><span class="line"><span class="comment">//	//cv::imshow("Undistorted Image", uImage);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//// Store everything in a xml file</span></span><br><span class="line"><span class="comment">//	//cv::FileStorage fs("calib.xml", cv::FileStorage::WRITE);</span></span><br><span class="line"><span class="comment">//	//fs &lt;&lt; "Intrinsic" &lt;&lt; cameraMatrix;</span></span><br><span class="line"><span class="comment">//	//fs &lt;&lt; "Distortion" &lt;&lt; cameraCalibrator.getDistCoeffs();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Read the camera calibration parameters</span></span><br><span class="line"><span class="comment">//	cv::Mat cameraMatrix;</span></span><br><span class="line"><span class="comment">//	cv::Mat cameraDistCoeffs;</span></span><br><span class="line"><span class="comment">//	cv::FileStorage fs("calib.xml", cv::FileStorage::READ);</span></span><br><span class="line"><span class="comment">//	fs["Intrinsic"] &gt;&gt; cameraMatrix;</span></span><br><span class="line"><span class="comment">//	fs["Distortion"] &gt;&gt; cameraDistCoeffs;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; " Camera intrinsic: " &lt;&lt; cameraMatrix.rows &lt;&lt; "x" &lt;&lt; cameraMatrix.cols &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 0) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 1) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 2) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 0) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 1) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 2) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 0) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 1) &lt;&lt; " " &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 2) &lt;&lt; std::endl &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	cv::Matx33d cMatrix(cameraMatrix);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Input image points</span></span><br><span class="line"><span class="comment">//	std::vector&lt;cv::Point2f&gt; imagePoints;</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(136, 113));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(379, 114));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(379, 150));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(138, 135));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(143, 146));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(381, 166));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(345, 194));</span></span><br><span class="line"><span class="comment">//	imagePoints.push_back(cv::Point2f(103, 161));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Input object points</span></span><br><span class="line"><span class="comment">//	std::vector&lt;cv::Point3f&gt; objectPoints;</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(0, 45, 0));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(242.5, 45, 0));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(242.5, 21, 0));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(0, 21, 0));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(0, 9, -9));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(242.5, 9, -9));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(242.5, 9, 44.5));</span></span><br><span class="line"><span class="comment">//	objectPoints.push_back(cv::Point3f(0, 9, 44.5));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Read image</span></span><br><span class="line"><span class="comment">//	cv::Mat image = cv::imread("./images/bench2.jpg");</span></span><br><span class="line"><span class="comment">//	// Draw image points</span></span><br><span class="line"><span class="comment">//	for (int i = 0; i &lt; 8; i++) &#123;</span></span><br><span class="line"><span class="comment">//		cv::circle(image, imagePoints[i], 3, cv::Scalar(0, 0, 0), 2);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	cv::imshow("An image of a bench", image);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Create a viz window</span></span><br><span class="line"><span class="comment">//	cv::viz::Viz3d visualizer("Viz window");</span></span><br><span class="line"><span class="comment">//	visualizer.setBackgroundColor(cv::viz::Color::white());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	/// Construct the scene</span></span><br><span class="line"><span class="comment">//	// Create a virtual camera</span></span><br><span class="line"><span class="comment">//	cv::viz::WCameraPosition cam(cMatrix,  // matrix of intrinsics</span></span><br><span class="line"><span class="comment">//		image,    // image displayed on the plane</span></span><br><span class="line"><span class="comment">//		30.0,     // scale factor</span></span><br><span class="line"><span class="comment">//		cv::viz::Color::black());</span></span><br><span class="line"><span class="comment">//	// Create a virtual bench from cuboids</span></span><br><span class="line"><span class="comment">//	cv::viz::WCube plane1(cv::Point3f(0.0, 45.0, 0.0),</span></span><br><span class="line"><span class="comment">//		cv::Point3f(242.5, 21.0, -9.0),</span></span><br><span class="line"><span class="comment">//		true,  // show wire frame </span></span><br><span class="line"><span class="comment">//		cv::viz::Color::blue());</span></span><br><span class="line"><span class="comment">//	plane1.setRenderingProperty(cv::viz::LINE_WIDTH, 4.0);</span></span><br><span class="line"><span class="comment">//	cv::viz::WCube plane2(cv::Point3f(0.0, 9.0, -9.0),</span></span><br><span class="line"><span class="comment">//		cv::Point3f(242.5, 0.0, 44.5),</span></span><br><span class="line"><span class="comment">//		true,  // show wire frame </span></span><br><span class="line"><span class="comment">//		cv::viz::Color::blue());</span></span><br><span class="line"><span class="comment">//	plane2.setRenderingProperty(cv::viz::LINE_WIDTH, 4.0);</span></span><br><span class="line"><span class="comment">//	// Add the virtual objects to the environment</span></span><br><span class="line"><span class="comment">//	visualizer.showWidget("top", plane1);</span></span><br><span class="line"><span class="comment">//	visualizer.showWidget("bottom", plane2);</span></span><br><span class="line"><span class="comment">//	visualizer.showWidget("Camera", cam);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Get the camera pose from 3D/2D points</span></span><br><span class="line"><span class="comment">//	cv::Mat rvec, tvec;</span></span><br><span class="line"><span class="comment">//	cv::solvePnP(objectPoints, imagePoints,      // corresponding 3D/2D pts </span></span><br><span class="line"><span class="comment">//		cameraMatrix, cameraDistCoeffs, // calibration </span></span><br><span class="line"><span class="comment">//		rvec, tvec);                    // output pose</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; " rvec: " &lt;&lt; rvec.rows &lt;&lt; "x" &lt;&lt; rvec.cols &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//	std::cout &lt;&lt; " tvec: " &lt;&lt; tvec.rows &lt;&lt; "x" &lt;&lt; tvec.cols &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	cv::Mat rotation;</span></span><br><span class="line"><span class="comment">//	// convert vector-3 rotation</span></span><br><span class="line"><span class="comment">//	// to a 3x3 rotation matrix</span></span><br><span class="line"><span class="comment">//	cv::Rodrigues(rvec, rotation);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// Move the bench	</span></span><br><span class="line"><span class="comment">//	cv::Affine3d pose(rotation, tvec);</span></span><br><span class="line"><span class="comment">//	visualizer.setWidgetPose("top", pose);</span></span><br><span class="line"><span class="comment">//	visualizer.setWidgetPose("bottom", pose);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	// visualization loop</span></span><br><span class="line"><span class="comment">//	while (cv::waitKey(100) == -1 &amp;&amp; !visualizer.wasStopped())</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		visualizer.spinOnce(1,     // pause 1ms </span></span><br><span class="line"><span class="comment">//			true); // redraw</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	waitKey(0);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined CAMERACALIBRATOR_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CAMERACALIBRATOR_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CameraCalibrator</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//输入点：</span></span><br><span class="line">	<span class="comment">//世界坐标系中的点</span></span><br><span class="line">	<span class="comment">//（每个正方形为一个单位）</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point3f&gt; &gt; objectPoints;</span><br><span class="line">	<span class="comment">//点在图像中的位置（以像素为单位）</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point2f&gt; &gt; imagePoints;</span><br><span class="line">	<span class="comment">//输出矩阵</span></span><br><span class="line">	Mat cameraMatrix;</span><br><span class="line">	Mat distCoeffs;</span><br><span class="line">	<span class="comment">//指定标定方式的标志</span></span><br><span class="line">	<span class="keyword">int</span> flag;</span><br><span class="line">	<span class="comment">//用于图像不失真</span></span><br><span class="line">	Mat map1, map2;</span><br><span class="line">	<span class="keyword">bool</span> mustInitUndistort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	CameraCalibrator() : flag(<span class="number">0</span>), mustInitUndistort(<span class="literal">true</span>)&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//打开棋盘图像，提取角点</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">addChessboardPoints</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; &amp;filelist, Size &amp;boardSize, <span class="built_in">string</span> windowName = <span class="string">""</span>)</span></span>;</span><br><span class="line">	<span class="comment">// Add scene points and corresponding image points</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addPoints</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt;&amp; imageCorners, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point3f&gt;&amp; objectCorners)</span></span>;</span><br><span class="line">	<span class="comment">//标定相机</span></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">calibrate</span><span class="params">(<span class="keyword">const</span> Size imageSize)</span></span>;</span><br><span class="line">	<span class="comment">// Set the calibration flag</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setCalibrationFlag</span><span class="params">(<span class="keyword">bool</span> radial8CoeffEnabled = <span class="literal">false</span>, <span class="keyword">bool</span> tangentialParamEnabled = <span class="literal">false</span>)</span></span>;</span><br><span class="line">	<span class="comment">//去除图像中的畸变（标定后）</span></span><br><span class="line">	<span class="function">Mat <span class="title">remap</span><span class="params">(<span class="keyword">const</span> Mat &amp;image, Size &amp;outputSize = Size(<span class="number">-1</span>, <span class="number">-1</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Getters</span></span><br><span class="line">	cv::<span class="function">Mat <span class="title">getCameraMatrix</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> cameraMatrix; &#125;</span><br><span class="line">	cv::<span class="function">Mat <span class="title">getDistCoeffs</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> distCoeffs; &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined CAMERACALIBRATOR_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CameraCalibrator.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打开棋盘图像，提取角点</span></span><br><span class="line"><span class="keyword">int</span> CameraCalibrator::addChessboardPoints(</span><br><span class="line">	<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; &amp;filelist,   <span class="comment">//文件名列表</span></span><br><span class="line">	Size &amp;boardSize,                  <span class="comment">//标定面板的大小</span></span><br><span class="line">	<span class="built_in">string</span> windowName                 <span class="comment">//展示窗口的名字</span></span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//棋盘上的角点</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; imageCorners;</span><br><span class="line">	<span class="built_in">vector</span>&lt;Point3f&gt; objectCorners;</span><br><span class="line">	<span class="comment">//场景中的三维点</span></span><br><span class="line">	<span class="comment">//在棋盘坐标系中， 初始化棋盘中的角点</span></span><br><span class="line">	<span class="comment">//角点的三维坐标（X, Y，Z）= （i，j，0）</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; boardSize.height; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; boardSize.width; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			objectCorners.push_back(Point3f(i, j, <span class="number">0.0f</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//图像上的二维点</span></span><br><span class="line">	Mat image;  <span class="comment">//用于存储棋盘图像</span></span><br><span class="line">	<span class="keyword">int</span> successes = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//处理所有视角</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; filelist.size(); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//打开图像</span></span><br><span class="line">		image = imread(filelist[i], <span class="number">0</span>);</span><br><span class="line">		<span class="comment">//取得棋盘中的角点</span></span><br><span class="line">		<span class="keyword">bool</span> found = findChessboardCorners(image,       <span class="comment">//包含棋盘图案的图像</span></span><br><span class="line">			                               boardSize,   <span class="comment">//图案的大小</span></span><br><span class="line">			                               imageCorners <span class="comment">//检测到角点的列表</span></span><br><span class="line">		                                   );</span><br><span class="line">		<span class="comment">//取得角点上的亚像素级精度</span></span><br><span class="line">		<span class="keyword">if</span> (found)</span><br><span class="line">		&#123;</span><br><span class="line">			cornerSubPix(image, imageCorners,</span><br><span class="line">				Size(<span class="number">5</span>, <span class="number">5</span>),</span><br><span class="line">				Size(<span class="number">-1</span>, <span class="number">-1</span>),</span><br><span class="line">				TermCriteria(TermCriteria::MAX_ITER + TermCriteria::EPS,</span><br><span class="line">					<span class="number">30</span>,   <span class="comment">//最大迭代次数</span></span><br><span class="line">					<span class="number">0.1</span>));<span class="comment">//最小精度</span></span><br><span class="line">			<span class="comment">//如果棋盘是完好的，就把它加入结果</span></span><br><span class="line">			<span class="keyword">if</span> (imageCorners.size() == boardSize.area())</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//加入从同一个视角得到的图像和场景点</span></span><br><span class="line">				addPoints(imageCorners, objectCorners);</span><br><span class="line">				successes++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (windowName.length() &gt; <span class="number">0</span> &amp;&amp; imageCorners.size() == boardSize.area())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//画角点</span></span><br><span class="line">			drawChessboardCorners(image, boardSize, imageCorners, found);</span><br><span class="line">			imshow(windowName, image);</span><br><span class="line">			waitKey(<span class="number">100</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> successes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Add scene points and corresponding image points</span></span><br><span class="line"><span class="keyword">void</span> CameraCalibrator::addPoints(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt;&amp; imageCorners, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point3f&gt;&amp; objectCorners) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2D image points from one view</span></span><br><span class="line">	imagePoints.push_back(imageCorners);</span><br><span class="line">	<span class="comment">// corresponding 3D scene points</span></span><br><span class="line">	objectPoints.push_back(objectCorners);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标定相机</span></span><br><span class="line"><span class="comment">// 返回重投影误差</span></span><br><span class="line"><span class="keyword">double</span> CameraCalibrator::calibrate(<span class="keyword">const</span> cv::Size imageSize)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// undistorter must be reinitialized</span></span><br><span class="line">	mustInitUndistort = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//输出旋转量和平移量</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Mat&gt; rvecs, tvecs;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开始标定</span></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">		calibrateCamera(objectPoints, <span class="comment">// 三维点</span></span><br><span class="line">			imagePoints,  <span class="comment">// 图像点</span></span><br><span class="line">			imageSize,    <span class="comment">// 图像尺寸</span></span><br><span class="line">			cameraMatrix, <span class="comment">// 输出相机矩阵</span></span><br><span class="line">			distCoeffs,   <span class="comment">// 输出畸变矩阵</span></span><br><span class="line">			rvecs, tvecs, <span class="comment">// Rs, Ts </span></span><br><span class="line">			flag);        <span class="comment">// 设置选项,CV_CALIB_USE_INTRINSIC_GUESS);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除图像中的畸变(标定后)</span></span><br><span class="line">cv::Mat CameraCalibrator::remap(<span class="keyword">const</span> cv::Mat &amp;image, cv::Size &amp;outputSize) &#123;</span><br><span class="line"></span><br><span class="line">	cv::Mat undistorted;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (outputSize.height == <span class="number">-1</span>)</span><br><span class="line">		outputSize = image.size();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (mustInitUndistort) &#123; <span class="comment">// 每个标定过程调用一次</span></span><br><span class="line"></span><br><span class="line">		cv::initUndistortRectifyMap(</span><br><span class="line">			cameraMatrix,  <span class="comment">// 计算得到的相机矩阵</span></span><br><span class="line">			distCoeffs,    <span class="comment">// 计算得到的畸变矩阵</span></span><br><span class="line">			cv::Mat(),     <span class="comment">// 可选矫正项 (无) </span></span><br><span class="line">			cv::Mat(),     <span class="comment">// 生成无畸变的相机矩阵</span></span><br><span class="line">			outputSize,    <span class="comment">// 无畸变图像的尺寸</span></span><br><span class="line">			CV_32FC1,      <span class="comment">// 输出图片的类型</span></span><br><span class="line">			map1, map2);   <span class="comment">// x 和 y 映射功能</span></span><br><span class="line"></span><br><span class="line">		mustInitUndistort = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 映射功能</span></span><br><span class="line">	cv::remap(image, undistorted, map1, map2,</span><br><span class="line">		cv::INTER_LINEAR); <span class="comment">// 插值类型</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> undistorted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Set the calibration options</span></span><br><span class="line"><span class="comment">// 8radialCoeffEnabled should be true if 8 radial coefficients are required (5 is default)</span></span><br><span class="line"><span class="comment">// tangentialParamEnabled should be true if tangeantial distortion is present</span></span><br><span class="line"><span class="keyword">void</span> CameraCalibrator::setCalibrationFlag(<span class="keyword">bool</span> radial8CoeffEnabled, <span class="keyword">bool</span> tangentialParamEnabled) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the flag used in cv::calibrateCamera()</span></span><br><span class="line">	flag = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (!tangentialParamEnabled) flag += CV_CALIB_ZERO_TANGENT_DIST;</span><br><span class="line">	<span class="keyword">if</span> (radial8CoeffEnabled) flag += CV_CALIB_RATIONAL_MODEL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-12-处理视频序列"><a href="#Chapter-12-处理视频序列" class="headerlink" title="Chapter_12 : 处理视频序列"></a>Chapter_12 : 处理视频序列</h3><blockquote>
<p>1.读取视频处理<br>2.处理视频帧<br>3.提取视频中的眼前物体</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/bgsegm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VideoProcessor.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"BGFGSegmentor.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; img, cv::Mat&amp; out)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	img.copyTo(out);</span><br><span class="line">	cv::circle(out, cv::Point(<span class="number">100</span>, <span class="number">100</span>), <span class="number">5</span>, cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">canny</span><span class="params">(cv::Mat&amp; img, cv::Mat&amp; out)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 转换为灰度</span></span><br><span class="line">	<span class="keyword">if</span> (img.channels() == <span class="number">3</span>)</span><br><span class="line">		cv::cvtColor(img, out, cv::COLOR_BGR2GRAY);</span><br><span class="line">	<span class="comment">// 计算Canny边缘</span></span><br><span class="line">	cv::Canny(out, out, <span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">	<span class="comment">// 反转图像</span></span><br><span class="line">	cv::threshold(out, out, <span class="number">128</span>, <span class="number">255</span>, cv::THRESH_BINARY_INV);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">////1.读取视频处理</span></span><br><span class="line"> <span class="comment">//   //打开视频文件</span></span><br><span class="line">	<span class="comment">//VideoCapture capture("./images/bike.avi");</span></span><br><span class="line">	<span class="comment">////检查视频是否打开成功</span></span><br><span class="line">	<span class="comment">//if (!capture.isOpened() )</span></span><br><span class="line">	<span class="comment">//	return 1;</span></span><br><span class="line">	<span class="comment">////取得帧速率</span></span><br><span class="line">	<span class="comment">//double rate = capture.get(CV_CAP_PROP_FPS);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//bool stop(false);</span></span><br><span class="line">	<span class="comment">//Mat frame;  //当前视频帧</span></span><br><span class="line">	<span class="comment">//namedWindow("Extracted Frame");</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////根据帧速率计算帧之间的等待时间， 单位为ms</span></span><br><span class="line">	<span class="comment">//int delay = 1000 / rate;</span></span><br><span class="line">	<span class="comment">////循环遍历视频中的全部帧</span></span><br><span class="line">	<span class="comment">//while (!stop)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	//读取下一帧（如果有）</span></span><br><span class="line">	<span class="comment">//	if (!capture.read(frame) )</span></span><br><span class="line">	<span class="comment">//		break;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	imshow("Extracted Frame", frame);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	//等待一段时间，或者通过按键停止</span></span><br><span class="line">	<span class="comment">//	if (waitKey(delay) &gt;= 0)</span></span><br><span class="line">	<span class="comment">//		stop = true;</span></span><br><span class="line">	<span class="comment">//	</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////关闭视频文件</span></span><br><span class="line">	<span class="comment">////不是必须的，因为类的析构函数会调用</span></span><br><span class="line">	<span class="comment">//capture.release();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////2.处理视频帧</span></span><br><span class="line">	<span class="comment">////打开视频文件</span></span><br><span class="line">	<span class="comment">//VideoCapture capture("./images/bike.avi");</span></span><br><span class="line">	<span class="comment">////检查视频是否打开</span></span><br><span class="line">	<span class="comment">//if (!capture.isOpened())</span></span><br><span class="line">	<span class="comment">//	return 1;</span></span><br><span class="line">	<span class="comment">////获取帧速率</span></span><br><span class="line">	<span class="comment">//double rate = capture.get(CV_CAP_PROP_FPS);</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "Frame rate: " &lt;&lt; rate &lt;&lt; "fps" &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//double stop(false);</span></span><br><span class="line">	<span class="comment">//Mat frame;</span></span><br><span class="line">	<span class="comment">////根据帧速率计算镇之间的等待时间，单位为ms</span></span><br><span class="line">	<span class="comment">//int delay = 1000 / rate;</span></span><br><span class="line">	<span class="comment">//long long i = 0;</span></span><br><span class="line">	<span class="comment">//string b = "bike";</span></span><br><span class="line">	<span class="comment">//string ext = ".bmp";</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////循环遍历视频中的全部帧</span></span><br><span class="line">	<span class="comment">//while (!stop)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	//读取下一帧（如果有）</span></span><br><span class="line">	<span class="comment">//	if (!capture.read(frame))</span></span><br><span class="line">	<span class="comment">//		break;</span></span><br><span class="line">	<span class="comment">//	imshow("Extracted Frame", frame);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	string name(b);</span></span><br><span class="line">	<span class="comment">//	ostringstream ss;</span></span><br><span class="line">	<span class="comment">//	ss &lt;&lt; setfill('0') &lt;&lt; setw(3) &lt;&lt; i;</span></span><br><span class="line">	<span class="comment">//	name += ss.str();</span></span><br><span class="line">	<span class="comment">//	i++;</span></span><br><span class="line">	<span class="comment">//	name += ext;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; name &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	Mat test;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	//等待一段时间， 或者通过按键停止</span></span><br><span class="line">	<span class="comment">//	if (waitKey(delay) &gt;= 0)</span></span><br><span class="line">	<span class="comment">//		stop = true;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//capture.release();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//waitKey();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////现在创建一个自定义类VideoProcessor完整的封装了视频处理任务</span></span><br><span class="line">	<span class="comment">//VideoProcessor processor;</span></span><br><span class="line">	<span class="comment">////打开视频文件</span></span><br><span class="line">	<span class="comment">//processor.setInput("./images/bike.avi");</span></span><br><span class="line">	<span class="comment">////声明显示视频的窗口</span></span><br><span class="line">	<span class="comment">//processor.displayInput("Input Video");</span></span><br><span class="line">	<span class="comment">//processor.displayOutput("Output Video");</span></span><br><span class="line">	<span class="comment">////用原始帧速率播放视频</span></span><br><span class="line">	<span class="comment">//processor.setDelay(1000. / processor.getFrameRate());</span></span><br><span class="line">	<span class="comment">////设置处理帧的回调函数</span></span><br><span class="line">	<span class="comment">//processor.setFrameProcessor(canny);</span></span><br><span class="line">	<span class="comment">////输出视频</span></span><br><span class="line">	<span class="comment">//processor.setOutput("./images/bikeCanny.avi", -1, 15);</span></span><br><span class="line">	<span class="comment">////在当前帧停止处理</span></span><br><span class="line">	<span class="comment">//processor.stopAtFrameNo(51);</span></span><br><span class="line">	<span class="comment">////开始处理</span></span><br><span class="line">	<span class="comment">//processor.run();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//waitKey();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.提取视频中的眼前物体</span></span><br><span class="line">	<span class="comment">// 打开视频</span></span><br><span class="line">	cv::<span class="function">VideoCapture <span class="title">capture</span><span class="params">(<span class="string">"./images/bike.avi"</span>)</span></span>;</span><br><span class="line">	<span class="comment">// 检查是否打开成功</span></span><br><span class="line">	<span class="keyword">if</span> (!capture.isOpened())</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当前视频帧</span></span><br><span class="line">	cv::Mat frame;</span><br><span class="line">	<span class="comment">// 前景的二值图像</span></span><br><span class="line">	cv::Mat foreground;</span><br><span class="line">	<span class="comment">// 背景图</span></span><br><span class="line">	cv::Mat background;</span><br><span class="line"></span><br><span class="line">	cv::namedWindow(<span class="string">"Extracted Foreground"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 混合高斯模型类的对象，全部采用默认参数</span></span><br><span class="line">	cv::Ptr&lt;cv::BackgroundSubtractor&gt; ptrMOG = cv::bgsegm::createBackgroundSubtractorMOG();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">stop</span><span class="params">(<span class="literal">false</span>)</span></span>;</span><br><span class="line">	<span class="comment">// 遍历视频中的所有帧</span></span><br><span class="line">	<span class="keyword">while</span> (!stop)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取下一帧（如果有）</span></span><br><span class="line">		<span class="keyword">if</span> (!capture.read(frame))</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 更新背景并返回前景</span></span><br><span class="line">		ptrMOG-&gt;apply(frame, foreground, <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 改进图像效果</span></span><br><span class="line">		cv::threshold(foreground, foreground, <span class="number">128</span>, <span class="number">255</span>, cv::THRESH_BINARY_INV);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 显示前景</span></span><br><span class="line">		cv::imshow(<span class="string">"Extracted Foreground"</span>, foreground);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 产生延时或者按键结束</span></span><br><span class="line">		<span class="keyword">if</span> (cv::waitKey(<span class="number">10</span>) &gt;= <span class="number">0</span>)</span><br><span class="line">			stop = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	cv::waitKey();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Create video procesor instance</span></span><br><span class="line">	<span class="comment">//VideoProcessor processor;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Create background/foreground segmentor </span></span><br><span class="line">	<span class="comment">//BGFGSegmentor segmentor;</span></span><br><span class="line">	<span class="comment">//segmentor.setThreshold(25);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Open video file</span></span><br><span class="line">	<span class="comment">//processor.setInput("./images/bike.avi");</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// set frame processor</span></span><br><span class="line">	<span class="comment">//processor.setFrameProcessor(&amp;segmentor);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Declare a window to display the video</span></span><br><span class="line">	<span class="comment">//processor.displayOutput("Extracted Foreground");</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Play the video at the original frame rate</span></span><br><span class="line">	<span class="comment">//processor.setDelay(1000. / processor.getFrameRate());</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Start the process</span></span><br><span class="line">	<span class="comment">//processor.run();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::waitKey();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined VPROCESSOR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VPROCESSOR</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧处理的接口</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrameProcessor</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//处理方法</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Mat &amp;input, Mat &amp;output)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VideoProcessor</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//Opencv视频捕获对象</span></span><br><span class="line">	VideoCapture capture;</span><br><span class="line">	<span class="comment">//处理每一帧时都会调用的回调函数</span></span><br><span class="line">	<span class="keyword">void</span>(*process) (Mat&amp;, Mat&amp;);</span><br><span class="line">	FrameProcessor *frameProcessor;</span><br><span class="line">	<span class="comment">//布尔型变量，表示该回调函数是否会被调用</span></span><br><span class="line">	<span class="keyword">bool</span> callIt;</span><br><span class="line">	<span class="comment">//输入窗口的显示名称</span></span><br><span class="line">	<span class="built_in">string</span> windowNameInput;</span><br><span class="line">	<span class="comment">//输出窗口的显示名称</span></span><br><span class="line">	<span class="built_in">string</span> windowNameOutput;</span><br><span class="line">	<span class="comment">//帧之间的延时</span></span><br><span class="line">	<span class="keyword">int</span> delay;</span><br><span class="line">	<span class="comment">//已经处理的帧数</span></span><br><span class="line">	<span class="keyword">long</span> fnumber;</span><br><span class="line">	<span class="comment">//达到这个帧数时结束</span></span><br><span class="line">	<span class="keyword">long</span> frameToStop;</span><br><span class="line">	<span class="comment">//结束处理</span></span><br><span class="line">	<span class="keyword">bool</span> stop;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用作输入图像的图像文件名向量</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; images;</span><br><span class="line">	<span class="comment">//图像容器的迭代器</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;::const_iterator itImg;</span><br><span class="line">	<span class="comment">//Opencv写视频对象</span></span><br><span class="line">	VideoWriter writer;</span><br><span class="line">	<span class="comment">//输出文件</span></span><br><span class="line">	<span class="built_in">string</span> outputFile;</span><br><span class="line">	<span class="comment">//输出图像的当前序号</span></span><br><span class="line">	<span class="keyword">int</span> currentIndex;</span><br><span class="line">	<span class="comment">//输出图像文件名中数字的位数</span></span><br><span class="line">	<span class="keyword">int</span> digits;</span><br><span class="line">	<span class="comment">//输出图像的扩展名</span></span><br><span class="line">	<span class="built_in">string</span> extension;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//取得下一帧</span></span><br><span class="line">	<span class="comment">//可以是视频文件、摄像机、图像向量</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">readNextFrame</span><span class="params">(Mat &amp;frame)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (images.size()== <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> capture.read(frame);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (itImg != images.end() )</span><br><span class="line">			&#123;</span><br><span class="line">				frame = imread(*itImg);</span><br><span class="line">				itImg++;</span><br><span class="line">				<span class="keyword">return</span> frame.data != <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">		<span class="comment">//写输出的帧</span></span><br><span class="line">		<span class="comment">//可以是视频文件或者图像组</span></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">writeNextFrame</span><span class="params">(Mat &amp;frame)</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (extension.length())  <span class="comment">//写入到图像组</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">stringstream</span> ss;</span><br><span class="line">				ss &lt;&lt; outputFile &lt;&lt; setfill(<span class="string">'0'</span>) &lt;&lt; setw(digits) &lt;&lt; currentIndex++ &lt;&lt; extension;</span><br><span class="line">				imwrite(ss.str(), frame);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>   <span class="comment">//写入到视频文件</span></span><br><span class="line">			&#123;</span><br><span class="line">				writer.write(frame);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构造函数设置默认的值</span></span><br><span class="line">	VideoProcessor() : callIt(<span class="literal">false</span>), delay(<span class="number">-1</span>),fnumber(<span class="number">0</span>), stop(<span class="literal">false</span>), digits(<span class="number">0</span>), frameToStop(<span class="number">-1</span>),process(<span class="number">0</span>), frameProcessor(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置视频文件的名称</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setInput</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> filename)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		fnumber = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 防止已经有资源和VideoCapture实例关联</span></span><br><span class="line">		capture.release();</span><br><span class="line">		images.clear();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//打开视频文件</span></span><br><span class="line">		<span class="keyword">return</span> capture.open(filename);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置相机id</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setInput</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		fnumber = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 防止已经有资源和VideoCapture实例关联</span></span><br><span class="line">		capture.release();</span><br><span class="line">		images.clear();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 打开视频文件</span></span><br><span class="line">		<span class="keyword">return</span> capture.open(id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置输入图像的向量</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setInput</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&amp; imgs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		fnumber = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 防止已经有资源和VideoCapture实例关联</span></span><br><span class="line">		capture.release();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将这个图像向量作为输入对象</span></span><br><span class="line">		images = imgs;</span><br><span class="line">		itImg = images.begin();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置输出视频文件</span></span><br><span class="line">	<span class="comment">// 默认情况下会使用与输入视频相同的参数</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setOutput</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;filename, <span class="keyword">int</span> codec = <span class="number">0</span>, <span class="keyword">double</span> framerate = <span class="number">0.0</span>, <span class="keyword">bool</span> isColor = <span class="literal">true</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		outputFile = filename;</span><br><span class="line">		extension.clear();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (framerate == <span class="number">0.0</span>)</span><br><span class="line">			framerate = getFrameRate(); <span class="comment">// 与输入相同</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">char</span> c[<span class="number">4</span>];</span><br><span class="line">		<span class="comment">//使用与输入相同的编解码器</span></span><br><span class="line">		<span class="keyword">if</span> (codec == <span class="number">0</span>) &#123;</span><br><span class="line">			codec = getCodec(c);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//打开输出视频</span></span><br><span class="line">		<span class="keyword">return</span> writer.open(outputFile, <span class="comment">//文件名</span></span><br><span class="line">			codec, <span class="comment">// 所用的编解码器</span></span><br><span class="line">			framerate,      <span class="comment">// 视频的帧速率</span></span><br><span class="line">			getFrameSize(), <span class="comment">// 帧的尺寸</span></span><br><span class="line">			isColor);       <span class="comment">// 彩色视频？</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置输出一系列图像文件</span></span><br><span class="line">	<span class="comment">// 扩展名是 ".jpg",或者".bmp" ...</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setOutput</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;filename, <span class="comment">// 前缀</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;ext, <span class="comment">// 图像文件的扩展名</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">int</span> numberOfDigits = <span class="number">3</span>,   <span class="comment">//数字的位数</span></span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">int</span> startIndex = <span class="number">0</span>)</span> </span>&#123;     <span class="comment">// 开始序号</span></span><br><span class="line"></span><br><span class="line">	    <span class="comment">// 数字的位数必须是正数</span></span><br><span class="line">		<span class="keyword">if</span> (numberOfDigits&lt;<span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 文件名和常用的扩展名</span></span><br><span class="line">		outputFile = filename;</span><br><span class="line">		extension = ext;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 文件编号方案中数字的位数</span></span><br><span class="line">		digits = numberOfDigits;</span><br><span class="line">		<span class="comment">// 从这个序号开始编码</span></span><br><span class="line">		currentIndex = startIndex;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// set the callback function that will be called for each frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFrameProcessor</span><span class="params">(<span class="keyword">void</span>(*frameProcessingCallback)(cv::Mat&amp;, cv::Mat&amp;))</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 使回调函数失效</span></span><br><span class="line">		frameProcessor = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 这个就是即将被调用的帧处理实例</span></span><br><span class="line">		process = frameProcessingCallback;</span><br><span class="line">		callProcess();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置实现 FrameProcessor接口的实例</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFrameProcessor</span><span class="params">(FrameProcessor* frameProcessorPtr)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 使回调函数失效</span></span><br><span class="line">		process = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 这个就是即将被调用的帧处理实例</span></span><br><span class="line">		frameProcessor = frameProcessorPtr;</span><br><span class="line">		callProcess();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// stop streaming at this frame number</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">stopAtFrameNo</span><span class="params">(<span class="keyword">long</span> frame)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		frameToStop = frame;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//需要调用回调函数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">callProcess</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		callIt = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//不需要调用回调函数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dontCallProcess</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		callIt = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用于显示输入的帧</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">displayInput</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> wn)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		windowNameInput = wn;</span><br><span class="line">		cv::namedWindow(windowNameInput);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用于显示处理过的帧</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">displayOutput</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> wn)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		windowNameOutput = wn;</span><br><span class="line">		cv::namedWindow(windowNameOutput);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// do not display the processed frames</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dontDisplay</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		cv::destroyWindow(windowNameInput);</span><br><span class="line">		cv::destroyWindow(windowNameOutput);</span><br><span class="line">		windowNameInput.clear();</span><br><span class="line">		windowNameOutput.clear();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置帧之间的延迟</span></span><br><span class="line">	<span class="comment">// 0 表示每一帧都在等待</span></span><br><span class="line">	<span class="comment">// 负数表示不延时</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setDelay</span><span class="params">(<span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		delay = d;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// a count is kept of the processed frames</span></span><br><span class="line">	<span class="function"><span class="keyword">long</span> <span class="title">getNumberOfProcessedFrames</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> fnumber;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// return the size of the video frame</span></span><br><span class="line">	cv::<span class="function">Size <span class="title">getFrameSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (images.size() == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// get size of from the capture device</span></span><br><span class="line">			<span class="keyword">int</span> w = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(capture.get(cv::CAP_PROP_FRAME_WIDTH));</span><br><span class="line">			<span class="keyword">int</span> h = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(capture.get(cv::CAP_PROP_FRAME_HEIGHT));</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> cv::Size(w, h);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123; <span class="comment">// if input is vector of images</span></span><br><span class="line"></span><br><span class="line">			cv::Mat tmp = cv::imread(images[<span class="number">0</span>]);</span><br><span class="line">			<span class="keyword">if</span> (!tmp.data) <span class="keyword">return</span> cv::Size(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">return</span> tmp.size();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 返回下一帧的编号</span></span><br><span class="line">	<span class="function"><span class="keyword">long</span> <span class="title">getFrameNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (images.size() == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//从捕获设备获取信息</span></span><br><span class="line">			<span class="keyword">long</span> f = <span class="keyword">static_cast</span>&lt;<span class="keyword">long</span>&gt;(capture.get(cv::CAP_PROP_POS_FRAMES));</span><br><span class="line">			<span class="keyword">return</span> f;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123; <span class="comment">// if input is vector of images</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">long</span>&gt;(itImg - images.begin());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// return the position in ms</span></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">getPositionMS</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// undefined for vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> t = capture.get(cv::CAP_PROP_POS_MSEC);</span><br><span class="line">		<span class="keyword">return</span> t;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// return the frame rate</span></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">getFrameRate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// undefined for vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> r = capture.get(cv::CAP_PROP_FPS);</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// return the number of frames in video</span></span><br><span class="line">	<span class="function"><span class="keyword">long</span> <span class="title">getTotalFrameCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// for vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>) <span class="keyword">return</span> images.size();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">long</span> t = capture.get(cv::CAP_PROP_FRAME_COUNT);</span><br><span class="line">		<span class="keyword">return</span> t;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// get the codec of input video</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getCodec</span><span class="params">(<span class="keyword">char</span> codec[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// undefined for vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">union</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> value;</span><br><span class="line">			<span class="keyword">char</span> code[<span class="number">4</span>];</span><br><span class="line">		&#125; returned;</span><br><span class="line"></span><br><span class="line">		returned.value = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(capture.get(cv::CAP_PROP_FOURCC));</span><br><span class="line"></span><br><span class="line">		codec[<span class="number">0</span>] = returned.code[<span class="number">0</span>];</span><br><span class="line">		codec[<span class="number">1</span>] = returned.code[<span class="number">1</span>];</span><br><span class="line">		codec[<span class="number">2</span>] = returned.code[<span class="number">2</span>];</span><br><span class="line">		codec[<span class="number">3</span>] = returned.code[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> returned.value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go to this frame number</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setFrameNumber</span><span class="params">(<span class="keyword">long</span> pos)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// for vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// move to position in vector</span></span><br><span class="line">			itImg = images.begin() + pos;</span><br><span class="line">			<span class="comment">// is it a valid position?</span></span><br><span class="line">			<span class="keyword">if</span> (pos &lt; images.size())</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123; <span class="comment">// if input is a capture device</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> capture.<span class="built_in">set</span>(cv::CAP_PROP_POS_FRAMES, pos);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go to this position</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setPositionMS</span><span class="params">(<span class="keyword">double</span> pos)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// not defined in vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> capture.<span class="built_in">set</span>(cv::CAP_PROP_POS_MSEC, pos);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// go to this position expressed in fraction of total film length</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">setRelativePosition</span><span class="params">(<span class="keyword">double</span> pos)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// for vector of images</span></span><br><span class="line">		<span class="keyword">if</span> (images.size() != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// move to position in vector</span></span><br><span class="line">			<span class="keyword">long</span> posI = <span class="keyword">static_cast</span>&lt;<span class="keyword">long</span>&gt;(pos*images.size() + <span class="number">0.5</span>);</span><br><span class="line">			itImg = images.begin() + posI;</span><br><span class="line">			<span class="comment">// is it a valid position?</span></span><br><span class="line">			<span class="keyword">if</span> (posI &lt; images.size())</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123; <span class="comment">// if input is a capture device</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> capture.<span class="built_in">set</span>(cv::CAP_PROP_POS_AVI_RATIO, pos);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//结束处理</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">stopIt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		stop = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 处理过程是否已经停止？</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">isStopped</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> stop;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 捕获设备是否已经打开？</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">isOpened</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> capture.isOpened() || !images.empty();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 抓取并处理序列中的帧</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//当前帧</span></span><br><span class="line">		cv::Mat frame;</span><br><span class="line">		<span class="comment">//输出帧</span></span><br><span class="line">		cv::Mat output;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//如果没有设置捕获设备</span></span><br><span class="line">		<span class="keyword">if</span> (!isOpened())</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		stop = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (!isStopped()) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 读取下一帧（如果有）</span></span><br><span class="line">			<span class="keyword">if</span> (!readNextFrame(frame))</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 显示输入的帧</span></span><br><span class="line">			<span class="keyword">if</span> (windowNameInput.length() != <span class="number">0</span>)</span><br><span class="line">				cv::imshow(windowNameInput, frame);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 调用处理函数</span></span><br><span class="line">			<span class="keyword">if</span> (callIt) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 处理帧</span></span><br><span class="line">				<span class="keyword">if</span> (process)</span><br><span class="line">					process(frame, output);</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (frameProcessor)</span><br><span class="line">					frameProcessor-&gt;process(frame, output);</span><br><span class="line">				<span class="comment">// 递增帧数</span></span><br><span class="line">				fnumber++;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">//没有处理</span></span><br><span class="line">				output = frame;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 写入输出序列</span></span><br><span class="line">			<span class="keyword">if</span> (outputFile.length() != <span class="number">0</span>)</span><br><span class="line">				writeNextFrame(output);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 显示输出的帧</span></span><br><span class="line">			<span class="keyword">if</span> (windowNameOutput.length() != <span class="number">0</span>)</span><br><span class="line">				cv::imshow(windowNameOutput, output);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 产生延迟</span></span><br><span class="line">			<span class="keyword">if</span> (delay &gt;= <span class="number">0</span> &amp;&amp; cv::waitKey(delay) &gt;= <span class="number">0</span>)</span><br><span class="line">				stopIt();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 检查是否需要结束</span></span><br><span class="line">			<span class="keyword">if</span> (frameToStop &gt;= <span class="number">0</span> &amp;&amp; getFrameNumber() == frameToStop)</span><br><span class="line">				stopIt();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined VPROCESSOR</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined BGFGSeg</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BGFGSeg</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"videoprocessor.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BGFGSegmentor</span> :</span> <span class="keyword">public</span> FrameProcessor &#123;</span><br><span class="line"></span><br><span class="line">	cv::Mat gray;			<span class="comment">// 当前灰度图像</span></span><br><span class="line">	cv::Mat background;		<span class="comment">// 累积的背景</span></span><br><span class="line">	cv::Mat backImage;		<span class="comment">// 当前背景图像</span></span><br><span class="line">	cv::Mat foreground;		<span class="comment">// 前景图像</span></span><br><span class="line">	<span class="keyword">double</span> learningRate;    <span class="comment">// 累积背景时使用的学习效率</span></span><br><span class="line">	<span class="keyword">int</span> threshold;			<span class="comment">// 提取前景的阈值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	BGFGSegmentor() : threshold(<span class="number">10</span>), learningRate(<span class="number">0.01</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the threshold used to declare a foreground</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setThreshold</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		threshold = t;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the learning rate</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setLearningRate</span><span class="params">(<span class="keyword">double</span> r)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		learningRate = r;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 处理方法</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(cv::Mat &amp;frame, cv::Mat &amp;output)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 转换为灰度图</span></span><br><span class="line">		cv::cvtColor(frame, gray, cv::COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 采用第一针初始化背景</span></span><br><span class="line">		<span class="keyword">if</span> (background.empty())</span><br><span class="line">			gray.convertTo(background, CV_32F);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将背景转化为 8U类型</span></span><br><span class="line">		background.convertTo(backImage, CV_8U);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 计算图像与背景之间的差异</span></span><br><span class="line">		cv::absdiff(backImage, gray, foreground);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 在前景图像上应用</span></span><br><span class="line">		cv::threshold(foreground, output, threshold, <span class="number">255</span>, cv::THRESH_BINARY_INV);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 积累背景</span></span><br><span class="line">		cv::accumulateWeighted(gray, background,</span><br><span class="line">			<span class="comment">// alpha*gray + (1-alpha)*background</span></span><br><span class="line">			learningRate,  <span class="comment">// 学习速率</span></span><br><span class="line">			output);       <span class="comment">// 掩码</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-13-跟踪运动物体"><a href="#Chapter-13-跟踪运动物体" class="headerlink" title="Chapter_13  :   跟踪运动物体"></a>Chapter_13  :   跟踪运动物体</h3><blockquote>
<p>1.跟踪视频中的特征点<br>2.估算光流<br>3.跟踪视频中的物体</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"FeatureTracker.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VideoProcessor.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VisualTracker.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//绘制光流向量图</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawOpticalFlow</span><span class="params">(<span class="keyword">const</span> Mat&amp; oflow, <span class="comment">//光流</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                 Mat &amp;flowImage,   <span class="comment">//绘制的图像</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                 <span class="keyword">int</span>  stride,      <span class="comment">//显示向量的步长</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                 <span class="keyword">float</span> scale,      <span class="comment">//放大因子</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                 <span class="keyword">const</span> Scalar&amp; color)</span>  <span class="comment">//显示向量的颜色</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//必要时创建图像</span></span><br><span class="line">	<span class="keyword">if</span> (flowImage.size() != oflow.size())</span><br><span class="line">	&#123;</span><br><span class="line">		flowImage.create(oflow.size(), CV_8UC3);</span><br><span class="line">		flowImage = Vec3i(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//对所有向量， 以stride作为步长</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; oflow.rows; y += stride)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; oflow.cols; x += stride) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 获取向量	</span></span><br><span class="line">			Point2f <span class="built_in">vector</span> = oflow.at&lt; Point2f&gt;(y, x);</span><br><span class="line">			<span class="comment">// 画线条</span></span><br><span class="line">			line(flowImage, Point(x, y),</span><br><span class="line">				Point(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(x + scale*<span class="built_in">vector</span>.x + <span class="number">0.5</span>),</span><br><span class="line">					<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(y + scale*<span class="built_in">vector</span>.y + <span class="number">0.5</span>)), color);</span><br><span class="line">			<span class="comment">// 画顶端圆圈	</span></span><br><span class="line">			circle(flowImage, Point(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(x + scale*<span class="built_in">vector</span>.x + <span class="number">0.5</span>),</span><br><span class="line">				<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(y + scale*<span class="built_in">vector</span>.y + <span class="number">0.5</span>)), <span class="number">1</span>, color, <span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">////1.跟踪视频中的特征点</span></span><br><span class="line">	<span class="comment">////创建视频处理类的实例</span></span><br><span class="line">	<span class="comment">//VideoProcessor processor;</span></span><br><span class="line">	<span class="comment">////创建特征跟踪类的实例</span></span><br><span class="line">	<span class="comment">//FeatureTracker tracker;</span></span><br><span class="line">	<span class="comment">////打开视频文件</span></span><br><span class="line">	<span class="comment">//processor.setInput("./images/bike.avi");</span></span><br><span class="line">	<span class="comment">////设置帧处理类</span></span><br><span class="line">	<span class="comment">//processor.setFrameProcessor(&amp;tracker);</span></span><br><span class="line">	<span class="comment">////声明显示视频的窗口</span></span><br><span class="line">	<span class="comment">//processor.displayOutput("Tracked Feature");</span></span><br><span class="line">	<span class="comment">////以原始帧速率播放视频</span></span><br><span class="line">	<span class="comment">//processor.setDelay(1000. / processor.getFrameRate());</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//processor.stopAtFrameNo(90);</span></span><br><span class="line">	<span class="comment">////开始处理</span></span><br><span class="line">	<span class="comment">//processor.run();</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//waitKey();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////2.估算光流</span></span><br><span class="line">	<span class="comment">//Mat frame1 = imread("./images/goose/goose230.bmp", 0);</span></span><br><span class="line">	<span class="comment">//Mat frame2 = imread("./images/goose/goose237.bmp", 0);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("frame1", frame1);</span></span><br><span class="line">	<span class="comment">//imshow("frame2", frame2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Combined display</span></span><br><span class="line">	<span class="comment">//Mat combined(frame1.rows, frame1.cols + frame2.cols, CV_8U);</span></span><br><span class="line">	<span class="comment">//frame1.copyTo(combined.colRange(0, frame1.cols));</span></span><br><span class="line">	<span class="comment">//frame2.copyTo(combined.colRange(frame1.cols, frame1.cols + frame2.cols));</span></span><br><span class="line">	<span class="comment">//imshow("Frames", combined);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// 创建光流算法</span></span><br><span class="line">	<span class="comment">//Ptr&lt;DualTVL1OpticalFlow&gt; tvl1 = createOptFlow_DualTVL1();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "regularization coeeficient: " &lt;&lt; tvl1-&gt;getLambda() &lt;&lt; endl; // the smaller the soomther</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "Number of scales: " &lt;&lt; tvl1-&gt;getScalesNumber() &lt;&lt; endl; // number of scales</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "Scale step: " &lt;&lt; tvl1-&gt;getScaleStep() &lt;&lt; endl; // size between scales</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "Number of warpings: " &lt;&lt; tvl1-&gt;getWarpingsNumber() &lt;&lt; endl; // size between scales</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "Stopping criteria: " &lt;&lt; tvl1-&gt;getEpsilon() &lt;&lt; " and " &lt;&lt; tvl1-&gt;getOuterIterations() &lt;&lt; endl; // size between scales</span></span><br><span class="line">	<span class="comment">//														// compute the optical flow between 2 frames</span></span><br><span class="line">	<span class="comment">//Mat oflow; // 二维光流向量的图像</span></span><br><span class="line">	<span class="comment">//// 计算frame1和frame2之间的光流</span></span><br><span class="line">	<span class="comment">//tvl1-&gt;calc(frame1, frame2, oflow);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// 绘制光流</span></span><br><span class="line">	<span class="comment">//Mat flowImage;</span></span><br><span class="line">	<span class="comment">//drawOpticalFlow(oflow,     // 输入光流向量 </span></span><br><span class="line">	<span class="comment">//	flowImage, // 生成的图像</span></span><br><span class="line">	<span class="comment">//	8,         // 每隔8个像素显示一个向量</span></span><br><span class="line">	<span class="comment">//	2,         // 长度延长2倍</span></span><br><span class="line">	<span class="comment">//	Scalar(0, 0, 0)); // 向量颜色</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Optical Flow", flowImage);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// 计算两个帧之间更加光滑的光流</span></span><br><span class="line">	<span class="comment">//tvl1-&gt;setLambda(0.075);</span></span><br><span class="line">	<span class="comment">//tvl1-&gt;calc(frame1, frame2, oflow);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Draw the optical flow image</span></span><br><span class="line">	<span class="comment">//Mat flowImage2;</span></span><br><span class="line">	<span class="comment">//drawOpticalFlow(oflow,     // input flow vectors </span></span><br><span class="line">	<span class="comment">//	flowImage2, // image to be generated</span></span><br><span class="line">	<span class="comment">//	8,         // display vectors every 8 pixels</span></span><br><span class="line">	<span class="comment">//	2,         // multiply size of vectors by 2</span></span><br><span class="line">	<span class="comment">//	Scalar(0, 0, 0)); // vector color</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Smoother Optical Flow", flowImage2);</span></span><br><span class="line"> <span class="comment">//   waitKey();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">	<span class="comment">//3.跟踪视频中的物体</span></span><br><span class="line">	<span class="comment">// 创建视频处理器实例</span></span><br><span class="line">	VideoProcessor processor;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 生成文件名</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; imgs;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> prefix = <span class="string">"images/goose/goose"</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> ext = <span class="string">".bmp"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加用于跟踪的图像名称</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">130</span>; i &lt; <span class="number">317</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="built_in">string</span> <span class="title">name</span><span class="params">(prefix)</span></span>;</span><br><span class="line">		<span class="built_in">ostringstream</span> ss;</span><br><span class="line">		ss &lt;&lt; setfill(<span class="string">'0'</span>) &lt;&lt; setw(<span class="number">3</span>) &lt;&lt; i;</span><br><span class="line">		name += ss.str();</span><br><span class="line">		name += ext;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		imgs.push_back(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建特征提取器实例</span></span><br><span class="line">	Ptr&lt;TrackerMedianFlow&gt; ptr = TrackerMedianFlow::create();</span><br><span class="line">	<span class="function">VisualTracker <span class="title">tracker</span><span class="params">(ptr)</span></span>;</span><br><span class="line">	<span class="comment">// VisualTracker tracker(TrackerKCF::createTracker());</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开视频文件</span></span><br><span class="line">	processor.setInput(imgs);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置帧处理器</span></span><br><span class="line">	processor.setFrameProcessor(&amp;tracker);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明显示视频的窗口</span></span><br><span class="line">	processor.displayOutput(<span class="string">"Tracked object"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义显示的帧速率</span></span><br><span class="line">	processor.setDelay(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 指定初始目标位置</span></span><br><span class="line">	cv::<span class="function">Rect <span class="title">bb</span><span class="params">(<span class="number">290</span>, <span class="number">100</span>, <span class="number">65</span>, <span class="number">40</span>)</span></span>;</span><br><span class="line">	tracker.setBoundingBox(bb);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开始跟踪</span></span><br><span class="line">	processor.run();</span><br><span class="line"></span><br><span class="line">	cv::waitKey();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 中值流量跟踪算法</span></span><br><span class="line">	Mat image1 = imread(<span class="string">"./images/goose/goose130.bmp"</span>, ImreadModes::IMREAD_GRAYSCALE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义一个10 * 10 的网格</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; grid;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">			<span class="function">Point2f <span class="title">p</span><span class="params">(bb.x + i*bb.width / <span class="number">10.</span>, bb.y + j*bb.height / <span class="number">10</span>)</span></span>;</span><br><span class="line">			grid.push_back(p);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// track in next image</span></span><br><span class="line">	Mat image2 = imread(<span class="string">"./images/goose/goose131.bmp"</span>, ImreadModes::IMREAD_GRAYSCALE);</span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; newPoints;</span><br><span class="line">	<span class="built_in">vector</span>&lt;uchar&gt; status; <span class="comment">// status of tracked features</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; err;    <span class="comment">// error in tracking</span></span><br><span class="line"></span><br><span class="line">							   <span class="comment">// track the points</span></span><br><span class="line">	calcOpticalFlowPyrLK(image1, image2, <span class="comment">// 2 consecutive images</span></span><br><span class="line">		grid,      <span class="comment">// input point position in first image</span></span><br><span class="line">		newPoints, <span class="comment">// output point postion in the second image</span></span><br><span class="line">		status,    <span class="comment">// tracking success</span></span><br><span class="line">		err);      <span class="comment">// tracking error</span></span><br><span class="line"></span><br><span class="line">				   <span class="comment">// Draw the points</span></span><br><span class="line">	<span class="keyword">for</span> (Point2f p : grid)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">	   circle(image1, p, <span class="number">1</span>, Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	imshow(<span class="string">"Initial points"</span>, image1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Point2f p : newPoints) &#123;</span><br><span class="line"></span><br><span class="line">		circle(image2, p, <span class="number">1</span>, Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	imshow(<span class="string">"Tracked points"</span>, image2);</span><br><span class="line"></span><br><span class="line">	waitKey();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined FTRACKER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FTRACKER</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VideoProcessor.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FeatureTracker</span> :</span><span class="keyword">public</span> FrameProcessor</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//当前的灰度图像</span></span><br><span class="line">	Mat gray;</span><br><span class="line">	<span class="comment">//上一个灰度图像</span></span><br><span class="line">	Mat gray_prev;</span><br><span class="line">	<span class="comment">//被跟踪的特征，从0到1</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; points[<span class="number">2</span>];</span><br><span class="line">	<span class="comment">//被跟踪特征点的初始位置</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; initial;</span><br><span class="line">	<span class="comment">//被监测的特征</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;Point2f&gt; features;</span><br><span class="line">	<span class="comment">//检测特征点的最大个数</span></span><br><span class="line">	<span class="keyword">int</span> max_count;</span><br><span class="line">	<span class="comment">//检测特征点的质量等级</span></span><br><span class="line">	<span class="keyword">double</span> qlevel;</span><br><span class="line">	<span class="comment">//两个特征点之间的最小差距</span></span><br><span class="line">	<span class="keyword">double</span> minDist;</span><br><span class="line">	<span class="comment">//被跟踪特征的状态</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;uchar&gt; status;</span><br><span class="line">	<span class="comment">//跟踪中出现的误差</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; err;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">	FeatureTracker():max_count(<span class="number">500</span>), qlevel(<span class="number">0.01</span>), minDist(<span class="number">10.</span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理方法</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(Mat &amp;frame, Mat &amp;output)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//装换成灰度图</span></span><br><span class="line">		cvtColor(frame, gray, CV_BGR2GRAY);</span><br><span class="line">		frame.copyTo(output);</span><br><span class="line">		<span class="comment">//1.如果必须添加新的特征点</span></span><br><span class="line">		<span class="keyword">if</span> (addNewPoints())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//检测特征点</span></span><br><span class="line">			detectFeaturePoints();</span><br><span class="line">			<span class="comment">//在当前跟踪列表中添加检测的特征点</span></span><br><span class="line">			points[<span class="number">0</span>].insert(points[<span class="number">0</span>].end(), features.begin(), features.end());</span><br><span class="line">			initial.insert(initial.end(), features.begin(), features.end());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//对于序列中的第一幅图像</span></span><br><span class="line">		<span class="keyword">if</span> (gray_prev.empty())</span><br><span class="line">			gray.copyTo(gray_prev);</span><br><span class="line">		<span class="comment">//2.跟踪特征</span></span><br><span class="line">		calcOpticalFlowPyrLK(gray_prev, gray, <span class="comment">//两个连续图像</span></span><br><span class="line">			points[<span class="number">0</span>],       <span class="comment">//输入第一幅图像的特征点位置</span></span><br><span class="line">			points[<span class="number">1</span>],       <span class="comment">//输入第二幅图像的特征点位置</span></span><br><span class="line">			status,          <span class="comment">//跟踪成功</span></span><br><span class="line">			err);              <span class="comment">//跟踪误差</span></span><br><span class="line">		<span class="comment">//3.循环检查被跟踪的特征点，剔除部分特征点</span></span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; points[<span class="number">1</span>].size(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//是否保留这个特征点</span></span><br><span class="line">			<span class="keyword">if</span> (acceptTrackedPoint(i))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//在向量中保留这个特征点</span></span><br><span class="line">				initial[k] = initial[i];</span><br><span class="line">				points[<span class="number">1</span>][k++] = points[<span class="number">1</span>][i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//删除跟踪失败的特征点</span></span><br><span class="line">		points[<span class="number">1</span>].resize(k);</span><br><span class="line">		initial.resize(k);</span><br><span class="line">		<span class="comment">//4.处理已经认可的被跟踪特征点</span></span><br><span class="line">		handleTrackedPoints(frame, output);</span><br><span class="line">		<span class="comment">//5.让当前特征点和图像变成前一个</span></span><br><span class="line">		swap(points[<span class="number">1</span>], points[<span class="number">0</span>]);</span><br><span class="line">		swap(gray_prev, gray);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//特征点检测方法</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">detectFeaturePoints</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//检测特征点</span></span><br><span class="line">		goodFeaturesToTrack(gray,  <span class="comment">//图像</span></span><br><span class="line">			features,  <span class="comment">//输出检测到的特征点</span></span><br><span class="line">			max_count, <span class="comment">//特征点的最大数量</span></span><br><span class="line">			qlevel,    <span class="comment">//质量等级</span></span><br><span class="line">			minDist);   <span class="comment">//特征点之间的最小差距</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断是否需要添加新的特征点</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">addNewPoints</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//如果特征点数量太少</span></span><br><span class="line">		<span class="keyword">return</span> points[<span class="number">0</span>].size() &lt;= <span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断需要保留的特征点</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">acceptTrackedPoint</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> status[i] &amp;&amp;</span><br><span class="line">			<span class="comment">//如果特征点已将移动</span></span><br><span class="line">			(<span class="built_in">abs</span>(points[<span class="number">0</span>][i].x - points[<span class="number">1</span>][i].x) +</span><br><span class="line">			(<span class="built_in">abs</span>(points[<span class="number">0</span>][i].y - points[<span class="number">1</span>][i].y)) &gt; <span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理当前跟踪的特征点</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">handleTrackedPoints</span><span class="params">(Mat &amp;frame, Mat &amp;output)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//遍历所有特征点</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; points[<span class="number">1</span>].size(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//画线和圆</span></span><br><span class="line">			line(output, initial[i], points[<span class="number">1</span>][i], Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">			circle(output, points[<span class="number">1</span>][i], <span class="number">3</span>, Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">-1</span>);</span><br><span class="line">		&#125;		</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined FTRACKER</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined VTRACKER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VTRACKER</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/tracking/tracker.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VideoProcessor.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VisualTracker</span> :</span> <span class="keyword">public</span> FrameProcessor</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Ptr&lt;Tracker&gt; tracker;</span><br><span class="line">	Rect2d box;</span><br><span class="line">	<span class="keyword">bool</span> reset;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//构造函数指定选用的跟踪器</span></span><br><span class="line">	VisualTracker(Ptr&lt;Tracker&gt; tracker) :reset(<span class="literal">true</span>), tracker(tracker) &#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//设置矩形，以启动跟踪过程</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setBoundingBox</span><span class="params">(<span class="keyword">const</span> Rect2d&amp; bb)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		box = bb;</span><br><span class="line">		reset = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//回调函数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(Mat &amp;frame, Mat &amp;output)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (reset)</span><br><span class="line">		&#123; </span><br><span class="line">			<span class="comment">// 新跟踪会话</span></span><br><span class="line">			reset = <span class="literal">false</span>;</span><br><span class="line">			tracker-&gt;init(frame, box);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">		&#123; </span><br><span class="line">			<span class="comment">// 更新目标位置</span></span><br><span class="line">			tracker-&gt;update(frame, box);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 在当前帧中绘制矩形</span></span><br><span class="line">		frame.copyTo(output);</span><br><span class="line">		rectangle(output, box, Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined VTRACKER</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Chapter-14-实用案列"><a href="#Chapter-14-实用案列" class="headerlink" title="Chapter_14  :    实用案列"></a>Chapter_14  :    实用案列</h3><blockquote>
<p>1.用最邻近局部二值模式实现人脸识别<br>2.通过级联Haar特征实现物体和人脸定位<br>3.用支持向量机和方向梯度直方图实现物体与行人检测</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/face.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/objdetect.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/ml.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.用最邻近局部二值模式实现人脸识别</span></span><br><span class="line"><span class="comment">//计算灰度图像的局部二值模式</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lbp</span><span class="params">(<span class="keyword">const</span> Mat &amp;image, Mat &amp;result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	assert(image.channels() == <span class="number">1</span>); <span class="comment">// input image must be gray scale</span></span><br><span class="line"></span><br><span class="line">	result.create(image.size(), CV_8U); <span class="comment">// 必要时分配空间</span></span><br><span class="line">										</span><br><span class="line">     <span class="comment">// 逐行处理，除了第一行和最后一行</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j&lt;image.rows - <span class="number">1</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 输入行的指针</span></span><br><span class="line">		<span class="keyword">const</span> uchar* previous = image.ptr&lt;<span class="keyword">const</span> uchar&gt;(j - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">const</span> uchar* current = image.ptr&lt;<span class="keyword">const</span> uchar&gt;(j);	 </span><br><span class="line">		<span class="keyword">const</span> uchar* next = image.ptr&lt;<span class="keyword">const</span> uchar&gt;(j + <span class="number">1</span>); </span><br><span class="line"></span><br><span class="line">		uchar* output = result.ptr&lt;uchar&gt;(j);	<span class="comment">// 输出行</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;image.cols - <span class="number">1</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 构建局部二值模式</span></span><br><span class="line">			*output = previous[i - <span class="number">1</span>] &gt; current[i] ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">			*output |= previous[i] &gt; current[i] ? <span class="number">2</span> : <span class="number">0</span>;</span><br><span class="line">			*output |= previous[i + <span class="number">1</span>] &gt; current[i] ? <span class="number">4</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">			*output |= current[i - <span class="number">1</span>] &gt; current[i] ? <span class="number">8</span> : <span class="number">0</span>;</span><br><span class="line">			*output |= current[i + <span class="number">1</span>] &gt; current[i] ? <span class="number">16</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">			*output |= next[i - <span class="number">1</span>] &gt; current[i] ? <span class="number">32</span> : <span class="number">0</span>;</span><br><span class="line">			*output |= next[i] &gt; current[i] ? <span class="number">64</span> : <span class="number">0</span>;</span><br><span class="line">			*output |= next[i + <span class="number">1</span>] &gt; current[i] ? <span class="number">128</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">			output++; <span class="comment">// 下一个像素</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 未处理的设置为0</span></span><br><span class="line">	result.row(<span class="number">0</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">	result.row(result.rows - <span class="number">1</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">	result.col(<span class="number">0</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">	result.col(result.cols - <span class="number">1</span>).setTo(Scalar(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.用支持向量机和方向梯度直方图实现物体与行人检测</span></span><br><span class="line"><span class="comment">// 画出一个单元格的HOG</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawHOG</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;::const_iterator hog, <span class="comment">// HOG迭代器</span></span></span></span><br><span class="line"><span class="function"><span class="params">	         <span class="keyword">int</span> numberOfBins,        <span class="comment">// HOG中的箱子数量</span></span></span></span><br><span class="line"><span class="function"><span class="params">	         Mat &amp;image,              <span class="comment">// 单元格的图像</span></span></span></span><br><span class="line"><span class="function"><span class="params">	         <span class="keyword">float</span> scale = <span class="number">1.0</span>)</span>       <span class="comment">// 长度缩放比例</span></span></span><br><span class="line"><span class="function"></span>&#123;       </span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">float</span> PI = <span class="number">3.1415927</span>;</span><br><span class="line">	<span class="keyword">float</span> binStep = PI / numberOfBins;</span><br><span class="line">	<span class="keyword">float</span> maxLength = image.rows;</span><br><span class="line">	<span class="keyword">float</span> cx = image.cols / <span class="number">2.</span>;</span><br><span class="line">	<span class="keyword">float</span> cy = image.rows / <span class="number">2.</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 逐个箱子</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> bin = <span class="number">0</span>; bin &lt; numberOfBins; bin++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 箱子方向</span></span><br><span class="line">		<span class="keyword">float</span> angle = bin*binStep;</span><br><span class="line">		<span class="keyword">float</span> dirX = <span class="built_in">cos</span>(angle);</span><br><span class="line">		<span class="keyword">float</span> dirY = <span class="built_in">sin</span>(angle);</span><br><span class="line">		<span class="comment">// 线条长度， 与箱子大小成正比</span></span><br><span class="line">		<span class="keyword">float</span> length = <span class="number">0.5</span>*maxLength* *(hog + bin);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 画线条</span></span><br><span class="line">		<span class="keyword">float</span> x1 = cx - dirX * length * scale;</span><br><span class="line">		<span class="keyword">float</span> y1 = cy - dirY * length * scale;</span><br><span class="line">		<span class="keyword">float</span> x2 = cx + dirX * length * scale;</span><br><span class="line">		<span class="keyword">float</span> y2 = cy + dirY * length * scale;</span><br><span class="line">		line(image, Point(x1, y1), Point(x2, y2), CV_RGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在图像上绘制 HOG</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawHOGDescriptors</span><span class="params">(<span class="keyword">const</span> Mat &amp;image,  <span class="comment">// 输入图像</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                    Mat &amp;hogImage,     <span class="comment">// 结果HOG图像</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                    Size cellSize,     <span class="comment">// 每个单元格的大小（忽略区块）</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                    <span class="keyword">int</span> nBins)</span>         <span class="comment">// 箱子数量</span></span></span><br><span class="line"><span class="function"></span>&#123;                             </span><br><span class="line"></span><br><span class="line">	<span class="comment">// 区块大小等于图像大小</span></span><br><span class="line">	<span class="function">HOGDescriptor <span class="title">hog</span><span class="params">(Size( (image.cols / cellSize.width) * cellSize.width,(image.rows / cellSize.height) * cellSize.height),</span></span></span><br><span class="line"><span class="function"><span class="params">		              Size( (image.cols / cellSize.width) * cellSize.width,(image.rows / cellSize.height) * cellSize.height),</span></span></span><br><span class="line"><span class="function"><span class="params">		              cellSize,    <span class="comment">// 区块步长（这里只有一个区块）</span></span></span></span><br><span class="line"><span class="function"><span class="params">		              cellSize,    <span class="comment">// 单元格大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">		              nBins)</span></span>;      <span class="comment">// 箱子数量</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算 HOG</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; descriptors;</span><br><span class="line">	hog.compute(image, descriptors);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">float</span> scale = <span class="number">2.0</span> / * max_element(descriptors.begin(), descriptors.end());</span><br><span class="line"></span><br><span class="line">	hogImage.create(image.rows, image.cols, CV_8U);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;::const_iterator itDesc = descriptors.begin();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; image.rows / cellSize.height; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; image.cols / cellSize.width; j++) &#123;</span><br><span class="line">			<span class="comment">// 画出每个单元格</span></span><br><span class="line">			hogImage(Rect(j*cellSize.width, i*cellSize.height, cellSize.width, cellSize.height));</span><br><span class="line">			drawHOG(itDesc, nBins,</span><br><span class="line">				    hogImage(Rect(j*cellSize.width, i*cellSize.height,cellSize.width, cellSize.height)), scale);</span><br><span class="line">			itDesc += nBins;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">////1.用最邻近局部二值模式实现人脸识别</span></span><br><span class="line">	<span class="comment">//Mat image = imread("./images/girl.jpg", IMREAD_GRAYSCALE);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("Original image", image);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Mat lbpImage;</span></span><br><span class="line">	<span class="comment">//lbp(image, lbpImage);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//imshow("LBP image", lbpImage);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Ptr&lt;face::FaceRecognizer&gt; recognizer =  face::LBPHFaceRecognizer::create(1,   //LBP模式的半径</span></span><br><span class="line">	<span class="comment">//	8,     //使用邻近像素的数量</span></span><br><span class="line">	<span class="comment">//	8, 8,  //网格大小</span></span><br><span class="line">	<span class="comment">//	200.); //最邻近的距离阈值</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////参考图像和标签的向量 </span></span><br><span class="line">	<span class="comment">//vector&lt;Mat&gt; referenceImages;</span></span><br><span class="line">	<span class="comment">//vector&lt;int&gt; labels;</span></span><br><span class="line">	<span class="comment">////打开参考图像</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(imread("./images/face0_1.png", IMREAD_GRAYSCALE));</span></span><br><span class="line">	<span class="comment">//labels.push_back(0); // 编号为0的人</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(imread("./images/face0_2.png", IMREAD_GRAYSCALE));</span></span><br><span class="line">	<span class="comment">//labels.push_back(0); // 编号为0的人</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(imread("./images/face0_2.png", IMREAD_GRAYSCALE));</span></span><br><span class="line">	<span class="comment">//labels.push_back(0); // 编号为0的人</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(imread("./images/face1_1.png", IMREAD_GRAYSCALE));</span></span><br><span class="line">	<span class="comment">//labels.push_back(1); // 编号为1的人</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(imread("./images/face1_2.png", IMREAD_GRAYSCALE));</span></span><br><span class="line">	<span class="comment">//labels.push_back(1); // 编号为1的人</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(imread("./images/face1_2.png", IMREAD_GRAYSCALE));</span></span><br><span class="line">	<span class="comment">//labels.push_back(1); // 编号为1的人</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">///*Mat i1 = imread("./images/face0_1.png", IMREAD_GRAYSCALE);</span></span><br><span class="line">	<span class="comment">//Mat i2 = imread("./images/face0_2.png", IMREAD_GRAYSCALE);</span></span><br><span class="line">	<span class="comment">//imshow("i1", i1);</span></span><br><span class="line">	<span class="comment">//imshow("i2", i2);*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// the 6 positive samples</span></span><br><span class="line">	<span class="comment">//Mat faceImages(2 * referenceImages[0].rows, 3 * referenceImages[0].cols, CV_8U);</span></span><br><span class="line">	<span class="comment">//for (int i = 0; i &lt; 2; i++)</span></span><br><span class="line">	<span class="comment">//	for (int j = 0; j &lt; 3; j++) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//		referenceImages[i * 2 + j].copyTo(faceImages(Rect(j*referenceImages[i * 2 + j].cols, i*referenceImages[i * 2 + j].rows, referenceImages[i * 2 + j].cols, referenceImages[i * 2 + j].rows)));</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//resize(faceImages, faceImages, Size(), 0.5, 0.5);</span></span><br><span class="line">	<span class="comment">//imshow("Reference faces", faceImages);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">////通过计算LBPH进行训练</span></span><br><span class="line">	<span class="comment">//recognizer-&gt;train(referenceImages, labels);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//int predictedLabel = -1;</span></span><br><span class="line">	<span class="comment">//double confidence = 0.0;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Extract a face image</span></span><br><span class="line">	<span class="comment">//Mat inputImage;</span></span><br><span class="line">	<span class="comment">//resize(image(Rect(160, 75, 90, 90)), inputImage, Size(256, 256));</span></span><br><span class="line">	<span class="comment">//imshow("Input image", inputImage);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// 识别图像对应的编号</span></span><br><span class="line">	<span class="comment">//recognizer-&gt;predict(inputImage,     // 人脸图像 </span></span><br><span class="line">	<span class="comment">//	predictedLabel, // 识别结果</span></span><br><span class="line">	<span class="comment">//	confidence);    // 置信度</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; "Image label= " &lt;&lt; predictedLabel &lt;&lt; " (" &lt;&lt; confidence &lt;&lt; ")" &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">////2.通过级联Haar特征实现物体和人脸定位</span></span><br><span class="line">	<span class="comment">//// open the positive sample images</span></span><br><span class="line">	<span class="comment">//std::vector&lt;cv::Mat&gt; referenceImages;</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop00.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop01.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop02.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop03.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop04.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop05.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop06.png"));</span></span><br><span class="line">	<span class="comment">//referenceImages.push_back(cv::imread("./images/stopSamples/stop07.png"));</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// create a composite image</span></span><br><span class="line">	<span class="comment">//cv::Mat positveImages(2 * referenceImages[0].rows, 4 * referenceImages[0].cols, CV_8UC3);</span></span><br><span class="line">	<span class="comment">//for (int i = 0; i &lt; 2; i++)</span></span><br><span class="line">	<span class="comment">//	for (int j = 0; j &lt; 4; j++) &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//		referenceImages[i * 2 + j].copyTo(positveImages(cv::Rect(j*referenceImages[i * 2 + j].cols, i*referenceImages[i * 2 + j].rows, referenceImages[i * 2 + j].cols, referenceImages[i * 2 + j].rows)));</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::imshow("Positive samples", positveImages);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::Mat negative = cv::imread("./images/stopSamples/bg01.jpg");</span></span><br><span class="line">	<span class="comment">//cv::resize(negative, negative, cv::Size(), 0.33, 0.33);</span></span><br><span class="line">	<span class="comment">//cv::imshow("One negative sample", negative);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::Mat inputImage = cv::imread("./images/stopSamples/stop9.jpg");</span></span><br><span class="line">	<span class="comment">//cv::resize(inputImage, inputImage, cv::Size(), 0.5, 0.5);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::CascadeClassifier cascade;</span></span><br><span class="line">	<span class="comment">//if (!cascade.load("./images/stopSamples/classifier/cascade.xml")) &#123;</span></span><br><span class="line">	<span class="comment">//	std::cout &lt;&lt; "Error when loading the cascade classfier!" &lt;&lt; std::endl;</span></span><br><span class="line">	<span class="comment">//	return -1;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// predict the label of this image</span></span><br><span class="line">	<span class="comment">//std::vector&lt;cv::Rect&gt; detections;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cascade.detectMultiScale(inputImage, // 输入图像</span></span><br><span class="line">	<span class="comment">//	detections, // 检测结果</span></span><br><span class="line">	<span class="comment">//	1.1,        // 缩小比例</span></span><br><span class="line">	<span class="comment">//	1,          // 所需近邻数量</span></span><br><span class="line">	<span class="comment">//	0,          // 标志位（不用）</span></span><br><span class="line">	<span class="comment">//	cv::Size(48, 48),    // 检测对象的最小尺寸</span></span><br><span class="line">	<span class="comment">//	cv::Size(128, 128)); // 检测对象的最大尺寸</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//std::cout &lt;&lt; "detections= " &lt;&lt; detections.size() &lt;&lt; std::endl;</span></span><br><span class="line">	<span class="comment">//for (int i = 0; i &lt; detections.size(); i++)</span></span><br><span class="line">	<span class="comment">//	cv::rectangle(inputImage, detections[i], cv::Scalar(255, 255, 255), 2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::imshow("Stop sign detection", inputImage);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Detecting faces</span></span><br><span class="line">	<span class="comment">//cv::Mat picture = cv::imread("./images/girl.jpg");</span></span><br><span class="line">	<span class="comment">//cv::CascadeClassifier faceCascade;</span></span><br><span class="line">	<span class="comment">//if (!faceCascade.load("D:\\Project_OpenCV\\Cmake\\install\\etc\\haarcascades\\haarcascade_frontalface_default.xml")) &#123;</span></span><br><span class="line">	<span class="comment">//	std::cout &lt;&lt; "Error when loading the face cascade classfier!" &lt;&lt; std::endl;</span></span><br><span class="line">	<span class="comment">//	return -1;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//faceCascade.detectMultiScale(picture, // input image </span></span><br><span class="line">	<span class="comment">//	detections, // detection results</span></span><br><span class="line">	<span class="comment">//	1.1,        // scale reduction factor</span></span><br><span class="line">	<span class="comment">//	3,          // number of required neighbor detections</span></span><br><span class="line">	<span class="comment">//	0,          // flags (not used)</span></span><br><span class="line">	<span class="comment">//	cv::Size(48, 48),    // minimum object size to be detected</span></span><br><span class="line">	<span class="comment">//	cv::Size(128, 128)); // maximum object size to be detected</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//std::cout &lt;&lt; "detections= " &lt;&lt; detections.size() &lt;&lt; std::endl;</span></span><br><span class="line">	<span class="comment">//// draw detections on image</span></span><br><span class="line">	<span class="comment">//for (int i = 0; i &lt; detections.size(); i++)</span></span><br><span class="line">	<span class="comment">//	cv::rectangle(picture, detections[i], cv::Scalar(255, 255, 255), 2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//// Detecting eyes</span></span><br><span class="line">	<span class="comment">//cv::CascadeClassifier eyeCascade;</span></span><br><span class="line">	<span class="comment">//if (!eyeCascade.load("D:\\Project_OpenCV\\Cmake\\install\\etc\\haarcascades\\haarcascade_eye.xml")) &#123;</span></span><br><span class="line">	<span class="comment">//	std::cout &lt;&lt; "Error when loading the eye cascade classfier!" &lt;&lt; std::endl;</span></span><br><span class="line">	<span class="comment">//	return -1;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//eyeCascade.detectMultiScale(picture, // input image </span></span><br><span class="line">	<span class="comment">//	detections, // detection results</span></span><br><span class="line">	<span class="comment">//	1.1,        // scale reduction factor</span></span><br><span class="line">	<span class="comment">//	3,          // number of required neighbor detections</span></span><br><span class="line">	<span class="comment">//	0,          // flags (not used)</span></span><br><span class="line">	<span class="comment">//	cv::Size(24, 24),    // minimum object size to be detected</span></span><br><span class="line">	<span class="comment">//	cv::Size(64, 64)); // maximum object size to be detected</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//std::cout &lt;&lt; "detections= " &lt;&lt; detections.size() &lt;&lt; std::endl;</span></span><br><span class="line">	<span class="comment">//// draw detections on image</span></span><br><span class="line">	<span class="comment">//for (int i = 0; i &lt; detections.size(); i++)</span></span><br><span class="line">	<span class="comment">//	cv::rectangle(picture, detections[i], cv::Scalar(0, 0, 0), 2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cv::imshow("Detection results", picture);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.用支持向量机和方向梯度直方图实现物体与行人检测</span></span><br><span class="line">    Mat image = imread(<span class="string">"./images/girl.jpg"</span>, IMREAD_GRAYSCALE);</span><br><span class="line">    imshow(<span class="string">"Original image"</span>, image);</span><br><span class="line"></span><br><span class="line">    <span class="function">HOGDescriptor <span class="title">hog</span><span class="params">(Size((image.cols / <span class="number">16</span>) * <span class="number">16</span>, (image.rows / <span class="number">16</span>) * <span class="number">16</span>), <span class="comment">// 窗口大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                  Size(<span class="number">16</span>, <span class="number">16</span>),    <span class="comment">// 区块大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                  Size(<span class="number">16</span>, <span class="number">16</span>),    <span class="comment">// 区块步长</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                  Size(<span class="number">4</span>, <span class="number">4</span>),      <span class="comment">// 单元格大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="number">9</span>)</span></span>;              <span class="comment">// 箱子数量</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; descriptors;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 drawHOGDescriptors函数，在图像上绘制HOG</span></span><br><span class="line">    Mat hogImage = image.clone();</span><br><span class="line">    drawHOGDescriptors(image, hogImage, Size(<span class="number">16</span>, <span class="number">16</span>), <span class="number">9</span>); </span><br><span class="line">	imshow(<span class="string">"HOG image"</span>, hogImage);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// generate the filename</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; imgs;</span><br><span class="line">    <span class="built_in">string</span> prefix = <span class="string">"./images/stopSamples/stop"</span>;</span><br><span class="line">    <span class="built_in">string</span> ext = <span class="string">".png"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// loading 8 positive samples</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;Mat&gt; positives;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) </span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">	     <span class="function"><span class="built_in">string</span> <span class="title">name</span><span class="params">(prefix)</span></span>;</span><br><span class="line">	     <span class="built_in">ostringstream</span> ss; </span><br><span class="line">		 ss &lt;&lt; setfill(<span class="string">'0'</span>) &lt;&lt; setw(<span class="number">2</span>) &lt;&lt; i; </span><br><span class="line">		 name += ss.str();</span><br><span class="line">	     name += ext;</span><br><span class="line"></span><br><span class="line">	     positives.push_back(imread(name, IMREAD_GRAYSCALE));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the first 8 positive samples</span></span><br><span class="line">    <span class="function">Mat <span class="title">posSamples</span><span class="params">(<span class="number">2</span> * positives[<span class="number">0</span>].rows, <span class="number">4</span> * positives[<span class="number">0</span>].cols, CV_8U)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">	  <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">	  &#123;</span><br><span class="line"></span><br><span class="line">		positives[i * <span class="number">4</span> + j].copyTo(posSamples(Rect(j*positives[i * <span class="number">4</span> + j].cols, i*positives[i * <span class="number">4</span> + j].rows, positives[i * <span class="number">4</span> + j].cols, positives[i * <span class="number">4</span> + j].rows)));</span><br><span class="line"></span><br><span class="line">	  &#125;</span><br><span class="line"></span><br><span class="line">    imshow(<span class="string">"Positive samples"</span>, posSamples);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// loading 8 negative samples</span></span><br><span class="line">    <span class="built_in">string</span> nprefix = <span class="string">"./images/stopSamples/neg"</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;Mat&gt; negatives;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) </span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">	     <span class="function"><span class="built_in">string</span> <span class="title">name</span><span class="params">(nprefix)</span></span>;</span><br><span class="line">	     <span class="built_in">ostringstream</span> ss;</span><br><span class="line">		 ss &lt;&lt; setfill(<span class="string">'0'</span>) &lt;&lt; setw(<span class="number">2</span>) &lt;&lt; i;</span><br><span class="line">		 name += ss.str();</span><br><span class="line">	     name += ext;</span><br><span class="line"></span><br><span class="line">	     negatives.push_back(imread(name, IMREAD_GRAYSCALE));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the first 8 negative samples</span></span><br><span class="line">    <span class="function">Mat <span class="title">negSamples</span><span class="params">(<span class="number">2</span> * negatives[<span class="number">0</span>].rows, <span class="number">4</span> * negatives[<span class="number">0</span>].cols, CV_8U)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		negatives[i * <span class="number">4</span> + j].copyTo(negSamples(cv::Rect(j*negatives[i * <span class="number">4</span> + j].cols, i*negatives[i * <span class="number">4</span> + j].rows, negatives[i * <span class="number">4</span> + j].cols, negatives[i * <span class="number">4</span> + j].rows)));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    imshow(<span class="string">"Negative samples"</span>, negSamples);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The HOG descriptor for stop sign detection</span></span><br><span class="line">    <span class="function">HOGDescriptor <span class="title">hogDesc</span><span class="params">(positives[<span class="number">0</span>].size(), <span class="comment">// 窗口大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                      Size(<span class="number">8</span>, <span class="number">8</span>),    <span class="comment">// 区块大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                      Size(<span class="number">4</span>, <span class="number">4</span>),    <span class="comment">// 区块步长</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                      Size(<span class="number">4</span>, <span class="number">4</span>),    <span class="comment">// 单元格大小</span></span></span></span><br><span class="line"><span class="function"><span class="params">	                      <span class="number">9</span>)</span></span>;            <span class="comment">//  箱子数量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算第一个描述子</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; desc;</span><br><span class="line">    hogDesc.compute(positives[<span class="number">0</span>], desc);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Positive sample size: "</span> &lt;&lt; positives[<span class="number">0</span>].rows &lt;&lt; <span class="string">"x"</span> &lt;&lt; positives[<span class="number">0</span>].cols &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"HOG descriptor size: "</span> &lt;&lt; desc.size() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 样本描述子矩阵</span></span><br><span class="line">    <span class="keyword">int</span> featureSize = desc.size();</span><br><span class="line">    <span class="keyword">int</span> numberOfSamples = positives.size() + negatives.size();</span><br><span class="line">    <span class="comment">// 创建存储样本HOG的矩阵</span></span><br><span class="line">    <span class="function">Mat <span class="title">samples</span><span class="params">(numberOfSamples, featureSize, CV_32FC1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用第一个描述子填第一行</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">	    samples.ptr&lt;<span class="keyword">float</span>&gt;(<span class="number">0</span>)[i] = desc[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算正样本的描述子</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; positives.size(); j++) </span><br><span class="line">	&#123;</span><br><span class="line">	   hogDesc.compute(positives[j], desc);</span><br><span class="line">	   <span class="comment">// 用当前描述子填下一行</span></span><br><span class="line">	   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">		    samples.ptr&lt;<span class="keyword">float</span>&gt;(j)[i] = desc[i];</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 计算负样本的描述子</span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; negatives.size(); j++) </span><br><span class="line">	 &#123;</span><br><span class="line">	     hogDesc.compute(negatives[j], desc);</span><br><span class="line">	     <span class="comment">// 用当前描述子填下一行</span></span><br><span class="line">	     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">		    samples.ptr&lt;<span class="keyword">float</span>&gt;(j + positives.size())[i] = desc[i];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 创建标签</span></span><br><span class="line">     <span class="function">Mat <span class="title">labels</span><span class="params">(numberOfSamples, <span class="number">1</span>, CV_32SC1)</span></span>;</span><br><span class="line">     <span class="comment">// 正样本的标签</span></span><br><span class="line">     labels.rowRange(<span class="number">0</span>, positives.size()) = <span class="number">1.0</span>;</span><br><span class="line">     <span class="comment">// 负样本的标签</span></span><br><span class="line">     labels.rowRange(positives.size(), numberOfSamples) = <span class="number">-1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建SVM分类器</span></span><br><span class="line">    Ptr&lt;ml::SVM&gt; svm = ml::SVM::create();</span><br><span class="line">    svm-&gt;setType(ml::SVM::C_SVC);</span><br><span class="line">    svm-&gt;setKernel(ml::SVM::LINEAR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 准备训练数据</span></span><br><span class="line">    Ptr&lt;ml::TrainData&gt; trainingData =</span><br><span class="line">    ml::TrainData::create(samples, ml::SampleTypes::ROW_SAMPLE, labels);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SVM 训练</span></span><br><span class="line">    svm-&gt;train(trainingData);</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">queries</span><span class="params">(<span class="number">4</span>, featureSize, CV_32FC1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每行填入查询描述子</span></span><br><span class="line">    hogDesc.compute(imread(<span class="string">"./images/stopSamples/stop08.png"</span>, IMREAD_GRAYSCALE), desc);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">	     queries.ptr&lt;<span class="keyword">float</span>&gt;(<span class="number">0</span>)[i] = desc[i];</span><br><span class="line">         hogDesc.compute(imread(<span class="string">"./images/stopSamples/stop09.png"</span>, IMREAD_GRAYSCALE), desc);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">	     queries.ptr&lt;<span class="keyword">float</span>&gt;(<span class="number">1</span>)[i] = desc[i];</span><br><span class="line">         hogDesc.compute(imread(<span class="string">"./images/stopSamples/neg08.png"</span>, IMREAD_GRAYSCALE), desc);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">	    queries.ptr&lt;<span class="keyword">float</span>&gt;(<span class="number">2</span>)[i] = desc[i];</span><br><span class="line">        hogDesc.compute(imread(<span class="string">"./images/stopSamples/neg09.png"</span>, IMREAD_GRAYSCALE), desc);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; featureSize; i++)</span><br><span class="line">	    queries.ptr&lt;<span class="keyword">float</span>&gt;(<span class="number">3</span>)[i] = desc[i];</span><br><span class="line">    Mat predictions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试分类器</span></span><br><span class="line">    svm-&gt;predict(queries, predictions);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">	    <span class="built_in">cout</span> &lt;&lt; <span class="string">"query: "</span> &lt;&lt; i &lt;&lt; <span class="string">": "</span> &lt;&lt; ((predictions.at&lt;<span class="keyword">float</span>&gt;(i) &lt; <span class="number">0.0</span>) ? <span class="string">"Negative"</span> : <span class="string">"Positive"</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 行人检测</span></span><br><span class="line">   Mat myImage = imread(<span class="string">"./images/person.jpg"</span>, IMREAD_GRAYSCALE);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 创建检测器</span></span><br><span class="line">   <span class="built_in">vector</span>&lt;Rect&gt; peoples;</span><br><span class="line">   HOGDescriptor peopleHog;</span><br><span class="line">   peopleHog.setSVMDetector(HOGDescriptor::getDefaultPeopleDetector());</span><br><span class="line">   <span class="comment">// 检测图像中的行人</span></span><br><span class="line">   peopleHog.detectMultiScale(myImage, <span class="comment">// 输入图像</span></span><br><span class="line">	                          peoples, <span class="comment">// 输出矩形列表 </span></span><br><span class="line">	                          <span class="number">0</span>,       <span class="comment">// 判断检测结果是否有效的阈值</span></span><br><span class="line">	                          Size(<span class="number">4</span>, <span class="number">4</span>),       <span class="comment">// 窗口步长</span></span><br><span class="line">	                          Size(<span class="number">32</span>, <span class="number">32</span>),     <span class="comment">// 填充图像</span></span><br><span class="line">	                          <span class="number">1.1</span>,              <span class="comment">// 缩放比列</span></span><br><span class="line">	                          <span class="number">2</span>);               <span class="comment">// 分组阈值</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// draw detections on image</span></span><br><span class="line">   <span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of peoples detected: "</span> &lt;&lt; peoples.size() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; peoples.size(); i++)</span><br><span class="line">	  rectangle(myImage, peoples[i], Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">   imshow(<span class="string">"People detection"</span>, myImage);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	waitKey(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/OpenCV/" rel="tag"># OpenCV</a>
          
            <a href="/tags/OpenCV计算机视觉编程攻略/" rel="tag"># OpenCV计算机视觉编程攻略</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/28/OpenCV之Practice/" rel="next" title="OpenCV之Practice">
                <i class="fa fa-chevron-left"></i> OpenCV之Practice
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="https://blog-1253453438.cos.ap-beijing.myqcloud.com/hexo_icon/lq.jpg" alt="晴宝宝">
          <p class="site-author-name" itemprop="name">晴宝宝</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/index.html">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lvqing17" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-01-基础知识"><span class="nav-number">1.</span> <span class="nav-text">Chapter_01 : 基础知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-02-操作像素"><span class="nav-number">2.</span> <span class="nav-text">Chapter_02 : 操作像素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-03-处理图像的颜色"><span class="nav-number">3.</span> <span class="nav-text">Chapter_03 : 处理图像的颜色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-04-用直方图统计像素"><span class="nav-number">4.</span> <span class="nav-text">Chapter_04 : 用直方图统计像素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-05-用形态学运算变换图像"><span class="nav-number">5.</span> <span class="nav-text">Chapter_05 : 用形态学运算变换图像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-06-图像滤波"><span class="nav-number">6.</span> <span class="nav-text">Chapter_06  :  图像滤波</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-07-提取直线、轮廓和区域"><span class="nav-number">7.</span> <span class="nav-text">Chapter_07 : 提取直线、轮廓和区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-08-检测兴趣点"><span class="nav-number">8.</span> <span class="nav-text">Chapter_08 : 检测兴趣点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-09-描述和匹配兴趣点"><span class="nav-number">9.</span> <span class="nav-text">Chapter_09 : 描述和匹配兴趣点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-10-估算图像之间的投影关系"><span class="nav-number">10.</span> <span class="nav-text">Chapter_10 : 估算图像之间的投影关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-11-三维重建"><span class="nav-number">11.</span> <span class="nav-text">Chapter_11  :   三维重建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-12-处理视频序列"><span class="nav-number">12.</span> <span class="nav-text">Chapter_12 : 处理视频序列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-13-跟踪运动物体"><span class="nav-number">13.</span> <span class="nav-text">Chapter_13  :   跟踪运动物体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chapter-14-实用案列"><span class="nav-number">14.</span> <span class="nav-text">Chapter_14  :    实用案列</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">晴宝宝</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  


  
  
  
  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

</body>
</html>
